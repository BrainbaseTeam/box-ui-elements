{"version":3,"sources":["../../../src/elements/content-sidebar/Sidebar.js"],"names":["React","classNames","flow","getProp","noop","uniqueid","withRouter","LoadingIndicator","LocalStore","SidebarNav","SidebarPanels","SidebarUtils","withFeatureConsumer","SIDEBAR_FORCE_KEY","SIDEBAR_FORCE_VALUE_CLOSED","SIDEBAR_FORCE_VALUE_OPEN","Sidebar","props","createRef","pathname","basePath","substring","split","event","file","history","currentVersion","file_version","fileVersionSlug","id","urlPrefix","getUrlPrefix","location","preventDefault","push","state","isDirty","getLocationState","setForcedByLocation","prevProps","fileId","prevFileId","prevLocation","replace","silent","setState","key","locationState","isOpen","undefined","store","setItem","getItem","isForced","shouldRefreshCache","sidebarPanels","current","refresh","isLocationOpen","activitySidebarProps","additionalTabs","className","currentUser","detailsSidebarProps","getPreview","getViewer","hasAdditionalTabs","hasVersions","isDefaultOpen","isLoading","metadataEditors","metadataSidebarProps","onAnnotationSelect","onVersionChange","versionsSidebarProps","isForcedSet","isForcedOpen","hasActivity","canHaveActivitySidebar","hasDetails","canHaveDetailsSidebar","hasMetadata","shouldRenderMetadataSidebar","hasSkills","shouldRenderSkillsSidebar","onVersionHistoryClick","handleVersionHistoryClick","styleClassName","Component","annotatorState","getAnnotationsMatchPath","getAnnotationsPath","SidebarComponent"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Content Sidebar Component\n * @author Box\n */\n\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport flow from 'lodash/flow';\nimport getProp from 'lodash/get';\nimport noop from 'lodash/noop';\nimport uniqueid from 'lodash/uniqueId';\nimport { withRouter } from 'react-router-dom';\nimport type { Location, RouterHistory } from 'react-router-dom';\nimport LoadingIndicator from '../../components/loading-indicator/LoadingIndicator';\nimport LocalStore from '../../utils/LocalStore';\nimport SidebarNav from './SidebarNav';\nimport SidebarPanels from './SidebarPanels';\nimport SidebarUtils from './SidebarUtils';\nimport { withFeatureConsumer } from '../common/feature-checking';\nimport type { FeatureConfig } from '../common/feature-checking';\nimport type { ActivitySidebarProps } from './ActivitySidebar';\nimport type { DetailsSidebarProps } from './DetailsSidebar';\nimport type { MetadataSidebarProps } from './MetadataSidebar';\nimport type { VersionsSidebarProps } from './versions';\nimport type { AdditionalSidebarTab } from './flowTypes';\nimport type { MetadataEditor } from '../../common/types/metadata';\nimport type { BoxItem, User } from '../../common/types/core';\n\ntype Props = {\n    activitySidebarProps: ActivitySidebarProps,\n    additionalTabs?: Array<AdditionalSidebarTab>,\n    className: string,\n    currentUser?: User,\n    detailsSidebarProps: DetailsSidebarProps,\n    features: FeatureConfig,\n    file: BoxItem,\n    fileId: string,\n    getPreview: Function,\n    getViewer: Function,\n    hasActivityFeed: boolean,\n    hasAdditionalTabs: boolean,\n    hasMetadata: boolean,\n    hasSkills: boolean,\n    hasVersions: boolean,\n    history: RouterHistory,\n    isDefaultOpen?: boolean,\n    isLoading?: boolean,\n    location: Location,\n    metadataEditors?: Array<MetadataEditor>,\n    metadataSidebarProps: MetadataSidebarProps,\n    onAnnotationSelect?: Function,\n    onVersionChange?: Function,\n    onVersionHistoryClick?: Function,\n    versionsSidebarProps: VersionsSidebarProps,\n};\n\ntype State = {\n    isDirty: boolean,\n};\n\nexport const SIDEBAR_FORCE_KEY: 'bcs.force' = 'bcs.force';\nexport const SIDEBAR_FORCE_VALUE_CLOSED: 'closed' = 'closed';\nexport const SIDEBAR_FORCE_VALUE_OPEN: 'open' = 'open';\n\nclass Sidebar extends React.Component<Props, State> {\n    static defaultProps = {\n        annotatorState: {},\n        isDefaultOpen: true,\n        isLoading: false,\n        getAnnotationsMatchPath: noop,\n        getAnnotationsPath: noop,\n    };\n\n    id: string = uniqueid('bcs_');\n\n    props: Props;\n\n    sidebarPanels: { current: null | SidebarPanels } = React.createRef();\n\n    state: State;\n\n    store: LocalStore = new LocalStore();\n\n    constructor(props: Props) {\n        super(props);\n\n        this.state = {\n            isDirty: this.getLocationState('open') || false,\n        };\n\n        this.setForcedByLocation();\n    }\n\n    componentDidUpdate(prevProps: Props): void {\n        const { fileId, history, location }: Props = this.props;\n        const { fileId: prevFileId, location: prevLocation }: Props = prevProps;\n        const { isDirty }: State = this.state;\n\n        // User navigated to a different file without ever navigating the sidebar\n        if (!isDirty && fileId !== prevFileId && location.pathname !== '/') {\n            history.replace({ pathname: '/', state: { silent: true } });\n        }\n\n        // User navigated or toggled the sidebar intentionally, internally or externally\n        if (location !== prevLocation && !this.getLocationState('silent')) {\n            this.setForcedByLocation();\n            this.setState({ isDirty: true });\n        }\n    }\n\n    getUrlPrefix = (pathname: string) => {\n        const basePath = pathname.substring(1).split('/')[0];\n        return basePath;\n    };\n\n    /**\n     * Handle version history click\n     *\n     * @param {SyntheticEvent} event - The event\n     * @return {void}\n     */\n    handleVersionHistoryClick = (event: SyntheticEvent<>): void => {\n        const { file, history } = this.props;\n        const { file_version: currentVersion } = file;\n        const fileVersionSlug = currentVersion ? `/${currentVersion.id}` : '';\n\n        const urlPrefix = this.getUrlPrefix(history.location.pathname);\n\n        if (event.preventDefault) {\n            event.preventDefault();\n        }\n\n        history.push(`/${urlPrefix}/versions${fileVersionSlug}`);\n    };\n\n    /**\n     * Getter for location state properties.\n     *\n     * NOTE: Each location on the history stack has its own optional state object that is wholly separate from\n     * this component's internal state. Values on the location state object can persist even between refreshes\n     * when using certain history contexts, such as BrowserHistory.\n     *\n     * @param key - Optionally get a specific key value from state\n     * @returns {any} - The location state or state key value\n     */\n    getLocationState(key?: string): any {\n        const { location } = this.props;\n        const { state: locationState = {} } = location;\n        return getProp(locationState, key);\n    }\n\n    /**\n     * Getter/setter for sidebar forced state\n     *\n     * @param isOpen - Optionally set the sidebar to open/closed\n     * @returns {string|null} - The sidebar open/closed state\n     */\n    isForced(isOpen?: boolean): ?(typeof SIDEBAR_FORCE_VALUE_CLOSED | typeof SIDEBAR_FORCE_VALUE_OPEN) {\n        if (isOpen !== undefined) {\n            this.store.setItem(SIDEBAR_FORCE_KEY, isOpen ? SIDEBAR_FORCE_VALUE_OPEN : SIDEBAR_FORCE_VALUE_CLOSED);\n        }\n\n        return this.store.getItem(SIDEBAR_FORCE_KEY);\n    }\n\n    /**\n     * Getter for whether the sidebar has been forced open\n     * @returns {boolean} - True if the sidebar has been forced open\n     */\n    isForcedOpen(): boolean {\n        return this.isForced() === SIDEBAR_FORCE_VALUE_OPEN;\n    }\n\n    /**\n     * Getter for whether the sidebar has been forced open/closed previously\n     * @returns {boolean} - True if the sidebar has been forced open/closed previously\n     */\n    isForcedSet(): boolean {\n        return this.isForced() !== null;\n    }\n\n    /**\n     * Refreshes the sidebar panel\n     * @returns {void}\n     */\n    refresh(shouldRefreshCache: boolean = true): void {\n        const { current: sidebarPanels } = this.sidebarPanels;\n\n        if (sidebarPanels) {\n            sidebarPanels.refresh(shouldRefreshCache);\n        }\n    }\n\n    /**\n     * Helper to set the local store open state based on the location open state, if defined\n     */\n    setForcedByLocation(): void {\n        const isLocationOpen: ?boolean = this.getLocationState('open');\n\n        if (isLocationOpen !== undefined && isLocationOpen !== null) {\n            this.isForced(isLocationOpen);\n        }\n    }\n\n    render() {\n        const {\n            activitySidebarProps,\n            additionalTabs,\n            className,\n            currentUser,\n            detailsSidebarProps,\n            file,\n            fileId,\n            getPreview,\n            getViewer,\n            hasAdditionalTabs,\n            hasVersions,\n            isDefaultOpen,\n            isLoading,\n            metadataEditors,\n            metadataSidebarProps,\n            onAnnotationSelect,\n            onVersionChange,\n            versionsSidebarProps,\n        }: Props = this.props;\n        const isOpen = this.isForcedSet() ? this.isForcedOpen() : !!isDefaultOpen;\n        const hasActivity = SidebarUtils.canHaveActivitySidebar(this.props);\n        const hasDetails = SidebarUtils.canHaveDetailsSidebar(this.props);\n        const hasMetadata = SidebarUtils.shouldRenderMetadataSidebar(this.props, metadataEditors);\n        const hasSkills = SidebarUtils.shouldRenderSkillsSidebar(this.props, file);\n        const onVersionHistoryClick = hasVersions ? this.handleVersionHistoryClick : this.props.onVersionHistoryClick;\n        const styleClassName = classNames('be bcs', className, {\n            'bcs-is-open': isOpen,\n        });\n\n        return (\n            <aside id={this.id} className={styleClassName}>\n                {isLoading ? (\n                    <div className=\"bcs-loading\">\n                        <LoadingIndicator />\n                    </div>\n                ) : (\n                    <>\n                        <SidebarNav\n                            additionalTabs={additionalTabs}\n                            elementId={this.id}\n                            fileId={fileId}\n                            hasActivity={hasActivity}\n                            hasAdditionalTabs={hasAdditionalTabs}\n                            hasDetails={hasDetails}\n                            hasMetadata={hasMetadata}\n                            hasSkills={hasSkills}\n                            isOpen={isOpen}\n                        />\n                        <SidebarPanels\n                            activitySidebarProps={activitySidebarProps}\n                            currentUser={currentUser}\n                            elementId={this.id}\n                            detailsSidebarProps={detailsSidebarProps}\n                            file={file}\n                            fileId={fileId}\n                            getPreview={getPreview}\n                            getViewer={getViewer}\n                            hasActivity={hasActivity}\n                            hasDetails={hasDetails}\n                            hasMetadata={hasMetadata}\n                            hasSkills={hasSkills}\n                            hasVersions={hasVersions}\n                            isOpen={isOpen}\n                            key={file.id}\n                            metadataSidebarProps={metadataSidebarProps}\n                            onAnnotationSelect={onAnnotationSelect}\n                            onVersionChange={onVersionChange}\n                            onVersionHistoryClick={onVersionHistoryClick}\n                            ref={this.sidebarPanels}\n                            versionsSidebarProps={versionsSidebarProps}\n                        />\n                    </>\n                )}\n            </aside>\n        );\n    }\n}\n\nexport { Sidebar as SidebarComponent };\nexport default flow([withFeatureConsumer, withRouter])(Sidebar);\n"],"file":"Sidebar.js"}