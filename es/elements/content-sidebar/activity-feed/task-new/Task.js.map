{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/task-new/Task.js"],"names":["React","noop","flow","get","FormattedMessage","classNames","TetherComponent","withFeatureConsumer","getFeatureConfig","withAPIContext","Avatar","Media","MenuItem","ActivityError","ActivityMessage","ActivityTimestamp","DeleteConfirmation","IconTaskApproval","IconTaskGeneral","IconTrash","IconPencil","UserLink","API","TASK_COMPLETION_RULE_ALL","TASK_NEW_APPROVED","TASK_NEW_REJECTED","TASK_NEW_NOT_STARTED","TASK_NEW_IN_PROGRESS","TASK_NEW_COMPLETED","TASK_TYPE_APPROVAL","PLACEHOLDER_USER","TASK_EDIT_MODE_EDIT","ACTIVITY_TARGETS","bdlGray80","TaskActions","TaskCompletionRuleIcon","TaskDueDate","TaskStatus","AssigneeList","TaskModal","commonMessages","messages","getMessageForTask","isCurrentUser","taskType","tasksFeedHeadlineApprovalCurrentUser","tasksFeedHeadlineGeneralCurrentUser","tasksFeedHeadlineApproval","tasksFeedHeadlineGeneral","Task","loadCollabError","undefined","assignedToFull","props","assigned_to","modalError","isEditing","isLoading","isAssigneeListOpen","isConfirmingDelete","getAllTaskCollaborators","setState","id","onDelete","permissions","onModalClose","error","onSuccess","api","task_links","errorOccured","taskCollaboratorLoadErrorMessage","next_marker","fileId","getTaskCollaboratorsAPI","getTaskCollaborators","task","file","errorCallback","message","title","successCallback","taskId","assignmentId","taskStatus","onAssignmentUpdate","approverSelectorContacts","completion_rule","created_at","created_by","currentUser","due_at","features","getApproverWithQuery","getAvatarUrl","getUserProfileUrl","isPending","description","onEdit","status","task_type","translatedTaggedMessage","translations","state","inlineError","currentUserAssignment","entries","find","target","createdByUser","createdAtTimestamp","Date","getTime","shouldShowActions","can_update","TaskTypeIcon","isMenuVisible","can_delete","to","attachment","TASK_OPTIONS","TASK_OPTIONS_EDIT","handleEditClick","taskEditMenuItem","TASK_OPTIONS_DELETE","handleDeleteClick","taskDeleteMenuItem","taskDeletePrompt","handleDeleteCancel","handleDeleteConfirm","user","PROFILE","handleAssigneeListCollapse","handleAssigneeListExpand","handleTaskAction","feedbackUrl","handleEditSubmitError","handleEditModalClose","approvers","completionRule","createTask","editTask","dueDate","Component","TaskComponent"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport noop from 'lodash/noop';\nimport flow from 'lodash/flow';\nimport get from 'lodash/get';\nimport { FormattedMessage } from 'react-intl';\nimport classNames from 'classnames';\nimport TetherComponent from 'react-tether';\nimport { withFeatureConsumer, getFeatureConfig } from '../../../common/feature-checking';\nimport { withAPIContext } from '../../../common/api-context';\nimport Avatar from '../Avatar';\nimport Media from '../../../../components/media';\nimport { MenuItem } from '../../../../components/menu';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport IconTaskApproval from '../../../../icons/two-toned/IconTaskApproval';\nimport IconTaskGeneral from '../../../../icons/two-toned/IconTaskGeneral';\nimport IconTrash from '../../../../icons/general/IconTrash';\nimport IconPencil from '../../../../icons/general/IconPencil';\nimport UserLink from '../common/user-link';\nimport API from '../../../../api/APIFactory';\nimport {\n    TASK_COMPLETION_RULE_ALL,\n    TASK_NEW_APPROVED,\n    TASK_NEW_REJECTED,\n    TASK_NEW_NOT_STARTED,\n    TASK_NEW_IN_PROGRESS,\n    TASK_NEW_COMPLETED,\n    TASK_TYPE_APPROVAL,\n    PLACEHOLDER_USER,\n    TASK_EDIT_MODE_EDIT,\n} from '../../../../constants';\nimport type { TaskAssigneeCollection, TaskNew, TaskType } from '../../../../common/types/tasks';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport { bdlGray80 } from '../../../../styles/variables';\nimport TaskActions from './TaskActions';\nimport TaskCompletionRuleIcon from './TaskCompletionRuleIcon';\nimport TaskDueDate from './TaskDueDate';\nimport TaskStatus from './TaskStatus';\nimport AssigneeList from './AssigneeList';\nimport TaskModal from '../../TaskModal';\nimport commonMessages from '../../../common/messages';\nimport messages from './messages';\n\nimport './Task.scss';\n\ntype Props = {|\n    ...TaskNew,\n    api: API,\n    approverSelectorContacts: SelectorItems,\n    currentUser: User,\n    error?: ActionItemError,\n    features?: FeatureConfig,\n    getApproverWithQuery?: Function,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: Function,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    isPending?: boolean,\n    onAssignmentUpdate: Function,\n    onDelete?: Function,\n    onEdit?: Function,\n    onModalClose?: Function,\n    translatedTaggedMessage?: string,\n    translations?: Translations,\n|};\n\ntype State = {\n    // the complete list of assignees (when task.assigned_to is truncated)\n    assignedToFull: TaskAssigneeCollection,\n    isAssigneeListOpen: boolean,\n    isConfirmingDelete: boolean,\n    isEditing: boolean,\n    isLoading: boolean,\n    loadCollabError: ?ActionItemError,\n    modalError: ?ElementsXhrError,\n};\n\nconst getMessageForTask = (isCurrentUser: boolean, taskType: TaskType) => {\n    if (isCurrentUser) {\n        if (taskType === TASK_TYPE_APPROVAL) {\n            return messages.tasksFeedHeadlineApprovalCurrentUser;\n        }\n        return messages.tasksFeedHeadlineGeneralCurrentUser;\n    }\n\n    if (taskType === TASK_TYPE_APPROVAL) {\n        return messages.tasksFeedHeadlineApproval;\n    }\n    return messages.tasksFeedHeadlineGeneral;\n};\n\nclass Task extends React.Component<Props, State> {\n    static defaultProps = {\n        completion_rule: TASK_COMPLETION_RULE_ALL,\n    };\n\n    state = {\n        loadCollabError: undefined,\n        assignedToFull: this.props.assigned_to,\n        modalError: undefined,\n        isEditing: false,\n        isLoading: false,\n        isAssigneeListOpen: false,\n        isConfirmingDelete: false,\n    };\n\n    handleAssigneeListExpand = () => {\n        this.getAllTaskCollaborators(() => {\n            this.setState({ isAssigneeListOpen: true });\n        });\n    };\n\n    handleAssigneeListCollapse = () => {\n        this.setState({ isAssigneeListOpen: false });\n    };\n\n    handleEditClick = () => {\n        this.getAllTaskCollaborators(() => {\n            this.setState({ isEditing: true });\n        });\n    };\n\n    handleDeleteClick = () => {\n        this.setState({ isConfirmingDelete: true });\n    };\n\n    handleDeleteConfirm = (): void => {\n        const { id, onDelete, permissions } = this.props;\n\n        if (onDelete) {\n            onDelete({ id, permissions });\n        }\n    };\n\n    handleDeleteCancel = (): void => {\n        this.setState({ isConfirmingDelete: false });\n    };\n\n    handleEditModalClose = () => {\n        const { onModalClose } = this.props;\n        this.setState({ isEditing: false, modalError: undefined });\n\n        if (onModalClose) {\n            onModalClose();\n        }\n    };\n\n    handleEditSubmitError = (error: ElementsXhrError) => {\n        this.setState({ modalError: error });\n    };\n\n    getAllTaskCollaborators = (onSuccess: () => any) => {\n        const { id, api, task_links, assigned_to } = this.props;\n        const { errorOccured } = commonMessages;\n        const { taskCollaboratorLoadErrorMessage } = messages;\n\n        // skip fetch when there are no additional collaborators\n        if (!assigned_to.next_marker) {\n            this.setState({ assignedToFull: assigned_to });\n            onSuccess();\n            return;\n        }\n\n        // fileid is required for api calls, check for presence\n        const fileId = get(task_links, 'entries[0].target.id');\n        if (!fileId) {\n            return;\n        }\n\n        this.setState({ isLoading: true });\n        api.getTaskCollaboratorsAPI(false).getTaskCollaborators({\n            task: { id },\n            file: { id: fileId },\n            errorCallback: () => {\n                this.setState({\n                    isLoading: false,\n                    loadCollabError: {\n                        message: taskCollaboratorLoadErrorMessage,\n                        title: errorOccured,\n                    },\n                });\n            },\n            successCallback: assignedToFull => {\n                this.setState({ assignedToFull, isLoading: false });\n                onSuccess();\n            },\n        });\n    };\n\n    handleTaskAction = (taskId: string, assignmentId: string, taskStatus: string) => {\n        const { onAssignmentUpdate } = this.props;\n\n        this.setState({ isAssigneeListOpen: false });\n\n        onAssignmentUpdate(taskId, assignmentId, taskStatus);\n    };\n\n    render() {\n        const {\n            approverSelectorContacts,\n            assigned_to,\n            completion_rule,\n            created_at,\n            created_by,\n            currentUser,\n            due_at,\n            error,\n            features,\n            getApproverWithQuery,\n            getAvatarUrl,\n            getUserProfileUrl,\n            id,\n            isPending,\n            description,\n            onEdit,\n            permissions,\n            status,\n            task_type,\n            translatedTaggedMessage,\n            translations,\n        } = this.props;\n\n        const {\n            assignedToFull,\n            modalError,\n            isEditing,\n            isLoading,\n            loadCollabError,\n            isAssigneeListOpen,\n            isConfirmingDelete,\n        } = this.state;\n\n        const inlineError = loadCollabError || error;\n\n        const currentUserAssignment =\n            assigned_to && assigned_to.entries\n                ? assigned_to.entries.find(({ target }) => target.id === currentUser.id)\n                : null;\n\n        const createdByUser = created_by.target || PLACEHOLDER_USER;\n\n        const createdAtTimestamp = new Date(created_at).getTime();\n\n        const shouldShowActions =\n            currentUserAssignment &&\n            currentUserAssignment.permissions &&\n            currentUserAssignment.permissions.can_update &&\n            currentUserAssignment.status === TASK_NEW_NOT_STARTED &&\n            (status === TASK_NEW_NOT_STARTED || status === TASK_NEW_IN_PROGRESS);\n\n        const TaskTypeIcon = task_type === TASK_TYPE_APPROVAL ? IconTaskApproval : IconTaskGeneral;\n\n        const isMenuVisible = (permissions.can_delete || permissions.can_update) && !isPending;\n\n        return (\n            <div className=\"bcs-Task\">\n                {inlineError ? <ActivityError {...inlineError} /> : null}\n                <Media\n                    className={classNames('bcs-Task-media', {\n                        'bcs-is-pending': isPending || isLoading,\n                    })}\n                    data-testid=\"task-card\"\n                >\n                    <Media.Figure className=\"bcs-Task-avatar\">\n                        <Avatar getAvatarUrl={getAvatarUrl} user={createdByUser} />\n                        <TaskTypeIcon width={20} height={20} className=\"bcs-Task-avatarBadge\" />\n                    </Media.Figure>\n                    <Media.Body>\n                        {isMenuVisible && (\n                            <TetherComponent\n                                attachment=\"top right\"\n                                className=\"bcs-Task-deleteConfirmationModal\"\n                                constraints={[{ to: 'scrollParent', attachment: 'together' }]}\n                                targetAttachment=\"bottom right\"\n                            >\n                                <Media.Menu\n                                    isDisabled={isConfirmingDelete}\n                                    data-testid=\"task-actions-menu\"\n                                    menuProps={{\n                                        'data-resin-component': ACTIVITY_TARGETS.TASK_OPTIONS,\n                                    }}\n                                >\n                                    {permissions.can_update && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.TASK_OPTIONS_EDIT}\n                                            data-testid=\"edit-task\"\n                                            onClick={this.handleEditClick}\n                                        >\n                                            <IconPencil color={bdlGray80} />\n                                            <FormattedMessage {...messages.taskEditMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                    {permissions.can_delete && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.TASK_OPTIONS_DELETE}\n                                            data-testid=\"delete-task\"\n                                            onClick={this.handleDeleteClick}\n                                        >\n                                            <IconTrash color={bdlGray80} />\n                                            <FormattedMessage {...messages.taskDeleteMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                </Media.Menu>\n                                {isConfirmingDelete && (\n                                    <DeleteConfirmation\n                                        data-resin-component={ACTIVITY_TARGETS.TASK_OPTIONS}\n                                        isOpen={isConfirmingDelete}\n                                        message={messages.taskDeletePrompt}\n                                        onDeleteCancel={this.handleDeleteCancel}\n                                        onDeleteConfirm={this.handleDeleteConfirm}\n                                    />\n                                )}\n                            </TetherComponent>\n                        )}\n                        <div className=\"bcs-Task-headline\">\n                            <FormattedMessage\n                                {...getMessageForTask(!!currentUserAssignment, task_type)}\n                                values={{\n                                    user: (\n                                        <UserLink\n                                            {...createdByUser}\n                                            data-resin-target={ACTIVITY_TARGETS.PROFILE}\n                                            getUserProfileUrl={getUserProfileUrl}\n                                        />\n                                    ),\n                                }}\n                            />\n                        </div>\n                        <div>\n                            <ActivityTimestamp date={createdAtTimestamp} />\n                        </div>\n                        <div>\n                            <ActivityMessage\n                                id={id}\n                                tagged_message={description}\n                                translatedTaggedMessage={translatedTaggedMessage}\n                                {...translations}\n                                translationFailed={error ? true : null}\n                                getUserProfileUrl={getUserProfileUrl}\n                            />\n                        </div>\n                        <div className=\"bcs-Task-statusContainer\">\n                            {!!due_at && <TaskDueDate dueDate={due_at} status={status} />}\n                            <TaskStatus status={status} />\n                            <TaskCompletionRuleIcon completionRule={completion_rule} />\n                        </div>\n                        <div className=\"bcs-Task-assigneeListContainer\">\n                            <AssigneeList\n                                isOpen={isAssigneeListOpen}\n                                onCollapse={this.handleAssigneeListCollapse}\n                                onExpand={this.handleAssigneeListExpand}\n                                getAvatarUrl={getAvatarUrl}\n                                initialAssigneeCount={3}\n                                users={isAssigneeListOpen ? assignedToFull : assigned_to}\n                            />\n                        </div>\n                        {currentUserAssignment && shouldShowActions && (\n                            <div className=\"bcs-Task-actionsContainer\">\n                                <TaskActions\n                                    taskType={task_type}\n                                    onTaskApproval={\n                                        isPending\n                                            ? noop\n                                            : () => {\n                                                  this.handleTaskAction(\n                                                      id,\n                                                      currentUserAssignment.id,\n                                                      TASK_NEW_APPROVED,\n                                                  );\n                                              }\n                                    }\n                                    onTaskReject={\n                                        isPending\n                                            ? noop\n                                            : () =>\n                                                  this.handleTaskAction(id, currentUserAssignment.id, TASK_NEW_REJECTED)\n                                    }\n                                    onTaskComplete={\n                                        isPending\n                                            ? noop\n                                            : () =>\n                                                  this.handleTaskAction(\n                                                      id,\n                                                      currentUserAssignment.id,\n                                                      TASK_NEW_COMPLETED,\n                                                  )\n                                    }\n                                />\n                            </div>\n                        )}\n                    </Media.Body>\n                </Media>\n                <TaskModal\n                    editMode={TASK_EDIT_MODE_EDIT}\n                    error={modalError}\n                    feedbackUrl={getFeatureConfig(features, 'activityFeed.tasks').feedbackUrl || ''}\n                    onSubmitError={this.handleEditSubmitError}\n                    onSubmitSuccess={this.handleEditModalClose}\n                    onModalClose={this.handleEditModalClose}\n                    isTaskFormOpen={isEditing}\n                    taskFormProps={{\n                        id,\n                        approvers: assignedToFull.entries,\n                        approverSelectorContacts,\n                        completionRule: completion_rule,\n                        getApproverWithQuery,\n                        getAvatarUrl,\n                        createTask: () => {},\n                        editTask: onEdit,\n                        dueDate: due_at,\n                        message: description,\n                    }}\n                    taskType={task_type}\n                />\n            </div>\n        );\n    }\n}\n\nexport { Task as TaskComponent };\nexport default flow([withFeatureConsumer, withAPIContext])(Task);\n"],"file":"Task.js"}