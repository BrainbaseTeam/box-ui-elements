{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/annotations/AnnotationActivity.js"],"names":["React","classNames","getProp","noop","TetherComponent","ActivityError","ActivityMessage","ActivityTimestamp","AnnotationActivityLink","AnnotationActivityMenu","Avatar","CommentForm","DeleteConfirmation","Media","messages","SelectableActivityCard","UserLink","ACTIVITY_TARGETS","PLACEHOLDER_USER","AnnotationActivity","currentUser","item","getAvatarUrl","getMentionWithQuery","getUserProfileUrl","isCurrentVersion","mentionSelectorContacts","onDelete","onEdit","onSelect","useState","isConfirmingDelete","setIsConfirmingDelete","isEditing","setIsEditing","isMenuOpen","setIsMenuOpen","created_at","created_by","description","error","file_version","id","isPending","permissions","target","canDelete","can_delete","canEdit","can_edit","isFileVersionUnavailable","isCardDisabled","isMenuVisible","handleDelete","handleDeleteCancel","handleDeleteConfirm","handleEdit","handleFormCancel","handleFormSubmit","text","handleMenuClose","handleMenuOpen","handleMouseDown","event","stopPropagation","handleSelect","createdAtTimestamp","Date","getTime","createdByUser","linkMessage","annotationActivityPageItem","annotationActivityVersionLink","linkValue","location","value","message","activityLinkMessage","annotationActivityVersionUnavailable","values","number","tetherProps","attachment","className","constraints","to","targetAttachment","PROFILE","name","ANNOTATION_OPTIONS","annotationActivityDeletePrompt"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport getProp from 'lodash/get';\nimport noop from 'lodash/noop';\nimport TetherComponent from 'react-tether';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport AnnotationActivityLink from './AnnotationActivityLink';\nimport AnnotationActivityMenu from './AnnotationActivityMenu';\nimport Avatar from '../Avatar';\nimport CommentForm from '../comment-form/CommentForm';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport Media from '../../../../components/media';\nimport messages from './messages';\nimport SelectableActivityCard from '../SelectableActivityCard';\nimport UserLink from '../common/user-link';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport { PLACEHOLDER_USER } from '../../../../constants';\nimport type { Annotation, AnnotationPermission } from '../../../../common/types/feed';\nimport type { GetAvatarUrlCallback, GetProfileUrlCallback } from '../../../common/flowTypes';\nimport type { SelectorItems, User } from '../../../../common/types/core';\n\nimport './AnnotationActivity.scss';\n\ntype Props = {\n    currentUser?: User,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: (searchStr: string) => void,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    isCurrentVersion: boolean,\n    item: Annotation,\n    mentionSelectorContacts?: SelectorItems<User>,\n    onDelete?: ({ id: string, permissions: AnnotationPermission }) => any,\n    onEdit?: (id: string, text: string, permissions: AnnotationPermission) => void,\n    onSelect?: (annotation: Annotation) => any,\n};\n\nconst AnnotationActivity = ({\n    currentUser,\n    item,\n    getAvatarUrl,\n    getMentionWithQuery,\n    getUserProfileUrl,\n    isCurrentVersion,\n    mentionSelectorContacts,\n    onDelete = noop,\n    onEdit = noop,\n    onSelect = noop,\n}: Props) => {\n    const [isConfirmingDelete, setIsConfirmingDelete] = React.useState(false);\n    const [isEditing, setIsEditing] = React.useState(false);\n    const [isMenuOpen, setIsMenuOpen] = React.useState(false);\n    const { created_at, created_by, description, error, file_version, id, isPending, permissions = {}, target } = item;\n    const { can_delete: canDelete, can_edit: canEdit } = permissions;\n    const isFileVersionUnavailable = file_version === null;\n    const isCardDisabled = !!error || isConfirmingDelete || isMenuOpen || isEditing || isFileVersionUnavailable;\n    const isMenuVisible = (canDelete || canEdit) && !isPending;\n\n    const handleDelete = (): void => setIsConfirmingDelete(true);\n    const handleDeleteCancel = (): void => setIsConfirmingDelete(false);\n    const handleDeleteConfirm = (): void => {\n        setIsConfirmingDelete(false);\n        onDelete({ id, permissions });\n    };\n    const handleEdit = (): void => setIsEditing(true);\n    const handleFormCancel = (): void => setIsEditing(false);\n    const handleFormSubmit = ({ text }): void => {\n        setIsEditing(false);\n        onEdit(id, text, permissions);\n    };\n    const handleMenuClose = (): void => setIsMenuOpen(false);\n    const handleMenuOpen = (): void => setIsMenuOpen(true);\n    const handleMouseDown = (event: MouseEvent) => {\n        if (isCardDisabled) {\n            return;\n        }\n\n        // Prevents document event handlers from executing because box-annotations relies on\n        // detecting mouse events on the document outside of annotation targets to determine when to\n        // deselect annotations\n        event.stopPropagation();\n    };\n    const handleSelect = () => onSelect(item);\n\n    const createdAtTimestamp = new Date(created_at).getTime();\n    const createdByUser = created_by || PLACEHOLDER_USER;\n    const linkMessage = isCurrentVersion ? messages.annotationActivityPageItem : messages.annotationActivityVersionLink;\n    const linkValue = isCurrentVersion ? target.location.value : getProp(file_version, 'version_number');\n    const message = (description && description.message) || '';\n    const activityLinkMessage = isFileVersionUnavailable\n        ? messages.annotationActivityVersionUnavailable\n        : { ...linkMessage, values: { number: linkValue } };\n    const tetherProps = {\n        attachment: 'top right',\n        className: 'bcs-AnnotationActivity-deleteConfirmationModal',\n        constraints: [{ to: 'scrollParent', attachment: 'together' }],\n        targetAttachment: 'bottom right',\n    };\n\n    return (\n        <>\n            <SelectableActivityCard\n                className=\"bcs-AnnotationActivity\"\n                data-resin-feature=\"annotations\"\n                data-resin-iscurrent={isCurrentVersion}\n                data-resin-itemid={id}\n                data-resin-target=\"annotationButton\"\n                isDisabled={isCardDisabled}\n                onMouseDown={handleMouseDown}\n                onSelect={handleSelect}\n            >\n                <Media\n                    className={classNames('bcs-AnnotationActivity-media', {\n                        'bcs-is-pending': isPending || error,\n                    })}\n                >\n                    <Media.Figure>\n                        <Avatar getAvatarUrl={getAvatarUrl} user={createdByUser} />\n                    </Media.Figure>\n                    <Media.Body>\n                        <div className=\"bcs-AnnotationActivity-headline\">\n                            <UserLink\n                                data-resin-target={ACTIVITY_TARGETS.PROFILE}\n                                getUserProfileUrl={getUserProfileUrl}\n                                id={createdByUser.id}\n                                name={createdByUser.name}\n                            />\n                        </div>\n                        <div className=\"bcs-AnnotationActivity-timestamp\">\n                            <ActivityTimestamp date={createdAtTimestamp} />\n                            <AnnotationActivityLink\n                                className=\"bcs-AnnotationActivity-link\"\n                                data-resin-target=\"annotationLink\"\n                                id={id}\n                                isDisabled={isFileVersionUnavailable}\n                                message={activityLinkMessage}\n                                onClick={handleSelect}\n                            />\n                        </div>\n                        {isEditing && currentUser ? (\n                            <CommentForm\n                                className=\"bcs-AnnotationActivity-editor\"\n                                entityId={id}\n                                getAvatarUrl={getAvatarUrl}\n                                getMentionWithQuery={getMentionWithQuery}\n                                isEditing={isEditing}\n                                isOpen={isEditing}\n                                mentionSelectorContacts={mentionSelectorContacts}\n                                onCancel={handleFormCancel}\n                                updateComment={handleFormSubmit}\n                                user={currentUser}\n                                tagged_message={message}\n                            />\n                        ) : (\n                            <ActivityMessage id={id} tagged_message={message} getUserProfileUrl={getUserProfileUrl} />\n                        )}\n                    </Media.Body>\n                </Media>\n                {/* $FlowFixMe */}\n                {error ? <ActivityError {...error} /> : null}\n            </SelectableActivityCard>\n            <TetherComponent {...tetherProps}>\n                {isMenuVisible && (\n                    <AnnotationActivityMenu\n                        canDelete={canDelete}\n                        canEdit={canEdit}\n                        className=\"bcs-AnnotationActivity-menu\"\n                        id={id}\n                        isDisabled={isConfirmingDelete}\n                        onDelete={handleDelete}\n                        onEdit={handleEdit}\n                        onMenuClose={handleMenuClose}\n                        onMenuOpen={handleMenuOpen}\n                    />\n                )}\n                {isConfirmingDelete && (\n                    <DeleteConfirmation\n                        data-resin-component={ACTIVITY_TARGETS.ANNOTATION_OPTIONS}\n                        isOpen={isConfirmingDelete}\n                        message={messages.annotationActivityDeletePrompt}\n                        onDeleteCancel={handleDeleteCancel}\n                        onDeleteConfirm={handleDeleteConfirm}\n                    />\n                )}\n            </TetherComponent>\n        </>\n    );\n};\n\nexport default AnnotationActivity;\n"],"file":"AnnotationActivity.js"}