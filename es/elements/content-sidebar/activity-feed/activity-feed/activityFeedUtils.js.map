{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/activity-feed/activityFeedUtils.js"],"names":["selectors","PLACEHOLDER_USER","VERSION_UPLOAD_ACTION","ItemTypes","fileVersion","collapseFeedState","feedState","reduce","collapsedFeedState","feedItem","previousFeedItem","pop","concat","type","getVersionAction","tmpModifiedBy","modified_by","versions","version_start","parseInt","version_number","version_end","prevModifiedBy","tmpCurModifiedBy","created_at","trashed_at","id","parsedVersionNumber","collaborators","modifiedBy","Math","min","max"],"mappings":";;;;;;AAAA;;;;AAKA,OAAOA,SAAP,MAAsB,mCAAtB;AACA,SAASC,gBAAT,EAA2BC,qBAA3B,QAAwD,uBAAxD;AAGA,OAAO,IAAMC,SAAS,GAAG;AACrBC,EAAAA,WAAW,EAAE;AADQ,CAAlB;AAIP,OAAO,SAASC,iBAAT,CAA2BC,SAA3B,EAA6D;AAChE,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAO,EAAP;AACH;;AAED,SAAOA,SAAS,CAACC,MAAV,CAAiB,UAACC,kBAAD,EAAqBC,QAArB,EAAkC;AACtD,QAAMC,gBAAgB,GAAGF,kBAAkB,CAACG,GAAnB,EAAzB;;AAEA,QAAI,CAACD,gBAAL,EAAuB;AACnB,aAAOF,kBAAkB,CAACI,MAAnB,CAA0B,CAACH,QAAD,CAA1B,CAAP;AACH;;AAED,QACIA,QAAQ,CAACI,IAAT,KAAkBV,SAAS,CAACC,WAA5B,IACAM,gBAAgB,CAACG,IAAjB,KAA0BV,SAAS,CAACC,WADpC,IAEAJ,SAAS,CAACc,gBAAV,CAA2BL,QAA3B,MAAyCP,qBAFzC,IAGAF,SAAS,CAACc,gBAAV,CAA2BJ,gBAA3B,MAAiDR,qBAJrD,EAKE;AAAA,UAEmBa,aAFnB,GAMML,gBANN,CAEMM,WAFN;AAAA,kCAMMN,gBANN,CAGMO,QAHN;AAAA,UAGMA,QAHN,sCAGiB,CAACP,gBAAD,CAHjB;AAAA,mCAMMA,gBANN,CAIMQ,aAJN;AAAA,UAIMA,aAJN,uCAIsBC,QAAQ,CAACT,gBAAgB,CAACU,cAAlB,EAAkC,EAAlC,CAJ9B;AAAA,mCAMMV,gBANN,CAKMW,WALN;AAAA,UAKMA,WALN,uCAKoBF,QAAQ,CAACT,gBAAgB,CAACU,cAAlB,EAAkC,EAAlC,CAL5B;AAQE,UAAME,cAAc,GAAGP,aAAa,IAAId,gBAAxC;AARF,UAUuBsB,gBAVvB,GAUwFd,QAVxF,CAUUO,WAVV;AAAA,UAUyCQ,UAVzC,GAUwFf,QAVxF,CAUyCe,UAVzC;AAAA,UAUqDC,UAVrD,GAUwFhB,QAVxF,CAUqDgB,UAVrD;AAAA,UAUiEC,EAVjE,GAUwFjB,QAVxF,CAUiEiB,EAVjE;AAAA,UAUqEN,cAVrE,GAUwFX,QAVxF,CAUqEW,cAVrE;AAWE,UAAMO,mBAAmB,GAAGR,QAAQ,CAACC,cAAD,EAAiB,EAAjB,CAApC;;AACA,UAAMQ,aAAa,GAAGlB,gBAAgB,CAACkB,aAAjB,wBACjBN,cAAc,CAACI,EADE,oBACQJ,cADR,EAAtB;;AAIA,UAAMO,UAAU,GAAGN,gBAAgB,IAAItB,gBAAvC,CAhBF,CAkBE;AACA;;AACA2B,MAAAA,aAAa,CAACC,UAAU,CAACH,EAAZ,CAAb,qBAAoCG,UAApC;AAEA,aAAOrB,kBAAkB,CAACI,MAAnB,CAA0B,CAC7B;AACIgB,QAAAA,aAAa,EAAbA,aADJ;AAEIJ,QAAAA,UAAU,EAAVA,UAFJ;AAGIR,QAAAA,WAAW,EAAEa,UAHjB;AAIIJ,QAAAA,UAAU,EAAVA,UAJJ;AAKIC,QAAAA,EAAE,EAAFA,EALJ;AAMIb,QAAAA,IAAI,EAAEV,SAAS,CAACC,WANpB;AAOIgB,QAAAA,cAAc,EAAdA,cAPJ;AAQIH,QAAAA,QAAQ,EAAEA,QAAQ,CAACL,MAAT,CAAgB,CAACH,QAAD,CAAhB,CARd;AASIS,QAAAA,aAAa,EAAEY,IAAI,CAACC,GAAL,CAASb,aAAT,EAAwBS,mBAAxB,CATnB;AAUIN,QAAAA,WAAW,EAAES,IAAI,CAACE,GAAL,CAASX,WAAT,EAAsBM,mBAAtB;AAVjB,OAD6B,CAA1B,CAAP;AAcH;;AAED,WAAOnB,kBAAkB,CAACI,MAAnB,CAA0B,CAACF,gBAAD,EAAmBD,QAAnB,CAA1B,CAAP;AACH,GAnDM,EAmDJ,EAnDI,CAAP;AAoDH","sourcesContent":["/**\n * @flow\n * @file Activity feed utility methods\n */\n\nimport selectors from '../../../common/selectors/version';\nimport { PLACEHOLDER_USER, VERSION_UPLOAD_ACTION } from '../../../../constants';\nimport type { FeedItems } from '../../../../common/types/feed';\n\nexport const ItemTypes = {\n    fileVersion: 'file_version',\n};\n\nexport function collapseFeedState(feedState: ?FeedItems): FeedItems {\n    if (!feedState) {\n        return [];\n    }\n\n    return feedState.reduce((collapsedFeedState, feedItem) => {\n        const previousFeedItem = collapsedFeedState.pop();\n\n        if (!previousFeedItem) {\n            return collapsedFeedState.concat([feedItem]);\n        }\n\n        if (\n            feedItem.type === ItemTypes.fileVersion &&\n            previousFeedItem.type === ItemTypes.fileVersion &&\n            selectors.getVersionAction(feedItem) === VERSION_UPLOAD_ACTION &&\n            selectors.getVersionAction(previousFeedItem) === VERSION_UPLOAD_ACTION\n        ) {\n            const {\n                modified_by: tmpModifiedBy,\n                versions = [previousFeedItem],\n                version_start = parseInt(previousFeedItem.version_number, 10),\n                version_end = parseInt(previousFeedItem.version_number, 10),\n            } = previousFeedItem;\n\n            const prevModifiedBy = tmpModifiedBy || PLACEHOLDER_USER;\n\n            const { modified_by: tmpCurModifiedBy, created_at, trashed_at, id, version_number } = feedItem;\n            const parsedVersionNumber = parseInt(version_number, 10);\n            const collaborators = previousFeedItem.collaborators || {\n                [prevModifiedBy.id]: { ...prevModifiedBy },\n            };\n\n            const modifiedBy = tmpCurModifiedBy || PLACEHOLDER_USER;\n\n            // add collaborators\n            // $FlowFixMe\n            collaborators[modifiedBy.id] = { ...modifiedBy };\n\n            return collapsedFeedState.concat([\n                {\n                    collaborators,\n                    created_at,\n                    modified_by: modifiedBy,\n                    trashed_at,\n                    id,\n                    type: ItemTypes.fileVersion,\n                    version_number,\n                    versions: versions.concat([feedItem]),\n                    version_start: Math.min(version_start, parsedVersionNumber),\n                    version_end: Math.max(version_end, parsedVersionNumber),\n                },\n            ]);\n        }\n\n        return collapsedFeedState.concat([previousFeedItem, feedItem]);\n    }, []);\n}\n"],"file":"activityFeedUtils.js"}