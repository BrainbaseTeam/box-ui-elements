{"version":3,"sources":["../../../../../src/elements/content-sidebar/activity-feed/comment/Comment.js"],"names":["React","classNames","noop","FormattedMessage","TetherComponent","Avatar","Media","MenuItem","IconTrash","IconPencil","ACTIVITY_TARGETS","DeleteConfirmation","ActivityTimestamp","UserLink","ActivityError","ActivityMessage","CommentForm","bdlGray80","PLACEHOLDER_USER","messages","Comment","isConfirmingDelete","isEditing","isInputOpen","props","id","onDelete","permissions","setState","text","hasMention","onEdit","commentFormSubmitHandler","created_by","created_at","isPending","error","tagged_message","translatedTaggedMessage","translations","currentUser","isDisabled","getAvatarUrl","getUserProfileUrl","getMentionWithQuery","mentionSelectorContacts","state","createdAtTimestamp","Date","getTime","createdByUser","canEdit","can_edit","canDelete","can_delete","isMenuVisible","to","attachment","COMMENT_OPTIONS","COMMENT_OPTIONS_EDIT","handleEditClick","commentEditMenuItem","COMMENT_OPTIONS_DELETE","handleDeleteClick","commentDeleteMenuItem","commentDeletePrompt","handleDeleteCancel","handleDeleteConfirm","PROFILE","name","handleUpdate","commentFormCancelHandler","commentFormFocusHandler","Component"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport { FormattedMessage } from 'react-intl';\nimport TetherComponent from 'react-tether';\nimport Avatar from '../Avatar';\nimport Media from '../../../../components/media';\nimport { MenuItem } from '../../../../components/menu';\nimport IconTrash from '../../../../icons/general/IconTrash';\nimport IconPencil from '../../../../icons/general/IconPencil';\nimport { ACTIVITY_TARGETS } from '../../../common/interactionTargets';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport UserLink from '../common/user-link';\nimport ActivityError from '../common/activity-error';\nimport ActivityMessage from '../common/activity-message';\nimport CommentForm from '../comment-form';\nimport { bdlGray80 } from '../../../../styles/variables';\nimport { PLACEHOLDER_USER } from '../../../../constants';\nimport messages from './messages';\nimport './Comment.scss';\n\ntype Props = {\n    created_at: string | number,\n    created_by: User,\n    currentUser?: User,\n    error?: ActionItemError,\n    getAvatarUrl: GetAvatarUrlCallback,\n    getMentionWithQuery?: Function,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    id: string,\n    isDisabled?: boolean,\n    isPending?: boolean,\n    mentionSelectorContacts?: SelectorItems,\n    modified_at?: string | number,\n    onDelete: ({ id: string, permissions?: BoxCommentPermission }) => any,\n    onEdit: (id: string, text: string, hasMention: boolean, permissions?: BoxCommentPermission) => any,\n    permissions?: BoxCommentPermission,\n    tagged_message: string,\n    translatedTaggedMessage?: string,\n    translations?: Translations,\n};\n\ntype State = {\n    isConfirmingDelete: boolean,\n    isEditing: boolean,\n    isInputOpen: boolean,\n};\n\nclass Comment extends React.Component<Props, State> {\n    static defaultProps = {\n        onDelete: noop,\n        onEdit: noop,\n    };\n\n    state = {\n        isConfirmingDelete: false,\n        isEditing: false,\n        isInputOpen: false,\n    };\n\n    handleDeleteConfirm = (): void => {\n        const { id, onDelete, permissions } = this.props;\n        onDelete({ id, permissions });\n    };\n\n    handleDeleteCancel = (): void => {\n        this.setState({ isConfirmingDelete: false });\n    };\n\n    handleDeleteClick = () => {\n        this.setState({ isConfirmingDelete: true });\n    };\n\n    handleEditClick = (): void => {\n        this.setState({ isEditing: true, isInputOpen: true });\n    };\n\n    commentFormFocusHandler = (): void => this.setState({ isInputOpen: true });\n\n    commentFormCancelHandler = (): void => this.setState({ isInputOpen: false, isEditing: false });\n\n    commentFormSubmitHandler = (): void => this.setState({ isInputOpen: false, isEditing: false });\n\n    handleUpdate = ({ id, text, hasMention }: { hasMention: boolean, id: string, text: string }): void => {\n        const { onEdit, permissions } = this.props;\n        onEdit(id, text, hasMention, permissions);\n        this.commentFormSubmitHandler();\n    };\n\n    render(): React.Node {\n        const {\n            created_by,\n            created_at,\n            permissions = {},\n            id,\n            isPending,\n            error,\n            tagged_message = '',\n            translatedTaggedMessage,\n            translations,\n            currentUser,\n            isDisabled,\n            getAvatarUrl,\n            getUserProfileUrl,\n            getMentionWithQuery,\n            mentionSelectorContacts,\n            onEdit,\n        } = this.props;\n        const { isConfirmingDelete, isEditing, isInputOpen } = this.state;\n        const createdAtTimestamp = new Date(created_at).getTime();\n        const createdByUser = created_by || PLACEHOLDER_USER;\n        const canEdit = onEdit !== noop && permissions.can_edit;\n        const canDelete = permissions.can_delete;\n        const isMenuVisible = (canDelete || canEdit) && !isPending;\n\n        return (\n            <div className=\"bcs-Comment\">\n                <Media\n                    className={classNames('bcs-Comment-media', {\n                        'bcs-is-pending': isPending || error,\n                    })}\n                >\n                    <Media.Figure>\n                        <Avatar getAvatarUrl={getAvatarUrl} user={createdByUser} />\n                    </Media.Figure>\n                    <Media.Body>\n                        {isMenuVisible && (\n                            <TetherComponent\n                                attachment=\"top right\"\n                                className=\"bcs-Comment-deleteConfirmationModal\"\n                                constraints={[{ to: 'scrollParent', attachment: 'together' }]}\n                                targetAttachment=\"bottom right\"\n                            >\n                                <Media.Menu\n                                    isDisabled={isConfirmingDelete}\n                                    data-testid=\"comment-actions-menu\"\n                                    menuProps={{\n                                        'data-resin-component': ACTIVITY_TARGETS.COMMENT_OPTIONS,\n                                    }}\n                                >\n                                    {canEdit && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_EDIT}\n                                            data-testid=\"edit-comment\"\n                                            onClick={this.handleEditClick}\n                                        >\n                                            <IconPencil color={bdlGray80} />\n                                            <FormattedMessage {...messages.commentEditMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                    {canDelete && (\n                                        <MenuItem\n                                            data-resin-target={ACTIVITY_TARGETS.COMMENT_OPTIONS_DELETE}\n                                            data-testid=\"delete-comment\"\n                                            onClick={this.handleDeleteClick}\n                                        >\n                                            <IconTrash color={bdlGray80} />\n                                            <FormattedMessage {...messages.commentDeleteMenuItem} />\n                                        </MenuItem>\n                                    )}\n                                </Media.Menu>\n                                {isConfirmingDelete && (\n                                    <DeleteConfirmation\n                                        data-resin-component={ACTIVITY_TARGETS.COMMENT_OPTIONS}\n                                        isOpen={isConfirmingDelete}\n                                        message={messages.commentDeletePrompt}\n                                        onDeleteCancel={this.handleDeleteCancel}\n                                        onDeleteConfirm={this.handleDeleteConfirm}\n                                    />\n                                )}\n                            </TetherComponent>\n                        )}\n                        <div className=\"bcs-Comment-headline\">\n                            <UserLink\n                                data-resin-target={ACTIVITY_TARGETS.PROFILE}\n                                id={createdByUser.id}\n                                name={createdByUser.name}\n                                getUserProfileUrl={getUserProfileUrl}\n                            />\n                        </div>\n                        <div>\n                            <ActivityTimestamp date={createdAtTimestamp} />\n                        </div>\n                        {isEditing ? (\n                            <CommentForm\n                                isDisabled={isDisabled}\n                                className={classNames('bcs-Comment-editor', {\n                                    'bcs-is-disabled': isDisabled,\n                                })}\n                                updateComment={this.handleUpdate}\n                                isOpen={isInputOpen}\n                                user={currentUser}\n                                onCancel={this.commentFormCancelHandler}\n                                onFocus={this.commentFormFocusHandler}\n                                isEditing={isEditing}\n                                entityId={id}\n                                tagged_message={tagged_message}\n                                getAvatarUrl={getAvatarUrl}\n                                mentionSelectorContacts={mentionSelectorContacts}\n                                getMentionWithQuery={getMentionWithQuery}\n                            />\n                        ) : (\n                            <ActivityMessage\n                                id={id}\n                                tagged_message={tagged_message}\n                                translatedTaggedMessage={translatedTaggedMessage}\n                                {...translations}\n                                translationFailed={error ? true : null}\n                                getUserProfileUrl={getUserProfileUrl}\n                            />\n                        )}\n                    </Media.Body>\n                </Media>\n                {error ? <ActivityError {...error} /> : null}\n            </div>\n        );\n    }\n}\n\nexport default Comment;\n"],"file":"Comment.js"}