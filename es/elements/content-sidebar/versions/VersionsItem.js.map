{"version":3,"sources":["../../../../src/elements/content-sidebar/versions/VersionsItem.js"],"names":["React","FormattedMessage","messages","selectors","sizeUtil","VersionsItemActions","VersionsItemButton","VersionsItemBadge","VersionsItemRetention","ReadableTime","FILE_REQUEST_NAME","VERSION_DELETE_ACTION","VERSION_PROMOTE_ACTION","VERSION_RESTORE_ACTION","VERSION_UPLOAD_ACTION","ACTION_MAP","versionDeletedBy","versionRestoredBy","versionPromotedBy","versionUploadedBy","FILE_EXTENSIONS_OFFICE","FIVE_MINUTES_MS","VersionsItem","fileId","isCurrent","isSelected","isWatermarked","onDelete","onDownload","onPreview","onPromote","onRestore","version","versionCount","versionLimit","createdAt","created_at","extension","versionId","id","is_download_available","permissions","restoredAt","restored_at","retention","size","trashedAt","trashed_at","versionNumber","version_number","versionPromoted","version_promoted","can_delete","can_download","can_preview","can_upload","retentionAppliedAt","applied_at","retentionDispositionAt","disposition_at","retentionDispositionAtDate","Date","versionAction","getVersionAction","versionInteger","parseInt","versionTime","versionTimestamp","getTime","versionUserName","getVersionUser","name","versionUserUnknown","versionDisplayName","fileRequestDisplayName","isDeleted","isDownloadable","isLimited","isOffice","includes","isRestricted","isRetained","canPreview","showDelete","showDownload","showPromote","showRestore","showPreview","hasActions","handleAction","handler","versionCurrent","versionLimitExceeded"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Versions Item component\n * @author Box\n */\n\nimport * as React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport messages from './messages';\nimport selectors from '../../common/selectors/version';\nimport sizeUtil from '../../../utils/size';\nimport VersionsItemActions from './VersionsItemActions';\nimport VersionsItemButton from './VersionsItemButton';\nimport VersionsItemBadge from './VersionsItemBadge';\nimport VersionsItemRetention from './VersionsItemRetention';\nimport { ReadableTime } from '../../../components/time';\nimport {\n    FILE_REQUEST_NAME,\n    VERSION_DELETE_ACTION,\n    VERSION_PROMOTE_ACTION,\n    VERSION_RESTORE_ACTION,\n    VERSION_UPLOAD_ACTION,\n} from '../../../constants';\nimport type { BoxItemVersion } from '../../../common/types/core';\nimport type { VersionActionCallback } from './flowTypes';\nimport './VersionsItem.scss';\n\ntype Props = {\n    fileId: string,\n    isCurrent?: boolean,\n    isSelected?: boolean,\n    isWatermarked?: boolean,\n    onDelete?: VersionActionCallback,\n    onDownload?: VersionActionCallback,\n    onPreview?: VersionActionCallback,\n    onPromote?: VersionActionCallback,\n    onRestore?: VersionActionCallback,\n    version: BoxItemVersion,\n    versionCount: number,\n    versionLimit: number,\n};\n\nconst ACTION_MAP = {\n    [VERSION_DELETE_ACTION]: messages.versionDeletedBy,\n    [VERSION_RESTORE_ACTION]: messages.versionRestoredBy,\n    [VERSION_PROMOTE_ACTION]: messages.versionPromotedBy,\n    [VERSION_UPLOAD_ACTION]: messages.versionUploadedBy,\n};\nconst FILE_EXTENSIONS_OFFICE = ['xlsb', 'xlsm', 'xlsx'];\nconst FIVE_MINUTES_MS = 5 * 60 * 1000;\n\nconst VersionsItem = ({\n    fileId,\n    isCurrent = false,\n    isSelected = false,\n    isWatermarked = false,\n    onDelete,\n    onDownload,\n    onPreview,\n    onPromote,\n    onRestore,\n    version,\n    versionCount,\n    versionLimit,\n}: Props) => {\n    const {\n        created_at: createdAt,\n        extension,\n        id: versionId,\n        is_download_available,\n        permissions = {},\n        restored_at: restoredAt,\n        retention,\n        size,\n        trashed_at: trashedAt,\n        version_number: versionNumber,\n        version_promoted: versionPromoted,\n    } = version;\n    const { can_delete, can_download, can_preview, can_upload } = permissions;\n    const { applied_at: retentionAppliedAt, disposition_at: retentionDispositionAt } = retention || {};\n    const retentionDispositionAtDate = retentionDispositionAt && new Date(retentionDispositionAt);\n\n    // Version info helpers\n    const versionAction = selectors.getVersionAction(version);\n    const versionInteger = versionNumber ? parseInt(versionNumber, 10) : 1;\n    const versionTime = restoredAt || trashedAt || createdAt;\n    const versionTimestamp = versionTime && new Date(versionTime).getTime();\n    const versionUserName = selectors.getVersionUser(version).name || (\n        <FormattedMessage {...messages.versionUserUnknown} />\n    );\n    const versionDisplayName =\n        versionUserName !== FILE_REQUEST_NAME ? (\n            versionUserName\n        ) : (\n            <FormattedMessage {...messages.fileRequestDisplayName} />\n        );\n    // Version state helpers\n    const isDeleted = versionAction === VERSION_DELETE_ACTION;\n    const isDownloadable = !!is_download_available;\n    const isLimited = versionCount - versionInteger >= versionLimit;\n    const isOffice = FILE_EXTENSIONS_OFFICE.includes(extension);\n    const isRestricted = (isOffice || isWatermarked) && !isCurrent;\n    const isRetained = !!retentionAppliedAt && (!retentionDispositionAtDate || retentionDispositionAtDate > new Date());\n\n    // Version action helpers\n    const canPreview = can_preview && !isDeleted && !isLimited && !isRestricted;\n    const showDelete = can_delete && !isDeleted && !isCurrent;\n    const showDownload = can_download && !isDeleted && isDownloadable;\n    const showPromote = can_upload && !isDeleted && !isCurrent;\n    const showRestore = can_delete && isDeleted;\n    const showPreview = canPreview && !isSelected;\n    const hasActions = showDelete || showDownload || showPreview || showPromote || showRestore;\n\n    // Version action callback helper\n    const handleAction = (handler?: VersionActionCallback) => (): void => {\n        if (handler) {\n            handler(versionId);\n        }\n    };\n\n    return (\n        <div className=\"bcs-VersionsItem\">\n            <VersionsItemButton\n                fileId={fileId}\n                isCurrent={isCurrent}\n                isDisabled={!canPreview}\n                isSelected={isSelected}\n                onClick={handleAction(onPreview)}\n            >\n                <div className=\"bcs-VersionsItem-badge\">\n                    <VersionsItemBadge versionNumber={versionNumber} />\n                </div>\n\n                <div className=\"bcs-VersionsItem-details\">\n                    {isCurrent && (\n                        <div className=\"bcs-VersionsItem-current\">\n                            <FormattedMessage {...messages.versionCurrent} />\n                        </div>\n                    )}\n\n                    <div className=\"bcs-VersionsItem-log\" data-testid=\"bcs-VersionsItem-log\" title={versionDisplayName}>\n                        <FormattedMessage\n                            {...ACTION_MAP[versionAction]}\n                            values={{ name: versionDisplayName, versionPromoted }}\n                        />\n                    </div>\n\n                    <div className=\"bcs-VersionsItem-info\">\n                        {versionTimestamp && (\n                            <time className=\"bcs-VersionsItem-date\" dateTime={versionTime}>\n                                <ReadableTime\n                                    alwaysShowTime\n                                    relativeThreshold={FIVE_MINUTES_MS}\n                                    timestamp={versionTimestamp}\n                                />\n                            </time>\n                        )}\n                        {!!size && <span className=\"bcs-VersionsItem-size\">{sizeUtil(size)}</span>}\n                    </div>\n\n                    {isRetained && (\n                        <div className=\"bcs-VersionsItem-retention\">\n                            <VersionsItemRetention retention={retention} />\n                        </div>\n                    )}\n\n                    {isLimited && hasActions && (\n                        <div className=\"bcs-VersionsItem-footer\">\n                            <FormattedMessage {...messages.versionLimitExceeded} values={{ versionLimit }} />\n                        </div>\n                    )}\n                </div>\n            </VersionsItemButton>\n\n            {!isLimited && hasActions && (\n                <VersionsItemActions\n                    fileId={fileId}\n                    isCurrent={isCurrent}\n                    isRetained={isRetained}\n                    onDelete={handleAction(onDelete)}\n                    onDownload={handleAction(onDownload)}\n                    onPreview={handleAction(onPreview)}\n                    onPromote={handleAction(onPromote)}\n                    onRestore={handleAction(onRestore)}\n                    showDelete={showDelete}\n                    showDownload={showDownload}\n                    showPreview={showPreview}\n                    showPromote={showPromote}\n                    showRestore={showRestore}\n                />\n            )}\n        </div>\n    );\n};\nexport default VersionsItem;\n"],"file":"VersionsItem.js"}