{"version":3,"sources":["../../../src/elements/content-preview/ContentPreview.js"],"names":["React","classNames","uniqueid","throttle","cloneDeep","omit","getProp","flow","noop","setProp","Measure","withRouter","decode","makeResponsive","withNavRouter","Internationalize","AsyncLoad","TokenService","isInputElement","focus","getTypedFileId","withErrorBoundary","withLogger","PREVIEW_FIELDS_TO_FETCH","mark","withFeatureProvider","EVENT_JS_READY","ReloadNotification","API","PreviewHeader","PreviewMask","PreviewNavigation","withAnnotations","WithAnnotationsProps","withAnnotatorContext","WithAnnotatorContextProps","DEFAULT_HOSTNAME_API","DEFAULT_HOSTNAME_APP","DEFAULT_HOSTNAME_STATIC","DEFAULT_PREVIEW_VERSION","DEFAULT_LOCALE","DEFAULT_PATH_STATIC_PREVIEW","CLIENT_NAME_CONTENT_PREVIEW","ORIGIN_PREVIEW","ORIGIN_CONTENT_PREVIEW","ERROR_CODE_UNKNOWN","startAtTypes","page","InvalidIdError","Error","PREVIEW_LOAD_METRIC_EVENT","MARK_NAME_JS_READY","LoadableSidebar","loader","ContentPreview","props","createRef","canPrint","error","undefined","isLoading","isReloadNotificationVisible","isThumbnailSidebarOpen","rest","code","onError","setState","previewMetrics","logger","event_name","metrics","totalFetchFileTime","getTotalFileFetchTime","totalTime","value","file_info_time","onPreviewMetric","data","onLoad","collection","currentIndex","getFileIndex","filesToPrefetch","slice","previewTimeMetrics","loadData","totalPreviewMetrics","addFetchFileTimeToPreviewMetrics","time","focusPreview","preview","length","prefetch","handleCanPrint","annotatorState","activeAnnotationId","enableThumbnailsSidebar","fileOptions","onAnnotatorEvent","onAnnotator","previewExperiences","showAnnotationsControls","tokenOrTokenFunction","token","state","file","selectedVersion","startAt","isPreviewLibraryLoaded","fileId","getFileId","currentFileId","fileOpts","typedId","getReadTokens","id","previewOptions","container","header","headerElement","experiences","showAnnotations","canViewAnnotations","showDownload","canDownload","showLoading","showProgress","skipServerUpdate","useHotkeys","Preview","global","Box","addListener","onPreviewLoad","onPreviewError","updateFileCache","show","Object","keys","stagedFile","initialState","getCurrentViewer","resize","fetchFileEndTime","performance","now","currentFile","isExistingFile","isWatermarked","file_version","sha1","fileError","errorCode","message","getPreview","viewer","isLoaded","isDestroyed","newIndex","navigateToIndex","onDownload","download","print","getViewer","isPreviewing","CLASS_NAVIGATION_VISIBILITY","clearTimeout","mouseMoveTimeoutID","previewContainer","classList","remove","allowNavigationArrows","add","setTimeout","event","consumed","key","target","onKeydown","nativeEvent","navigateLeft","navigateRight","preventDefault","stopPropagation","version","additionalVersionInfo","onVersionChange","updateVersionToCurrent","location","annotationFileVersionId","currentFileVersionId","currentPreviewFileVersionId","unit","type","emit","apiHost","cache","language","requestInterceptor","responseInterceptor","sharedLink","sharedLinkPassword","api","clientName","prevFileIdProp","onReadyMetric","endMarkName","destroy","destroyPreview","shouldReset","onPreviewDestroy","removeAllListeners","loadStylesheet","loadScript","fetchFile","prevProps","prevState","prevPreviewExperiences","prevToken","hasFileIdChanged","hasTokenChanged","haveExperiencesChanged","shouldLoadPreview","loadPreview","updatePreviewToken","updateExperiences","shouldReload","updateToken","prevFile","prevSelectedVersion","prevSelectedVersionId","selectedVersionId","prevFileVersionId","fileVersionId","isPreviousCurrent","isSelectedCurrent","asset","staticHost","staticPath","previewLibraryVersion","path","suffix","endsWith","document","head","url","getBasePath","querySelector","link","createElement","rel","href","appendChild","previewScript","script","src","addEventListener","autoFocus","getInnerRef","activeElement","files","typedIds","map","cacheTokens","forEach","refreshCache","fetchFileStartTime","Math","round","rendering","conversion","preload","totalConversion","totalRendering","totalPreload","total","isFileDownloadable","isFileAnnotatable","hasViewAllPermissions","hasViewSelfPermissions","canAnnotate","successCallback","errorCallback","fetchOptions","getFileAPI","getFile","fetchFileSuccessCallback","fetchFileErrorCallback","fields","findIndex","item","index","onNavigate","fileOrId","contentSidebar","current","refresh","messages","className","contentSidebarProps","contentOpenWithProps","hasHeader","history","isLarge","isVeryLarge","logoUrl","onClose","measureRef","styleClassName","currentExtension","currentVersionId","onHeaderClose","onKeyDown","onMouseMove","containerRef","onResize","previewRef","getCache","handleAnnotationSelect","closeReloadNotification","loadFileFromStage","PureComponent","appHost","ContentPreviewComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;AAMA,OAAO,6BAAP;AACA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,SAAP,MAAsB,kBAAtB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,OAAP,MAAoB,YAApB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,OAAP,MAAoB,YAApB;AACA,OAAOC,OAAP,MAAoB,eAApB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,SAASC,MAAT,QAAuB,kBAAvB;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,SAASC,aAAT,QAA8B,sBAA9B;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,SAASC,cAAT,EAAyBC,KAAzB,QAAsC,iBAAtC;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,iBAAT,QAAkC,0BAAlC;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,uBAAT,QAAwC,oBAAxC;AACA,SAASC,IAAT,QAAqB,yBAArB;AACA,SAASC,mBAAT,QAAoC,4BAApC;AACA,SAASC,cAAT,QAA+B,4BAA/B;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,GAAP,MAAgB,WAAhB;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,SACIC,eADJ,EAEIC,oBAFJ,EAGIC,oBAHJ,EAIIC,yBAJJ,QAKO,6BALP;AAMA,SACIC,oBADJ,EAEIC,oBAFJ,EAGIC,uBAHJ,EAIIC,uBAJJ,EAKIC,cALJ,EAMIC,2BANJ,EAOIC,2BAPJ,EAQIC,cARJ,EASIC,sBATJ,EAUIC,kBAVJ,QAWO,iBAXP;AAsBA,OAAO,sBAAP;AACA,OAAO,qBAAP;AACA,OAAO,uBAAP;AAuGA,IAAMC,YAAY,GAAG;AACjBC,EAAAA,IAAI,EAAE;AADW,CAArB;AAGA,IAAMC,cAAc,GAAG,IAAIC,KAAJ,CAAU,yBAAV,CAAvB;AACA,IAAMC,yBAAyB,GAAG,MAAlC;AACA,IAAMC,kBAAkB,aAAMP,sBAAN,cAAgClB,cAAhC,CAAxB;AAEAF,IAAI,CAAC2B,kBAAD,CAAJ;AAEA,IAAMC,eAAe,GAAGpC,SAAS,CAAC;AAC9BqC,EAAAA,MAAM,EAAE;AAAA,WAAM;AAAO;AAA+D,wBAAtE,CAAN;AAAA;AADsB,CAAD,CAAjC;;IAIMC,c;;;;;AAWF;;AA0DA;;;;;AAKA,0BAAYC,KAAZ,EAA0B;AAAA;;AAAA;;AACtB,wFAAMA,KAAN;;AADsB,qEA9DkCvD,KAAK,CAACwD,SAAN,EA8DlC;;AAAA,mEAlDJ;AAClBC,MAAAA,QAAQ,EAAE,KADQ;AAElBC,MAAAA,KAAK,EAAEC,SAFW;AAGlBC,MAAAA,SAAS,EAAE,IAHO;AAIlBC,MAAAA,2BAA2B,EAAE,KAJX;AAKlBC,MAAAA,sBAAsB,EAAE;AALN,KAkDI;;AAAA,qEA+TT,gBAAmD;AAAA,UAAhDJ,KAAgD,QAAhDA,KAAgD;AAAA,UAAtCK,IAAsC;;AAAA,wBAC1BL,KAD0B,CACxDM,IADwD;AAAA,UACxDA,IADwD,4BACjDnB,kBADiD;AAAA,UAExDoB,OAFwD,GAE5C,MAAKV,KAFuC,CAExDU,OAFwD,EAIhE;;AACA,YAAKC,QAAL,CAAc;AAAEN,QAAAA,SAAS,EAAE,KAAb;AAAoBE,QAAAA,sBAAsB,EAAE;AAA5C,OAAd;;AAEAG,MAAAA,OAAO,CACHP,KADG,EAEHM,IAFG,oBAIID,IAJJ;AAKCL,QAAAA,KAAK,EAALA;AALD,UAOHf,cAPG,CAAP;AASH,KA/UyB;;AAAA,sEAuVR,UAACwB,cAAD,EAA0C;AAAA,UAChDC,MADgD,GACrC,MAAKb,KADgC,CAChDa,MADgD;AAAA,UAEhDC,UAFgD,GAEjCF,cAFiC,CAEhDE,UAFgD;;AAGxD,UAAIC,OAAO,qBACJH,cADI,CAAX,CAHwD,CAOxD;AACA;;;AACA,UAAIE,UAAU,KAAKnB,yBAAnB,EAA8C;AAC1C,YAAMqB,kBAAkB,GAAG,MAAKC,qBAAL,EAA3B;;AACA,YAAMC,SAAS,GAAG,CAACN,cAAc,CAACO,KAAf,IAAwB,CAAzB,IAA8BH,kBAAhD,CAF0C,CAI1C;;AACA,YAAI,CAACE,SAAL,EAAgB;AACZ;AACH;;AAEDH,QAAAA,OAAO,qBACAH,cADA;AAEHQ,UAAAA,cAAc,EAAEJ,kBAFb;AAGHG,UAAAA,KAAK,EAAED;AAHJ,UAAP;AAKH;;AAEDL,MAAAA,MAAM,CAACQ,eAAP,CAAuBN,OAAvB;AACH,KAjXyB;;AAAA,oEA6ZV,UAACO,IAAD,EAAwB;AAAA,wBACE,MAAKtB,KADP;AAAA,UAC5BuB,MAD4B,eAC5BA,MAD4B;AAAA,UACpBC,UADoB,eACpBA,UADoB;;AAEpC,UAAMC,YAAY,GAAG,MAAKC,YAAL,EAArB;;AACA,UAAMC,eAAe,GAAGH,UAAU,CAACI,KAAX,CAAiBH,YAAY,GAAG,CAAhC,EAAmCA,YAAY,GAAG,CAAlD,CAAxB;AACA,UAAMI,kBAAkB,GAAG9E,OAAO,CAACuE,IAAD,EAAO,cAAP,CAAlC;AACA,UAAIQ,QAAQ,GAAGR,IAAf;;AAEA,UAAIO,kBAAJ,EAAwB;AACpB,YAAME,mBAAmB,GAAG,MAAKC,gCAAL,CAAsCH,kBAAtC,CAA5B;;AACAC,QAAAA,QAAQ,qBACDA,QADC;AAEJf,UAAAA,OAAO,oBACAe,QAAQ,CAACf,OADT;AAEHkB,YAAAA,IAAI,EAAEF;AAFH;AAFH,UAAR;AAOH;;AAEDR,MAAAA,MAAM,CAACO,QAAD,CAAN;;AAEA,YAAKnB,QAAL,CAAc;AAAEN,QAAAA,SAAS,EAAE;AAAb,OAAd;;AACA,YAAK6B,YAAL;;AAEA,UAAI,MAAKC,OAAL,IAAgBR,eAAe,CAACS,MAApC,EAA4C;AACxC,cAAKC,QAAL,CAAcV,eAAd;AACH;;AAED,YAAKW,cAAL;AACH,KAzbyB;;AAAA;AAAA;AAAA;AAAA;AAAA,4BA2eZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,6BAWC,MAAKtC,KAXN,uCAENuC,cAFM;AAAA,yEAEmC,EAFnC;AAEYC,cAAAA,kBAFZ,yBAEYA,kBAFZ,EAGNC,uBAHM,gBAGNA,uBAHM,EAINC,WAJM,gBAINA,WAJM,EAKNC,gBALM,gBAKNA,gBALM,EAMNC,WANM,gBAMNA,WANM,EAONC,kBAPM,gBAONA,kBAPM,EAQNC,uBARM,gBAQNA,uBARM,EASCC,oBATD,gBASNC,KATM,EAUHxC,IAVG;AAAA,4BAYwC,MAAKyC,KAZ7C,EAYFC,IAZE,eAYFA,IAZE,EAYIC,eAZJ,eAYIA,eAZJ,EAYqBC,OAZrB,eAYqBA,OAZrB;;AAAA,oBAcN,CAAC,MAAKC,sBAAL,EAAD,IAAkC,CAACH,IAAnC,IAA2C,CAACH,oBAdtC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAkBJO,cAAAA,MAlBI,GAkBK,MAAKC,SAAL,CAAeL,IAAf,CAlBL;;AAAA,oBAoBNI,MAAM,KAAK,MAAKL,KAAL,CAAWO,aApBhB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAwBJC,cAAAA,QAxBI,qBAwBYf,WAxBZ;;AAyBJM,cAAAA,KAzBI,GAyBI,SAARA,KAAQ,CAAAU,OAAO;AAAA,uBAAIhG,YAAY,CAACiG,aAAb,CAA2BD,OAA3B,EAAoCX,oBAApC,CAAJ;AAAA,eAzBX;;AA2BV,kBAAII,eAAJ,EAAqB;AACjBjG,gBAAAA,OAAO,CAACuG,QAAD,EAAW,CAACH,MAAD,EAAS,eAAT,CAAX,EAAsCH,eAAe,CAACS,EAAtD,CAAP;AACA1G,gBAAAA,OAAO,CAACuG,QAAD,EAAW,CAACH,MAAD,EAAS,sBAAT,CAAX,EAA6CvG,OAAO,CAACmG,IAAD,EAAO,iBAAP,CAApD,CAAP;AACH;;AAED,kBAAIV,kBAAJ,EAAwB;AACpBtF,gBAAAA,OAAO,CAACuG,QAAD,EAAW,CAACH,MAAD,EAAS,aAAT,EAAwB,UAAxB,CAAX,EAAgDd,kBAAhD,CAAP;AACH;;AAED,kBAAIY,OAAJ,EAAa;AACTlG,gBAAAA,OAAO,CAACuG,QAAD,EAAW,CAACH,MAAD,EAAS,SAAT,CAAX,EAAgCF,OAAhC,CAAP;AACH;;AAEKS,cAAAA,cAxCI,GAwCa;AACnBC,gBAAAA,SAAS,aAAM,MAAKF,EAAX,mBADU;AAEnBnB,gBAAAA,uBAAuB,EAAvBA,uBAFmB;AAGnBC,gBAAAA,WAAW,EAAEe,QAHM;AAInBM,gBAAAA,MAAM,EAAE,MAJW;AAKnBC,gBAAAA,aAAa,aAAM,MAAKJ,EAAX,yBALM;AAMnBK,gBAAAA,WAAW,EAAEpB,kBANM;AAOnBqB,gBAAAA,eAAe,EAAE,MAAKC,kBAAL,EAPE;AAQnBrB,gBAAAA,uBAAuB,EAAvBA,uBARmB;AASnBsB,gBAAAA,YAAY,EAAE,MAAKC,WAAL,EATK;AAUnBC,gBAAAA,WAAW,EAAE,KAVM;AAWnBC,gBAAAA,YAAY,EAAE,KAXK;AAYnBC,gBAAAA,gBAAgB,EAAE,IAZC;AAanBC,gBAAAA,UAAU,EAAE;AAbO,eAxCb;AAuDFC,cAAAA,OAvDE,GAuDUC,MAAM,CAACC,GAvDjB,CAuDFF,OAvDE;AAwDV,oBAAKvC,OAAL,GAAe,IAAIuC,OAAJ,EAAf;;AACA,oBAAKvC,OAAL,CAAa0C,WAAb,CAAyB,MAAzB,EAAiC,MAAKC,aAAtC;;AACA,oBAAK3C,OAAL,CAAa0C,WAAb,CAAyB,eAAzB,EAA0C,MAAKE,cAA/C;;AACA,oBAAK5C,OAAL,CAAa0C,WAAb,CAAyB,gBAAzB,EAA2C,MAAKxD,eAAhD;;AACA,oBAAKc,OAAL,CAAa0C,WAAb,CAAyB,gBAAzB,EAA2C;AAAA,uBAAM,MAAKlE,QAAL,CAAc;AAAEJ,kBAAAA,sBAAsB,EAAE;AAA1B,iBAAd,CAAN;AAAA,eAA3C;;AACA,oBAAK4B,OAAL,CAAa0C,WAAb,CAAyB,iBAAzB,EAA4C;AAAA,uBAAM,MAAKlE,QAAL,CAAc;AAAEJ,kBAAAA,sBAAsB,EAAE;AAA1B,iBAAd,CAAN;AAAA,eAA5C;;AAEA,kBAAIuC,uBAAJ,EAA6B;AACzB,sBAAKX,OAAL,CAAa0C,WAAb,CAAyB,kBAAzB,EAA6CjC,WAA7C;AACH;;AAED,oBAAKT,OAAL,CAAa6C,eAAb,CAA6B,CAAC9B,IAAD,CAA7B;;AACA,oBAAKf,OAAL,CAAa8C,IAAb,CAAkB/B,IAAI,CAACU,EAAvB,EAA2BZ,KAA3B,oBACOa,cADP,MAEO/G,IAAI,CAAC0D,IAAD,EAAO0E,MAAM,CAACC,IAAP,CAAYtB,cAAZ,CAAP,CAFX;;AApEU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA3eY;;AAAA,wEA0jBN,YAAM;AACtB,UAAI,MAAKuB,UAAT,EAAqB;AACjB,cAAKzE,QAAL,mBAAmB,MAAK0E,YAAxB;AAAsCnC,UAAAA,IAAI,EAAE,MAAKkC;AAAjD,YAA+D,YAAM;AACjE,gBAAKA,UAAL,GAAkBhF,SAAlB;AACH,SAFD;AAGH;AACJ,KAhkByB;;AAAA,8EAukBA,YAAM;AAC5B,YAAKO,QAAL,CAAc;AAAEL,QAAAA,2BAA2B,EAAE;AAA/B,OAAd;AACH,KAzkByB;;AAAA,+DAglBf,YAAY;AACnB,UAAI,MAAK6B,OAAL,IAAgB,MAAKA,OAAL,CAAamD,gBAAb,EAApB,EAAqD;AACjD,cAAKnD,OAAL,CAAaoD,MAAb;AACH;AACJ,KAplByB;;AAAA,+EA4lBC,UAACrC,IAAD,EAAyB;AAChD,YAAKsC,gBAAL,GAAwBC,WAAW,CAACC,GAAZ,EAAxB;AADgD,UAGlCC,WAHkC,GAGX,MAAK1C,KAHM,CAGxCC,IAHwC;AAIhD,UAAM0C,cAAc,GAAGD,WAAW,GAAGA,WAAW,CAAC/B,EAAZ,KAAmBV,IAAI,CAACU,EAA3B,GAAgC,KAAlE;AACA,UAAMiC,aAAa,GAAG9I,OAAO,CAACmG,IAAD,EAAO,+BAAP,EAAwC,KAAxC,CAA7B,CALgD,CAOhD;AACA;;AACA,UAAI2C,aAAa,IAAI,CAACD,cAAtB,EAAsC;AAClC,cAAKjF,QAAL,mBAAmB,MAAK0E,YAAxB;AAAsCnC,UAAAA,IAAI,EAAJA;AAAtC,YADkC,CAElC;;AACH,OAHD,MAGO,IAAIyC,WAAW,CAACG,YAAZ,CAAyBC,IAAzB,KAAkC7C,IAAI,CAAC4C,YAAL,CAAkBC,IAAxD,EAA8D;AACjE;AACA;AACA,cAAKX,UAAL,GAAkBlC,IAAlB;;AACA,cAAKvC,QAAL,mBACO,MAAK0E,YADZ;AAEI/E,UAAAA,2BAA2B,EAAE;AAFjC;AAIH;AACJ,KAjnByB;;AAAA,6EAwnBD,UAAC0F,SAAD,EAA8BvF,IAA9B,EAAqD;AAAA,UAClEC,OADkE,GACtD,MAAKV,KADiD,CAClEU,OADkE;AAE1E,UAAMuF,SAAS,GAAGD,SAAS,CAACvF,IAAV,IAAkBA,IAApC;AACA,UAAMN,KAAK,GAAG;AACVM,QAAAA,IAAI,EAAEwF,SADI;AAEVC,QAAAA,OAAO,EAAEF,SAAS,CAACE;AAFT,OAAd;;AAIA,YAAKvF,QAAL,CAAc;AAAER,QAAAA,KAAK,EAALA,KAAF;AAAS+C,QAAAA,IAAI,EAAE9C,SAAf;AAA0BC,QAAAA,SAAS,EAAE;AAArC,OAAd;;AACAK,MAAAA,OAAO,CAACsF,SAAD,EAAYC,SAAZ,EAAuB;AAC1B9F,QAAAA,KAAK,EAAE6F;AADmB,OAAvB,CAAP;AAGH,KAnoByB;;AAAA,iEA6qBb,YAAW;AAAA,UACZ9C,IADY,GACI,MAAKD,KADT,CACZC,IADY;;AAEpB,UAAI,CAAC,MAAKf,OAAN,IAAiB,CAACe,IAAtB,EAA4B;AACxB,eAAO,IAAP;AACH;;AAED,aAAO,MAAKf,OAAZ;AACH,KAprByB;;AAAA,gEA4rBd,YAAW;AACnB,UAAMA,OAAO,GAAG,MAAKgE,UAAL,EAAhB;;AACA,UAAMC,MAAM,GAAGjE,OAAO,GAAGA,OAAO,CAACmD,gBAAR,EAAH,GAAgC,IAAtD;AACA,aAAOc,MAAM,IAAIA,MAAM,CAACC,QAAP,EAAV,IAA+B,CAACD,MAAM,CAACE,WAAP,EAAhC,GAAuDF,MAAvD,GAAgE,IAAvE;AACH,KAhsByB;;AAAA,mEAyvBX,YAAM;AACjB,UAAM3E,YAAY,GAAG,MAAKC,YAAL,EAArB;;AACA,UAAM6E,QAAQ,GAAG9E,YAAY,KAAK,CAAjB,GAAqB,CAArB,GAAyBA,YAAY,GAAG,CAAzD;;AACA,UAAI8E,QAAQ,KAAK9E,YAAjB,EAA+B;AAC3B,cAAK+E,eAAL,CAAqBD,QAArB;AACH;AACJ,KA/vByB;;AAAA,oEAuwBV,YAAM;AAAA,UACV/E,UADU,GACY,MAAKxB,KADjB,CACVwB,UADU;;AAElB,UAAMC,YAAY,GAAG,MAAKC,YAAL,EAArB;;AACA,UAAM6E,QAAQ,GAAG9E,YAAY,KAAKD,UAAU,CAACY,MAAX,GAAoB,CAArC,GAAyCZ,UAAU,CAACY,MAAX,GAAoB,CAA7D,GAAiEX,YAAY,GAAG,CAAjG;;AACA,UAAI8E,QAAQ,KAAK9E,YAAjB,EAA+B;AAC3B,cAAK+E,eAAL,CAAqBD,QAArB;AACH;AACJ,KA9wByB;;AAAA,+DAsxBf,YAAM;AAAA,UACLE,UADK,GACiB,MAAKzG,KADtB,CACLyG,UADK;AAAA,UAELvD,IAFK,GAEW,MAAKD,KAFhB,CAELC,IAFK;;AAGb,UAAI,MAAKf,OAAT,EAAkB;AACd,cAAKA,OAAL,CAAauE,QAAb;;AACAD,QAAAA,UAAU,CAAC5J,SAAS,CAACqG,IAAD,CAAV,CAAV;AACH;AACJ,KA7xByB;;AAAA,4DAqyBlB,YAAM;AACV,UAAI,MAAKf,OAAT,EAAkB;AACd,cAAKA,OAAL,CAAawE,KAAb;AACH;AACJ,KAzyByB;;AAAA,kEAizBZ/J,QAAQ,CAAC,YAAM;AACzB,UAAMwJ,MAAM,GAAG,MAAKQ,SAAL,EAAf;;AACA,UAAMC,YAAY,GAAG,CAAC,CAACT,MAAvB;AACA,UAAMU,2BAA2B,GAAG,qBAApC;AAEAC,MAAAA,YAAY,CAAC,MAAKC,kBAAN,CAAZ;;AAEA,UAAI,CAAC,MAAKC,gBAAV,EAA4B;AACxB;AACH,OATwB,CAWzB;;;AACA,YAAKA,gBAAL,CAAsBC,SAAtB,CAAgCC,MAAhC,CAAuCL,2BAAvC,EAZyB,CAczB;AACA;AACA;AACA;;;AACA,UAAI,MAAKG,gBAAL,KAA0B,CAACJ,YAAD,IAAiBT,MAAM,CAACgB,qBAAP,EAA3C,CAAJ,EAAgF;AAC5E,cAAKH,gBAAL,CAAsBC,SAAtB,CAAgCG,GAAhC,CAAoCP,2BAApC;AACH;;AAED,YAAKE,kBAAL,GAA0BM,UAAU,CAAC,YAAM;AACvC,YAAI,MAAKL,gBAAT,EAA2B;AACvB,gBAAKA,gBAAL,CAAsBC,SAAtB,CAAgCC,MAAhC,CAAuCL,2BAAvC;AACH;AACJ,OAJmC,EAIjC,IAJiC,CAApC;AAKH,KA3BqB,EA2BnB,IA3BmB,CAjzBI;;AAAA,gEAm1Bd,UAACS,KAAD,EAAgD;AAAA,UAChD9C,UADgD,GAC1B,MAAKzE,KADqB,CAChDyE,UADgD;;AAExD,UAAI,CAACA,UAAL,EAAiB;AACb;AACH;;AAED,UAAI+C,QAAQ,GAAG,KAAf;AACA,UAAMC,GAAG,GAAGpK,MAAM,CAACkK,KAAD,CAAlB;;AACA,UAAMnB,MAAM,GAAG,MAAKQ,SAAL,EAAf,CARwD,CAUxD;AACA;;;AACA,UAAI,CAACa,GAAD,IAAQ,CAACrB,MAAT,IAAmBzI,cAAc,CAAC4J,KAAK,CAACG,MAAP,CAArC,EAAqD;AACjD;AACH;;AAED,UAAI,OAAOtB,MAAM,CAACuB,SAAd,KAA4B,UAAhC,EAA4C;AACxCH,QAAAA,QAAQ,GAAG,CAAC,CAACpB,MAAM,CAACuB,SAAP,CAAiBF,GAAjB,EAAsBF,KAAK,CAACK,WAA5B,CAAb;AACH;;AAED,UAAI,CAACJ,QAAL,EAAe;AACX,gBAAQC,GAAR;AACI,eAAK,WAAL;AACI,kBAAKI,YAAL;;AACAL,YAAAA,QAAQ,GAAG,IAAX;AACA;;AACJ,eAAK,YAAL;AACI,kBAAKM,aAAL;;AACAN,YAAAA,QAAQ,GAAG,IAAX;AACA;;AACJ,kBATJ,CAUI;;AAVJ;AAYH;;AAED,UAAIA,QAAJ,EAAc;AACVD,QAAAA,KAAK,CAACQ,cAAN;AACAR,QAAAA,KAAK,CAACS,eAAN;AACH;AACJ,KA13ByB;;AAAA,sEAk4BR,UAACC,OAAD,EAAuF;AAAA,UAA5DC,qBAA4D,uEAAb,EAAa;AAAA,UAC7FC,eAD6F,GAClE,MAAKnI,KAD6D,CAC7FmI,eAD6F;AAErG,YAAKC,sBAAL,GAA8BF,qBAAqB,CAACE,sBAApD;AAEAD,MAAAA,eAAe,CAACF,OAAD,EAAUC,qBAAV,CAAf;;AACA,YAAKvH,QAAL,CAAc;AACVwC,QAAAA,eAAe,EAAE8E;AADP,OAAd;AAGH,KA14ByB;;AAAA,6EA44BD,iBAA8C;AAAA,UAA3CnC,YAA2C,SAA3CA,YAA2C;AAAA,UAA7BlC,EAA6B,SAA7BA,EAA6B;AAAA,UAAzB8D,MAAyB,SAAzBA,MAAyB;AAAA,6BACzCA,MADyC,CAC3DW,QAD2D;AAAA,UAC3DA,QAD2D,iCAChD,EADgD;AAAA,yBAEjC,MAAKpF,KAF4B;AAAA,UAE3DC,IAF2D,gBAE3DA,IAF2D;AAAA,UAErDC,eAFqD,gBAErDA,eAFqD;AAGnE,UAAMmF,uBAAuB,GAAGvL,OAAO,CAAC+I,YAAD,EAAe,IAAf,CAAvC;AACA,UAAMyC,oBAAoB,GAAGxL,OAAO,CAACmG,IAAD,EAAO,iBAAP,CAApC;AACA,UAAMsF,2BAA2B,GAAGzL,OAAO,CAACoG,eAAD,EAAkB,IAAlB,EAAwBoF,oBAAxB,CAA3C;AACA,UAAME,IAAI,GAAGlJ,YAAY,CAAC8I,QAAQ,CAACK,IAAV,CAAzB;;AACA,UAAMtC,MAAM,GAAG,MAAKQ,SAAL,EAAf;;AAEA,UAAI6B,IAAI,IAAIH,uBAAR,IAAmCA,uBAAuB,KAAKE,2BAAnE,EAAgG;AAC5F,cAAK7H,QAAL,CAAc;AACVyC,UAAAA,OAAO,EAAE;AACLqF,YAAAA,IAAI,EAAJA,IADK;AAELtH,YAAAA,KAAK,EAAEkH,QAAQ,CAAClH;AAFX;AADC,SAAd;AAMH;;AAED,UAAIiF,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAACuC,IAAP,CAAY,oBAAZ,EAAkC;AAAE/E,UAAAA,EAAE,EAAFA,EAAF;AAAM8D,UAAAA,MAAM,EAANA;AAAN,SAAlC;AACH;AACJ,KAj6ByB;;AAAA,mEAw6BX,UAAC5D,SAAD,EAAgC;AAC3C,YAAKmD,gBAAL,GAAwBnD,SAAxB;AACH,KA16ByB;;AAAA,QAGlB8E,OAHkB,GAYlB5I,KAZkB,CAGlB4I,OAHkB;AAAA,QAIlBC,KAJkB,GAYlB7I,KAZkB,CAIlB6I,KAJkB;AAAA,QAKlBvF,OALkB,GAYlBtD,KAZkB,CAKlBsD,MALkB;AAAA,QAMlBwF,QANkB,GAYlB9I,KAZkB,CAMlB8I,QANkB;AAAA,QAOlBC,kBAPkB,GAYlB/I,KAZkB,CAOlB+I,kBAPkB;AAAA,QAQlBC,mBARkB,GAYlBhJ,KAZkB,CAQlBgJ,mBARkB;AAAA,QASlBC,UATkB,GAYlBjJ,KAZkB,CASlBiJ,UATkB;AAAA,QAUlBC,kBAVkB,GAYlBlJ,KAZkB,CAUlBkJ,kBAVkB;AAAA,QAWlBlG,MAXkB,GAYlBhD,KAZkB,CAWlBgD,KAXkB;AActB,UAAKY,EAAL,GAAUjH,QAAQ,CAAC,OAAD,CAAlB;AACA,UAAKwM,GAAL,GAAW,IAAI9K,GAAJ,CAAQ;AACfuK,MAAAA,OAAO,EAAPA,OADe;AAEfC,MAAAA,KAAK,EAALA,KAFe;AAGfO,MAAAA,UAAU,EAAEjK,2BAHG;AAIf2J,MAAAA,QAAQ,EAARA,QAJe;AAKfC,MAAAA,kBAAkB,EAAlBA,kBALe;AAMfC,MAAAA,mBAAmB,EAAnBA,mBANe;AAOfC,MAAAA,UAAU,EAAVA,UAPe;AAQfC,MAAAA,kBAAkB,EAAlBA,kBARe;AASflG,MAAAA,KAAK,EAALA;AATe,KAAR,CAAX;AAWA,UAAKC,KAAL,qBACO,MAAKoC,YADZ;AAEI7B,MAAAA,aAAa,EAAEF,OAFnB;AAGI;AACA+F,MAAAA,cAAc,EAAE/F;AAJpB;AA1BsB,QAgCdzC,OAhCc,GAgCHb,KAhCG,CAgCda,MAhCc;;AAiCtBA,IAAAA,OAAM,CAACyI,aAAP,CAAqB;AACjBC,MAAAA,WAAW,EAAE3J;AADI,KAArB;;AAjCsB;AAoCzB;AAED;;;;;;;;;2CAK6B;AACzB;AACA,WAAKuJ,GAAL,CAASK,OAAT,CAAiB,KAAjB;AACA,WAAKC,cAAL;AACH;AAED;;;;;;qCAG4C;AAAA,UAA7BC,WAA6B,uEAAN,IAAM;AAAA,UAChCC,gBADgC,GACX,KAAK3J,KADM,CAChC2J,gBADgC;;AAExC,UAAI,KAAKxH,OAAT,EAAkB;AACd,aAAKA,OAAL,CAAaqH,OAAb;AACA,aAAKrH,OAAL,CAAayH,kBAAb;AACA,aAAKzH,OAAL,GAAe/B,SAAf;AAEAuJ,QAAAA,gBAAgB,CAACD,WAAD,CAAhB;AACH;AACJ;AAED;;;;;;;;;iCAMmB;AACf,WAAKP,GAAL,CAASK,OAAT,CAAiB,IAAjB;AACH;AAED;;;;;;;;wCAK0B;AACtB,WAAKK,cAAL;AACA,WAAKC,UAAL;AAEA,WAAKC,SAAL,CAAe,KAAK9G,KAAL,CAAWO,aAA1B;AACA,WAAKtB,YAAL;AACH;;;;AAeD;;;;;uCAKmB8H,S,EAAkBC,S,EAAwB;AAAA,yBACnB,KAAKjK,KADc;AAAA,UACjD6C,kBADiD,gBACjDA,kBADiD;AAAA,UAC7BG,KAD6B,gBAC7BA,KAD6B;AAAA,UAE7BkH,sBAF6B,GAEgBF,SAFhB,CAEjDnH,kBAFiD;AAAA,UAEEsH,SAFF,GAEgBH,SAFhB,CAELhH,KAFK;AAAA,UAGjDQ,aAHiD,GAG/B,KAAKP,KAH0B,CAGjDO,aAHiD;AAIzD,UAAM4G,gBAAgB,GAAGH,SAAS,CAACzG,aAAV,KAA4BA,aAArD;AACA,UAAM6G,eAAe,GAAGF,SAAS,KAAKnH,KAAtC;AACA,UAAMsH,sBAAsB,GAAGJ,sBAAsB,KAAKrH,kBAA1D;;AAEA,UAAIuH,gBAAJ,EAAsB;AAClB,aAAKX,cAAL;AACA,aAAK9I,QAAL,CAAc;AAAEN,UAAAA,SAAS,EAAE,IAAb;AAAmB8C,UAAAA,eAAe,EAAE/C;AAApC,SAAd;AACA,aAAK2J,SAAL,CAAevG,aAAf;AACH,OAJD,MAIO,IAAI,KAAK+G,iBAAL,CAAuBN,SAAvB,CAAJ,EAAuC;AAC1C,aAAKR,cAAL,CAAoB,KAApB;AACA,aAAK9I,QAAL,CAAc;AAAEN,UAAAA,SAAS,EAAE;AAAb,SAAd;AACA,aAAKmK,WAAL;AACH,OAJM,MAIA,IAAIH,eAAJ,EAAqB;AACxB,aAAKI,kBAAL;AACH;;AAED,UAAIH,sBAAsB,IAAI,KAAKnI,OAA/B,IAA0C,KAAKA,OAAL,CAAauI,iBAA3D,EAA8E;AAC1E,aAAKvI,OAAL,CAAauI,iBAAb,CAA+B7H,kBAA/B;AACH;AACJ;AAED;;;;;;;;yCAKkD;AAAA,UAA/B8H,YAA+B,uEAAP,KAAO;;AAC9C,UAAI,KAAKxI,OAAT,EAAkB;AACd,aAAKA,OAAL,CAAayI,WAAb,CAAyB,KAAK5K,KAAL,CAAWgD,KAApC,EAA2C2H,YAA3C;AACH;AACJ;AAED;;;;;;;;;sCAMkBV,S,EAA2B;AAAA,yBACA,KAAKhH,KADL;AAAA,UACjCC,IADiC,gBACjCA,IADiC;AAAA,UAC3BC,eAD2B,gBAC3BA,eAD2B;AAAA,UAE3B0H,QAF2B,GAE+BZ,SAF/B,CAEjC/G,IAFiC;AAAA,UAEA4H,mBAFA,GAE+Bb,SAF/B,CAEjB9G,eAFiB;AAGzC,UAAM4H,qBAAqB,GAAGhO,OAAO,CAAC+N,mBAAD,EAAsB,IAAtB,CAArC;AACA,UAAME,iBAAiB,GAAGjO,OAAO,CAACoG,eAAD,EAAkB,IAAlB,CAAjC;AACA,UAAM8H,iBAAiB,GAAGlO,OAAO,CAAC8N,QAAD,EAAW,iBAAX,CAAjC;AACA,UAAMK,aAAa,GAAGnO,OAAO,CAACmG,IAAD,EAAO,iBAAP,CAA7B;AACA,UAAIsH,WAAW,GAAG,KAAlB;;AAEA,UAAIQ,iBAAiB,KAAKD,qBAA1B,EAAiD;AAC7C,YAAMI,iBAAiB,GAAGD,aAAa,KAAKH,qBAAlB,IAA2C,CAACA,qBAAtE;AACA,YAAMK,iBAAiB,GAAGF,aAAa,KAAKF,iBAAlB,IAAuC,CAACA,iBAAlE,CAF6C,CAI7C;;AACAR,QAAAA,WAAW,GAAG,CAACW,iBAAD,IAAsB,CAACC,iBAArC;AACH,OAND,MAMO,IAAIF,aAAa,IAAID,iBAArB,EAAwC;AAC3C;AACAT,QAAAA,WAAW,GAAGU,aAAa,KAAKD,iBAAhC;AACH,OAHM,MAGA;AACH;AACAT,QAAAA,WAAW,GAAG,CAACK,QAAD,IAAa,CAAC,CAAC3H,IAA7B;AACH;;AAED,aAAOsH,WAAP;AACH;AAED;;;;;;;;gCAKYa,K,EAAuB;AAAA,yBAC4C,KAAKrL,KADjD;AAAA,UACvBsL,UADuB,gBACvBA,UADuB;AAAA,UACXC,UADW,gBACXA,UADW;AAAA,UACCzC,QADD,gBACCA,QADD;AAAA,UACW0C,qBADX,gBACWA,qBADX;AAE/B,UAAMC,IAAY,aAAMF,UAAN,cAAoBC,qBAApB,cAA6C1C,QAA7C,cAAyDuC,KAAzD,CAAlB;AACA,UAAMK,MAAc,GAAGJ,UAAU,CAACK,QAAX,CAAoB,GAApB,IAA2BF,IAA3B,cAAsCA,IAAtC,CAAvB;AACA,uBAAUH,UAAV,SAAuBI,MAAvB;AACH;AAED;;;;;;;;6CAKkC;AAC9B,aAAO,CAAC,CAAC/G,MAAM,CAACC,GAAT,IAAgB,CAAC,CAACD,MAAM,CAACC,GAAP,CAAWF,OAApC;AACH;AAED;;;;;;;;qCAKuB;AAAA,sBACFkH,QADE;AAAA,UACXC,IADW,aACXA,IADW;AAEnB,UAAMC,GAAW,GAAG,KAAKC,WAAL,CAAiB,aAAjB,CAApB;;AAEA,UAAI,CAACF,IAAD,IAASA,IAAI,CAACG,aAAL,2CAAmDF,GAAnD,SAAb,EAA0E;AACtE;AACH;;AAED,UAAMG,IAAI,GAAGL,QAAQ,CAACM,aAAT,CAAuB,MAAvB,CAAb;AACAD,MAAAA,IAAI,CAACE,GAAL,GAAW,YAAX;AACAF,MAAAA,IAAI,CAACvD,IAAL,GAAY,UAAZ;AACAuD,MAAAA,IAAI,CAACG,IAAL,GAAYN,GAAZ;AACAD,MAAAA,IAAI,CAACQ,WAAL,CAAiBJ,IAAjB;AACH;AAED;;;;;;;;iCAKmB;AAAA,uBACEL,QADF;AAAA,UACPC,IADO,cACPA,IADO;AAEf,UAAMC,GAAW,GAAG,KAAKC,WAAL,CAAiB,YAAjB,CAApB;;AAEA,UAAI,CAACF,IAAD,IAAS,KAAKxI,sBAAL,EAAb,EAA4C;AACxC;AACH;;AAED,UAAMiJ,aAAa,GAAGT,IAAI,CAACG,aAAL,wBAAkCF,GAAlC,SAAtB;;AACA,UAAIQ,aAAJ,EAAmB;AACf;AACH;;AAED,UAAMC,MAAM,GAAGX,QAAQ,CAACM,aAAT,CAAuB,QAAvB,CAAf;AACAK,MAAAA,MAAM,CAACC,GAAP,GAAaV,GAAb;AACAS,MAAAA,MAAM,CAACE,gBAAP,CAAwB,MAAxB,EAAgC,KAAKjC,WAArC;AACAqB,MAAAA,IAAI,CAACQ,WAAL,CAAiBE,MAAjB;AACH;AAED;;;;;;;;mCAKe;AAAA,yBAC+B,KAAKvM,KADpC;AAAA,UACH0M,SADG,gBACHA,SADG;AAAA,UACQC,WADR,gBACQA,WADR;;AAEX,UAAID,SAAS,IAAI,CAAC/O,cAAc,CAACiO,QAAQ,CAACgB,aAAV,CAAhC,EAA0D;AACtDhP,QAAAA,KAAK,CAAC+O,WAAW,EAAZ,CAAL;AACH;AACJ;AAED;;;;;;;;;kDAM8BzJ,I,EAAeF,K,EAAoB;AAC7D,UAAI,CAAC,KAAKb,OAAN,IAAiB,CAACe,IAAlB,IAA0B,CAACA,IAAI,CAACU,EAApC,EAAwC;AACpC;AACH;;AAED,WAAKzB,OAAL,CAAa6C,eAAb,CAA6B,CAAC9B,IAAD,CAA7B;AACA,WAAKf,OAAL,CAAaE,QAAb,CAAsB;AAAEiB,QAAAA,MAAM,EAAEJ,IAAI,CAACU,EAAf;AAAmBZ,QAAAA,KAAK,EAALA;AAAnB,OAAtB;AACH;AAED;;;;;;;;;8BAMUE,I,EAAiC;AACvC,UAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC1B,eAAOA,IAAP;AACH;;AAED,UAAI,QAAOA,IAAP,MAAgB,QAAhB,IAA4B,CAAC,CAACA,IAAI,CAACU,EAAvC,EAA2C;AACvC,eAAOV,IAAI,CAACU,EAAZ;AACH;;AAED,YAAMnE,cAAN;AACH;AAED;;;;;;;;;;;;gDAMeoN,K;;;;;;;;AACH7J,gBAAAA,K,GAAiB,KAAKhD,K,CAAtBgD,K;AACF8J,gBAAAA,Q,GAAqBD,KAAK,CAACE,GAAN,CAAU,UAAA7J,IAAI;AAAA,yBAAIrF,cAAc,CAAC,MAAI,CAAC0F,SAAL,CAAeL,IAAf,CAAD,CAAlB;AAAA,iBAAd,C;;uBACrBxF,YAAY,CAACsP,WAAb,CAAyBF,QAAzB,EAAmC9J,KAAnC,C;;;AACN6J,gBAAAA,KAAK,CAACI,OAAN,CAAc,UAAA/J,IAAI,EAAI;AAClB,sBAAMI,MAAM,GAAG,MAAI,CAACC,SAAL,CAAeL,IAAf,CAAf;;AACA,kBAAA,MAAI,CAAC6G,SAAL,CAAezG,MAAf,EAAuBrG,IAAvB,EAA6BA,IAA7B,EAAmC;AAC/BiQ,oBAAAA,YAAY,EAAE;AADiB,mBAAnC;AAGH,iBALD;;;;;;;;;;;;;;;;AAQJ;;;;;;;;4CAKgC;AAC5B,UAAI,CAAC,KAAKC,kBAAN,IAA4B,CAAC,KAAK3H,gBAAtC,EAAwD;AACpD,eAAO,CAAP;AACH;;AAED,aAAO4H,IAAI,CAACC,KAAL,CAAW,KAAK7H,gBAAL,GAAwB,KAAK2H,kBAAxC,CAAP;AACH;AAED;;;;;;;;;;AA0DA;;;;;;qDAMiCtL,kB,EAA4D;AACzF,UAAMb,kBAAkB,GAAG,KAAKC,qBAAL,EAA3B;AADyF,UAEjFqM,SAFiF,GAE9CzL,kBAF8C,CAEjFyL,SAFiF;AAAA,UAEtEC,UAFsE,GAE9C1L,kBAF8C,CAEtE0L,UAFsE;AAAA,UAE1DC,OAF0D,GAE9C3L,kBAF8C,CAE1D2L,OAF0D,EAIzF;AACA;AACA;;AACA,UAAIC,eAAe,GAAGF,UAAtB;AACA,UAAIG,cAAc,GAAGJ,SAArB;AACA,UAAIK,YAAY,GAAGH,OAAnB;;AACA,UAAID,UAAJ,EAAgB;AACZE,QAAAA,eAAe,IAAIzM,kBAAnB;AACH,OAFD,MAEO;AACH0M,QAAAA,cAAc,IAAI1M,kBAAlB;AACH;;AAED,UAAI2M,YAAJ,EAAkB;AACd;AACAA,QAAAA,YAAY,IAAI3M,kBAAhB;AACH;;AAED,UAAMJ,cAAc,GAAG;AACnB2M,QAAAA,UAAU,EAAEE,eADO;AAEnBH,QAAAA,SAAS,EAAEI,cAFQ;AAGnBE,QAAAA,KAAK,EAAEF,cAAc,GAAGD,eAHL;AAInBD,QAAAA,OAAO,EAAEG;AAJU,OAAvB;AAOA,aAAO/M,cAAP;AACH;AAED;;;;;;;;;AAmCA;;;;;kCAKuB;AAAA,UACXyD,WADW,GACY,KAAKrE,KADjB,CACXqE,WADW;AAAA,UAEXnB,IAFW,GAEK,KAAKD,KAFV,CAEXC,IAFW;AAGnB,UAAM2K,kBAAkB,GACpB9Q,OAAO,CAACmG,IAAD,EAAO,0BAAP,EAAmC,KAAnC,CAAP,IAAoDnG,OAAO,CAACmG,IAAD,EAAO,uBAAP,EAAgC,KAAhC,CAD/D;AAEA,aAAO2K,kBAAkB,IAAI,CAAC,CAACxJ,WAA/B;AACH;AAED;;;;;;;;kCAKuB;AAAA,UACXH,eADW,GACgB,KAAKlE,KADrB,CACXkE,eADW;AAAA,UAEXhB,IAFW,GAEK,KAAKD,KAFV,CAEXC,IAFW;AAGnB,UAAM4K,iBAAiB,GAAG/Q,OAAO,CAACmG,IAAD,EAAO,0BAAP,EAAmC,KAAnC,CAAjC;AACA,aAAO,CAAC,CAACgB,eAAF,IAAqB4J,iBAA5B;AACH;AAED;;;;;;;;yCAK8B;AAAA,UAClB5J,eADkB,GACS,KAAKlE,KADd,CAClBkE,eADkB;AAAA,UAElBhB,IAFkB,GAEF,KAAKD,KAFH,CAElBC,IAFkB;AAG1B,UAAM6K,qBAAqB,GAAGhR,OAAO,CAACmG,IAAD,EAAO,sCAAP,EAA+C,KAA/C,CAArC;AACA,UAAM8K,sBAAsB,GAAGjR,OAAO,CAACmG,IAAD,EAAO,uCAAP,EAAgD,KAAhD,CAAtC;AACA,aAAO,CAAC,CAACgB,eAAF,KAAsB,KAAK+J,WAAL,MAAsBF,qBAAtB,IAA+CC,sBAArE,CAAP;AACH;;;qCAEgB;AACb,UAAM7L,OAAO,GAAG,KAAKgE,UAAL,EAAhB;AACA,WAAKxF,QAAL,CAAc;AAAET,QAAAA,QAAQ,EAAE,CAAC,CAACiC,OAAF,KAAc,CAACA,OAAO,CAACjC,QAAT,IAAqBiC,OAAO,CAACjC,QAAR,EAAnC;AAAZ,OAAd;AACH;AAED;;;;;;;;;AA+JA;;;;;;;;;8BAUI0D,E,EACAsK,e,EACAC,a,EAEI;AAAA,UADJC,YACI,uEAD2B,EAC3B;;AACJ,UAAI,CAACxK,EAAL,EAAS;AACL;AACH;;AAED,WAAKuJ,kBAAL,GAA0B1H,WAAW,CAACC,GAAZ,EAA1B;AACA,WAAKF,gBAAL,GAAwB,IAAxB;AAEA,WAAK2D,GAAL,CACKkF,UADL,GAEKC,OAFL,CAGQ1K,EAHR,EAIQsK,eAAe,IAAI,KAAKK,wBAJhC,EAKQJ,aAAa,IAAI,KAAKK,sBAL9B,oBAOeJ,YAPf;AAQYK,QAAAA,MAAM,EAAEzQ;AARpB;AAWH;AAED;;;;;;;;;AA0BA;;;;;mCAKe;AAAA,UACHwF,aADG,GACsB,KAAKP,KAD3B,CACHO,aADG;AAAA,UAEHhC,UAFG,GAEmB,KAAKxB,KAFxB,CAEHwB,UAFG;;AAGX,UAAI,CAACgC,aAAD,IAAkBhC,UAAU,CAACY,MAAX,GAAoB,CAA1C,EAA6C;AACzC,eAAO,CAAC,CAAR;AACH;;AAED,aAAOZ,UAAU,CAACkN,SAAX,CAAqB,UAAAC,IAAI,EAAI;AAChC,YAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC1B,iBAAOA,IAAI,KAAKnL,aAAhB;AACH;;AAED,eAAOmL,IAAI,CAAC/K,EAAL,KAAYJ,aAAnB;AACH,OANM,CAAP;AAOH;AAED;;;;;;;;;;oCAOgBoL,K,EAAe;AAAA,yBACe,KAAK5O,KADpB;AAAA,UACnBwB,UADmB,gBACnBA,UADmB;AAAA,UACPqN,UADO,gBACPA,UADO;AAAA,UAEnBzM,MAFmB,GAERZ,UAFQ,CAEnBY,MAFmB;;AAG3B,UAAIA,MAAM,GAAG,CAAT,IAAcwM,KAAK,GAAG,CAAtB,IAA2BA,KAAK,GAAGxM,MAAM,GAAG,CAAhD,EAAmD;AAC/C;AACH;;AAED,UAAM0M,QAAQ,GAAGtN,UAAU,CAACoN,KAAD,CAA3B;AACA,UAAMtL,MAAM,GAAG,QAAOwL,QAAP,MAAoB,QAApB,GAA+BA,QAAQ,CAAClL,EAAT,IAAe,EAA9C,GAAmDkL,QAAlE;AAEA,WAAKnO,QAAL,CACI;AACI6C,QAAAA,aAAa,EAAEF;AADnB,OADJ,EAII,YAAM;AACF;AACAuL,QAAAA,UAAU,CAACvL,MAAD,CAAV;AACH,OAPL;AASH;AAED;;;;;;;;;;AAyLA;;;;;qCAKuB;AAAA,UACFyL,cADE,GACiB,KAAKA,cADtB,CACXC,OADW;;AAGnB,UAAID,cAAJ,EAAoB;AAChBA,QAAAA,cAAc,CAACE,OAAf;AACH;AACJ;AAED;;;;;;;;;6BAMS;AAAA,yBAqBM,KAAKjP,KArBX;AAAA,UAED4I,OAFC,gBAEDA,OAFC;AAAA,UAGDpH,UAHC,gBAGDA,UAHC;AAAA,UAIDwB,KAJC,gBAIDA,KAJC;AAAA,UAKD8F,QALC,gBAKDA,QALC;AAAA,UAMDoG,QANC,gBAMDA,QANC;AAAA,UAODC,SAPC,gBAODA,SAPC;AAAA,UAQDC,mBARC,gBAQDA,mBARC;AAAA,UASDC,oBATC,gBASDA,oBATC;AAAA,UAUDC,SAVC,gBAUDA,SAVC;AAAA,UAWDC,OAXC,gBAWDA,OAXC;AAAA,UAYDC,OAZC,gBAYDA,OAZC;AAAA,UAaDC,WAbC,gBAaDA,WAbC;AAAA,UAcDC,OAdC,gBAcDA,OAdC;AAAA,UAeDC,OAfC,gBAeDA,OAfC;AAAA,UAgBDC,UAhBC,gBAgBDA,UAhBC;AAAA,UAiBD3G,UAjBC,gBAiBDA,UAjBC;AAAA,UAkBDC,kBAlBC,gBAkBDA,kBAlBC;AAAA,UAmBDH,kBAnBC,gBAmBDA,kBAnBC;AAAA,UAoBDC,mBApBC,gBAoBDA,mBApBC;AAAA,yBAgCM,KAAK/F,KAhCX;AAAA,UAwBD/C,QAxBC,gBAwBDA,QAxBC;AAAA,UAyBDsD,aAzBC,gBAyBDA,aAzBC;AAAA,UA0BDrD,KA1BC,gBA0BDA,KA1BC;AAAA,UA2BD+C,IA3BC,gBA2BDA,IA3BC;AAAA,UA4BD7C,SA5BC,gBA4BDA,SA5BC;AAAA,UA6BDC,2BA7BC,gBA6BDA,2BA7BC;AAAA,UA8BDC,sBA9BC,gBA8BDA,sBA9BC;AAAA,UA+BD4C,eA/BC,gBA+BDA,eA/BC;AAkCL,UAAM0M,cAAc,GAAGnT,UAAU,CAC7B,SAD6B,EAE7B;AACI,gCAAwB6D;AAD5B,OAF6B,EAK7B4O,SAL6B,CAAjC;;AAQA,UAAI,CAAC3L,aAAL,EAAoB;AAChB,eAAO,IAAP;AACH;;AAED,UAAMyC,SAAS,GAAGlJ,OAAO,CAACoD,KAAD,EAAQ,MAAR,CAAzB;AACA,UAAM2P,gBAAgB,GAAG/S,OAAO,CAACmG,IAAD,EAAO,IAAP,CAAP,KAAwBM,aAAxB,GAAwCzG,OAAO,CAACmG,IAAD,EAAO,WAAP,CAA/C,GAAqE,EAA9F;AACA,UAAM6M,gBAAgB,GAAGhT,OAAO,CAACmG,IAAD,EAAO,iBAAP,CAAhC;AACA,UAAM8H,iBAAiB,GAAGjO,OAAO,CAACoG,eAAD,EAAkB,IAAlB,EAAwB4M,gBAAxB,CAAjC;AACA,UAAMC,aAAa,GAAGD,gBAAgB,KAAK/E,iBAArB,GAAyC2E,OAAzC,GAAmD,KAAKvH,sBAA9E;AAEA;;AACA;;AACA,aACI,oBAAC,gBAAD;AAAkB,QAAA,QAAQ,EAAEU,QAA5B;AAAsC,QAAA,QAAQ,EAAEoG;AAAhD,SACI;AAAK,QAAA,EAAE,EAAE,KAAKtL,EAAd;AAAkB,QAAA,SAAS,EAAEiM,cAA7B;AAA6C,QAAA,GAAG,EAAED,UAAlD;AAA8D,QAAA,SAAS,EAAE,KAAKK,SAA9E;AAAyF,QAAA,QAAQ,EAAE;AAAnG,SACKX,SAAS,IACN,oBAAC,aAAD;AACI,QAAA,IAAI,EAAEpM,IADV;AAEI,QAAA,OAAO,EAAEwM,OAFb;AAGI,QAAA,KAAK,EAAE1M,KAHX;AAII,QAAA,OAAO,EAAEgN,aAJb;AAKI,QAAA,OAAO,EAAE,KAAKrJ,KALlB;AAMI,QAAA,WAAW,EAAE,KAAKtC,WAAL,EANjB;AAOI,QAAA,QAAQ,EAAEnE,QAPd;AAQI,QAAA,UAAU,EAAE,KAAKwG,QARrB;AASI,QAAA,oBAAoB,EAAE2I,oBAT1B;AAUI,QAAA,WAAW,EAAE,KAAKpB,WAAL,EAVjB;AAWI,QAAA,eAAe,EAAE9K;AAXrB,QAFR,EAgBI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAgC,QAAA,WAAW,EAAE,KAAK+M,WAAlD;AAA+D,QAAA,GAAG,EAAE,KAAKC;AAAzE,SACKjN,IAAI,IACD,oBAAC,OAAD;AAAS,QAAA,MAAM,MAAf;AAAgB,QAAA,QAAQ,EAAE,KAAKkN;AAA/B,SACK;AAAA,YAAeC,UAAf,SAAGT,UAAH;AAAA,eAAgC;AAAK,UAAA,GAAG,EAAES,UAAV;AAAsB,UAAA,SAAS,EAAC;AAAhC,UAAhC;AAAA,OADL,CAFR,EAMI,oBAAC,WAAD;AAAa,QAAA,SAAS,EAAEpK,SAAxB;AAAmC,QAAA,SAAS,EAAE6J,gBAA9C;AAAgE,QAAA,SAAS,EAAEzP;AAA3E,QANJ,EAOI,oBAAC,iBAAD;AACI,QAAA,UAAU,EAAEmB,UADhB;AAEI,QAAA,YAAY,EAAE,KAAKE,YAAL,EAFlB;AAGI,QAAA,cAAc,EAAE,KAAKmG,YAHzB;AAII,QAAA,eAAe,EAAE,KAAKC;AAJ1B,QAPJ,CADJ,EAeK5E,IAAI,IACD,oBAAC,eAAD,eACQkM,mBADR;AAEI,QAAA,OAAO,EAAExG,OAFb;AAGI,QAAA,KAAK,EAAE5F,KAHX;AAII,QAAA,KAAK,EAAE,KAAKmG,GAAL,CAASmH,QAAT,EAJX;AAKI,QAAA,MAAM,EAAE9M,aALZ;AAMI,QAAA,UAAU,EAAE,KAAK2C,UANrB;AAOI,QAAA,SAAS,EAAE,KAAKS,SAPpB;AAQI,QAAA,OAAO,EAAE2I,OARb;AASI,QAAA,aAAa,EAAEC,OAAO,IAAIC,WAT9B;AAUI,QAAA,QAAQ,EAAE3G,QAVd;AAWI,QAAA,GAAG,EAAE,KAAKiG,cAXd;AAYI,QAAA,UAAU,EAAE9F,UAZhB;AAaI,QAAA,kBAAkB,EAAEC,kBAbxB;AAcI,QAAA,kBAAkB,EAAEH,kBAdxB;AAeI,QAAA,mBAAmB,EAAEC,mBAfzB;AAgBI,QAAA,kBAAkB,EAAE,KAAKuH,sBAhB7B;AAiBI,QAAA,eAAe,EAAE,KAAKpI;AAjB1B,SAhBR,CAhBJ,EAqDK7H,2BAA2B,IACxB,oBAAC,kBAAD;AAAoB,QAAA,OAAO,EAAE,KAAKkQ,uBAAlC;AAA2D,QAAA,OAAO,EAAE,KAAKC;AAAzE,QAtDR,CADJ,CADJ;AA6DA;;AACA;AACH;;;6CA99B+BzQ,K,EAAciD,K,EAAc;AAAA,UAChDK,MADgD,GACrCtD,KADqC,CAChDsD,MADgD;;AAGxD,UAAIA,MAAM,KAAKL,KAAK,CAACoG,cAArB,EAAqC;AACjC,eAAO;AACH7F,UAAAA,aAAa,EAAEF,MADZ;AAEH+F,UAAAA,cAAc,EAAE/F;AAFb,SAAP;AAIH;;AAED,aAAO,IAAP;AACH;;;;EA3KwB7G,KAAK,CAACiU,a;;gBAA7B3Q,c,kBAgCoB;AAClB6I,EAAAA,OAAO,EAAE/J,oBADS;AAElB8R,EAAAA,OAAO,EAAE7R,oBAFS;AAGlB4N,EAAAA,SAAS,EAAE,KAHO;AAIlBrI,EAAAA,WAAW,EAAE,IAJK;AAKlB8K,EAAAA,SAAS,EAAE,EALO;AAMlB3N,EAAAA,UAAU,EAAE,EANM;AAOlB6N,EAAAA,oBAAoB,EAAE,EAPJ;AAQlBD,EAAAA,mBAAmB,EAAE,EARH;AASlB3M,EAAAA,uBAAuB,EAAE,KATP;AAUlB6M,EAAAA,SAAS,EAAE,KAVO;AAWlBxG,EAAAA,QAAQ,EAAE7J,cAXQ;AAYlB2D,EAAAA,WAAW,EAAE3F,IAZK;AAalB0F,EAAAA,gBAAgB,EAAE1F,IAbA;AAclBwJ,EAAAA,UAAU,EAAExJ,IAdM;AAelByD,EAAAA,OAAO,EAAEzD,IAfS;AAgBlBsE,EAAAA,MAAM,EAAEtE,IAhBU;AAiBlB4R,EAAAA,UAAU,EAAE5R,IAjBM;AAkBlB0M,EAAAA,gBAAgB,EAAE1M,IAlBA;AAmBlBkL,EAAAA,eAAe,EAAElL,IAnBC;AAoBlBuO,EAAAA,qBAAqB,EAAExM,uBApBL;AAqBlBkF,EAAAA,eAAe,EAAE,KArBC;AAsBlBoH,EAAAA,UAAU,EAAEvM,uBAtBM;AAuBlBwM,EAAAA,UAAU,EAAErM,2BAvBM;AAwBlBuF,EAAAA,UAAU,EAAE;AAxBM,C;;AAkmC1B,SAAS1E,cAAc,IAAI6Q,uBAA3B;AACA,eAAe5T,IAAI,CAAC,CAChBM,cADgB,EAEhBqB,oBAFgB,EAGhBF,eAHgB,EAIhBrB,UAJgB,EAKhBG,aALgB,EAMhBW,mBANgB,EAOhBH,UAAU,CAACsB,sBAAD,CAPM,EAQhBvB,iBAAiB,CAACuB,sBAAD,CARD,CAAD,CAAJ,CASZU,cATY,CAAf","sourcesContent":["/**\n * @flow\n * @file Content Preview Component\n * @author Box\n */\n\nimport 'regenerator-runtime/runtime';\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport uniqueid from 'lodash/uniqueId';\nimport throttle from 'lodash/throttle';\nimport cloneDeep from 'lodash/cloneDeep';\nimport omit from 'lodash/omit';\nimport getProp from 'lodash/get';\nimport flow from 'lodash/flow';\nimport noop from 'lodash/noop';\nimport setProp from 'lodash/set';\nimport Measure from 'react-measure';\nimport { withRouter } from 'react-router-dom';\nimport type { ContextRouter } from 'react-router-dom';\nimport { decode } from '../../utils/keys';\nimport makeResponsive from '../common/makeResponsive';\nimport { withNavRouter } from '../common/nav-router';\nimport Internationalize from '../common/Internationalize';\nimport AsyncLoad from '../common/async-load';\nimport TokenService from '../../utils/TokenService';\nimport { isInputElement, focus } from '../../utils/dom';\nimport { getTypedFileId } from '../../utils/file';\nimport { withErrorBoundary } from '../common/error-boundary';\nimport { withLogger } from '../common/logger';\nimport { PREVIEW_FIELDS_TO_FETCH } from '../../utils/fields';\nimport { mark } from '../../utils/performance';\nimport { withFeatureProvider } from '../common/feature-checking';\nimport { EVENT_JS_READY } from '../common/logger/constants';\nimport ReloadNotification from './ReloadNotification';\nimport API from '../../api';\nimport PreviewHeader from './preview-header';\nimport PreviewMask from './PreviewMask';\nimport PreviewNavigation from './PreviewNavigation';\nimport {\n    withAnnotations,\n    WithAnnotationsProps,\n    withAnnotatorContext,\n    WithAnnotatorContextProps,\n} from '../common/annotator-context';\nimport {\n    DEFAULT_HOSTNAME_API,\n    DEFAULT_HOSTNAME_APP,\n    DEFAULT_HOSTNAME_STATIC,\n    DEFAULT_PREVIEW_VERSION,\n    DEFAULT_LOCALE,\n    DEFAULT_PATH_STATIC_PREVIEW,\n    CLIENT_NAME_CONTENT_PREVIEW,\n    ORIGIN_PREVIEW,\n    ORIGIN_CONTENT_PREVIEW,\n    ERROR_CODE_UNKNOWN,\n} from '../../constants';\nimport type { Annotation } from '../../common/types/feed';\nimport type { TargetingApi } from '../../features/targeting/types';\nimport type { ErrorType, AdditionalVersionInfo } from '../common/flowTypes';\nimport type { WithLoggerProps } from '../../common/types/logging';\nimport type { RequestOptions, ErrorContextProps, ElementsXhrError } from '../../common/types/api';\nimport type { StringMap, Token, BoxItem, BoxItemVersion } from '../../common/types/core';\nimport type { VersionChangeCallback } from '../content-sidebar/versions';\nimport type { FeatureConfig } from '../common/feature-checking';\nimport type APICache from '../../utils/Cache';\n\nimport '../common/fonts.scss';\nimport '../common/base.scss';\nimport './ContentPreview.scss';\n\ntype StartAt = {\n    unit: 'pages' | 'seconds',\n    value: number,\n};\n\ntype Props = {\n    apiHost: string,\n    appHost: string,\n    autoFocus: boolean,\n    boxAnnotations?: Object,\n    cache?: APICache,\n    canDownload?: boolean,\n    className: string,\n    collection: Array<string | BoxItem>,\n    contentOpenWithProps: ContentOpenWithProps,\n    contentSidebarProps: ContentSidebarProps,\n    enableThumbnailsSidebar: boolean,\n    features?: FeatureConfig,\n    fileId?: string,\n    fileOptions?: Object,\n    getInnerRef: () => ?HTMLElement,\n    hasHeader?: boolean,\n    isLarge: boolean,\n    isVeryLarge?: boolean,\n    language: string,\n    logoUrl?: string,\n    measureRef: Function,\n    messages?: StringMap,\n    onAnnotator: Function,\n    onAnnotatorEvent: Function,\n    onClose?: Function,\n    onDownload: Function,\n    onLoad: Function,\n    onNavigate: Function,\n    onVersionChange: VersionChangeCallback,\n    previewExperiences?: {\n        [name: string]: TargetingApi,\n    },\n    previewLibraryVersion: string,\n    requestInterceptor?: Function,\n    responseInterceptor?: Function,\n    sharedLink?: string,\n    sharedLinkPassword?: string,\n    showAnnotations?: boolean,\n    showAnnotationsControls?: boolean,\n    staticHost: string,\n    staticPath: string,\n    token: Token,\n    useHotkeys: boolean,\n} & ErrorContextProps &\n    WithLoggerProps &\n    WithAnnotationsProps &\n    WithAnnotatorContextProps &\n    ContextRouter;\n\ntype State = {\n    canPrint?: boolean,\n    currentFileId?: string,\n    error?: ErrorType,\n    file?: BoxItem,\n    isLoading: boolean,\n    isReloadNotificationVisible: boolean,\n    isThumbnailSidebarOpen: boolean,\n    prevFileIdProp?: string, // the previous value of the \"fileId\" prop. Needed to implement getDerivedStateFromProps\n    selectedVersion?: BoxItemVersion,\n    startAt?: StartAt,\n};\n\n// Emitted by preview's 'load' event\ntype PreviewTimeMetrics = {\n    conversion: number,\n    preload?: number,\n    rendering: number,\n    total: number,\n};\n\n// Emitted by preview's 'preview_metric' event\ntype PreviewMetrics = {\n    browser_name: string,\n    client_version: string,\n    content_type: string, // Sum of all available load times.\n    convert_time: number,\n    download_response_time: number,\n    error?: Object,\n    event_name?: string,\n    extension: string,\n    file_id: string,\n    file_info_time: number,\n    file_version_id: string,\n    full_document_load_time: number,\n    locale: string,\n    logger_session_id: string,\n    rep_type: string,\n    timestamp: string,\n    value: number,\n};\n\ntype PreviewLibraryError = {\n    error: ErrorType,\n};\n\nconst startAtTypes = {\n    page: 'pages',\n};\nconst InvalidIdError = new Error('Invalid id for Preview!');\nconst PREVIEW_LOAD_METRIC_EVENT = 'load';\nconst MARK_NAME_JS_READY = `${ORIGIN_CONTENT_PREVIEW}_${EVENT_JS_READY}`;\n\nmark(MARK_NAME_JS_READY);\n\nconst LoadableSidebar = AsyncLoad({\n    loader: () => import(/* webpackMode: \"lazy\", webpackChunkName: \"content-sidebar\" */ '../content-sidebar'),\n});\n\nclass ContentPreview extends React.PureComponent<Props, State> {\n    id: string;\n\n    props: Props;\n\n    state: State;\n\n    preview: any;\n\n    api: API;\n\n    // Defines a generic type for ContentSidebar, since an import would interfere with code splitting\n    contentSidebar: { current: null | { refresh: Function } } = React.createRef();\n\n    previewContainer: ?HTMLDivElement;\n\n    mouseMoveTimeoutID: TimeoutID;\n\n    rootElement: HTMLElement;\n\n    stagedFile: ?BoxItem;\n\n    updateVersionToCurrent: ?() => void;\n\n    initialState: State = {\n        canPrint: false,\n        error: undefined,\n        isLoading: true,\n        isReloadNotificationVisible: false,\n        isThumbnailSidebarOpen: false,\n    };\n\n    static defaultProps = {\n        apiHost: DEFAULT_HOSTNAME_API,\n        appHost: DEFAULT_HOSTNAME_APP,\n        autoFocus: false,\n        canDownload: true,\n        className: '',\n        collection: [],\n        contentOpenWithProps: {},\n        contentSidebarProps: {},\n        enableThumbnailsSidebar: false,\n        hasHeader: false,\n        language: DEFAULT_LOCALE,\n        onAnnotator: noop,\n        onAnnotatorEvent: noop,\n        onDownload: noop,\n        onError: noop,\n        onLoad: noop,\n        onNavigate: noop,\n        onPreviewDestroy: noop,\n        onVersionChange: noop,\n        previewLibraryVersion: DEFAULT_PREVIEW_VERSION,\n        showAnnotations: false,\n        staticHost: DEFAULT_HOSTNAME_STATIC,\n        staticPath: DEFAULT_PATH_STATIC_PREVIEW,\n        useHotkeys: true,\n    };\n\n    /**\n     * @property {number}\n     */\n    fetchFileEndTime: ?number;\n\n    /**\n     * @property {number}\n     */\n    fetchFileStartTime: ?number;\n\n    /**\n     * [constructor]\n     *\n     * @return {ContentPreview}\n     */\n    constructor(props: Props) {\n        super(props);\n        const {\n            apiHost,\n            cache,\n            fileId,\n            language,\n            requestInterceptor,\n            responseInterceptor,\n            sharedLink,\n            sharedLinkPassword,\n            token,\n        } = props;\n\n        this.id = uniqueid('bcpr_');\n        this.api = new API({\n            apiHost,\n            cache,\n            clientName: CLIENT_NAME_CONTENT_PREVIEW,\n            language,\n            requestInterceptor,\n            responseInterceptor,\n            sharedLink,\n            sharedLinkPassword,\n            token,\n        });\n        this.state = {\n            ...this.initialState,\n            currentFileId: fileId,\n            // eslint-disable-next-line react/no-unused-state\n            prevFileIdProp: fileId,\n        };\n        const { logger } = props;\n        logger.onReadyMetric({\n            endMarkName: MARK_NAME_JS_READY,\n        });\n    }\n\n    /**\n     * Cleanup\n     *\n     * @return {void}\n     */\n    componentWillUnmount(): void {\n        // Don't destroy the cache while unmounting\n        this.api.destroy(false);\n        this.destroyPreview();\n    }\n\n    /**\n     * Cleans up the preview instance\n     */\n    destroyPreview(shouldReset: boolean = true) {\n        const { onPreviewDestroy } = this.props;\n        if (this.preview) {\n            this.preview.destroy();\n            this.preview.removeAllListeners();\n            this.preview = undefined;\n\n            onPreviewDestroy(shouldReset);\n        }\n    }\n\n    /**\n     * Destroys api instances with caches\n     *\n     * @private\n     * @return {void}\n     */\n    clearCache(): void {\n        this.api.destroy(true);\n    }\n\n    /**\n     * Once the component mounts, load Preview assets and fetch file info.\n     *\n     * @return {void}\n     */\n    componentDidMount(): void {\n        this.loadStylesheet();\n        this.loadScript();\n\n        this.fetchFile(this.state.currentFileId);\n        this.focusPreview();\n    }\n\n    static getDerivedStateFromProps(props: Props, state: State) {\n        const { fileId } = props;\n\n        if (fileId !== state.prevFileIdProp) {\n            return {\n                currentFileId: fileId,\n                prevFileIdProp: fileId,\n            };\n        }\n\n        return null;\n    }\n\n    /**\n     * After component updates, load Preview if appropriate.\n     *\n     * @return {void}\n     */\n    componentDidUpdate(prevProps: Props, prevState: State): void {\n        const { previewExperiences, token } = this.props;\n        const { previewExperiences: prevPreviewExperiences, token: prevToken } = prevProps;\n        const { currentFileId } = this.state;\n        const hasFileIdChanged = prevState.currentFileId !== currentFileId;\n        const hasTokenChanged = prevToken !== token;\n        const haveExperiencesChanged = prevPreviewExperiences !== previewExperiences;\n\n        if (hasFileIdChanged) {\n            this.destroyPreview();\n            this.setState({ isLoading: true, selectedVersion: undefined });\n            this.fetchFile(currentFileId);\n        } else if (this.shouldLoadPreview(prevState)) {\n            this.destroyPreview(false);\n            this.setState({ isLoading: true });\n            this.loadPreview();\n        } else if (hasTokenChanged) {\n            this.updatePreviewToken();\n        }\n\n        if (haveExperiencesChanged && this.preview && this.preview.updateExperiences) {\n            this.preview.updateExperiences(previewExperiences);\n        }\n    }\n\n    /**\n     * Updates the access token used by preview library\n     *\n     * @param {boolean} shouldReload - true if preview should be reloaded\n     */\n    updatePreviewToken(shouldReload: boolean = false) {\n        if (this.preview) {\n            this.preview.updateToken(this.props.token, shouldReload);\n        }\n    }\n\n    /**\n     * Returns whether or not preview should be loaded.\n     *\n     * @param {State} prevState - Previous state\n     * @return {boolean}\n     */\n    shouldLoadPreview(prevState: State): boolean {\n        const { file, selectedVersion }: State = this.state;\n        const { file: prevFile, selectedVersion: prevSelectedVersion }: State = prevState;\n        const prevSelectedVersionId = getProp(prevSelectedVersion, 'id');\n        const selectedVersionId = getProp(selectedVersion, 'id');\n        const prevFileVersionId = getProp(prevFile, 'file_version.id');\n        const fileVersionId = getProp(file, 'file_version.id');\n        let loadPreview = false;\n\n        if (selectedVersionId !== prevSelectedVersionId) {\n            const isPreviousCurrent = fileVersionId === prevSelectedVersionId || !prevSelectedVersionId;\n            const isSelectedCurrent = fileVersionId === selectedVersionId || !selectedVersionId;\n\n            // Load preview if the user has selected a non-current version of the file\n            loadPreview = !isPreviousCurrent || !isSelectedCurrent;\n        } else if (fileVersionId && prevFileVersionId) {\n            // Load preview if the file's current version ID has changed\n            loadPreview = fileVersionId !== prevFileVersionId;\n        } else {\n            // Load preview if file object has newly been populated in state\n            loadPreview = !prevFile && !!file;\n        }\n\n        return loadPreview;\n    }\n\n    /**\n     * Returns preview asset urls\n     *\n     * @return {string} base url\n     */\n    getBasePath(asset: string): string {\n        const { staticHost, staticPath, language, previewLibraryVersion }: Props = this.props;\n        const path: string = `${staticPath}/${previewLibraryVersion}/${language}/${asset}`;\n        const suffix: string = staticHost.endsWith('/') ? path : `/${path}`;\n        return `${staticHost}${suffix}`;\n    }\n\n    /**\n     * Determines if preview assets are loaded\n     *\n     * @return {boolean} true if preview is loaded\n     */\n    isPreviewLibraryLoaded(): boolean {\n        return !!global.Box && !!global.Box.Preview;\n    }\n\n    /**\n     * Loads external css by appending a <link> element\n     *\n     * @return {void}\n     */\n    loadStylesheet(): void {\n        const { head } = document;\n        const url: string = this.getBasePath('preview.css');\n\n        if (!head || head.querySelector(`link[rel=\"stylesheet\"][href=\"${url}\"]`)) {\n            return;\n        }\n\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.type = 'text/css';\n        link.href = url;\n        head.appendChild(link);\n    }\n\n    /**\n     * Loads external script by appending a <script> element\n     *\n     * @return {void}\n     */\n    loadScript(): void {\n        const { head } = document;\n        const url: string = this.getBasePath('preview.js');\n\n        if (!head || this.isPreviewLibraryLoaded()) {\n            return;\n        }\n\n        const previewScript = head.querySelector(`script[src=\"${url}\"]`);\n        if (previewScript) {\n            return;\n        }\n\n        const script = document.createElement('script');\n        script.src = url;\n        script.addEventListener('load', this.loadPreview);\n        head.appendChild(script);\n    }\n\n    /**\n     * Focuses the preview on load.\n     *\n     * @return {void}\n     */\n    focusPreview() {\n        const { autoFocus, getInnerRef }: Props = this.props;\n        if (autoFocus && !isInputElement(document.activeElement)) {\n            focus(getInnerRef());\n        }\n    }\n\n    /**\n     * Updates preview cache and prefetches a file\n     *\n     * @param {BoxItem} file - file to prefetch\n     * @return {void}\n     */\n    updatePreviewCacheAndPrefetch(file: BoxItem, token: Token): void {\n        if (!this.preview || !file || !file.id) {\n            return;\n        }\n\n        this.preview.updateFileCache([file]);\n        this.preview.prefetch({ fileId: file.id, token });\n    }\n\n    /**\n     * Gets the file id\n     *\n     * @param {string|BoxItem} file - box file or file id\n     * @return {string} file id\n     */\n    getFileId(file?: string | BoxItem): string {\n        if (typeof file === 'string') {\n            return file;\n        }\n\n        if (typeof file === 'object' && !!file.id) {\n            return file.id;\n        }\n\n        throw InvalidIdError;\n    }\n\n    /**\n     * Prefetches the next few preview files if any\n     *\n     * @param {Array<string|BoxItem>} files - files to prefetch\n     * @return {void}\n     */\n    async prefetch(files: Array<string | BoxItem>): Promise<void> {\n        const { token }: Props = this.props;\n        const typedIds: string[] = files.map(file => getTypedFileId(this.getFileId(file)));\n        await TokenService.cacheTokens(typedIds, token);\n        files.forEach(file => {\n            const fileId = this.getFileId(file);\n            this.fetchFile(fileId, noop, noop, {\n                refreshCache: false,\n            });\n        });\n    }\n\n    /**\n     * Calculates the total file fetch time\n     *\n     * @return {number} the total fetch time\n     */\n    getTotalFileFetchTime(): number {\n        if (!this.fetchFileStartTime || !this.fetchFileEndTime) {\n            return 0;\n        }\n\n        return Math.round(this.fetchFileEndTime - this.fetchFileStartTime);\n    }\n\n    /**\n     * Handler for 'preview_error' preview event\n     *\n     * @param {PreviewLibraryError} previewError - the error data emitted from preview\n     * @return {void}\n     */\n    onPreviewError = ({ error, ...rest }: PreviewLibraryError): void => {\n        const { code = ERROR_CODE_UNKNOWN } = error;\n        const { onError } = this.props;\n\n        // In case of error, there should be no thumbnail sidebar to account for\n        this.setState({ isLoading: false, isThumbnailSidebarOpen: false });\n\n        onError(\n            error,\n            code,\n            {\n                ...rest,\n                error,\n            },\n            ORIGIN_PREVIEW,\n        );\n    };\n\n    /**\n     * Event handler 'preview_metric' which also adds in the file fetch time if it's a load event\n     *\n     * @param {Object} previewMetrics - the object emitted by 'preview_metric'\n     * @return {void}\n     */\n    onPreviewMetric = (previewMetrics: PreviewMetrics): void => {\n        const { logger } = this.props;\n        const { event_name } = previewMetrics;\n        let metrics = {\n            ...previewMetrics,\n        };\n\n        // We need to add in the total file fetch time to the file_info_time and value (total)\n        // as preview does not do the files call\n        if (event_name === PREVIEW_LOAD_METRIC_EVENT) {\n            const totalFetchFileTime = this.getTotalFileFetchTime();\n            const totalTime = (previewMetrics.value || 0) + totalFetchFileTime;\n\n            // If an unnatural load time occurs or is invalid, don't log a load event\n            if (!totalTime) {\n                return;\n            }\n\n            metrics = {\n                ...previewMetrics,\n                file_info_time: totalFetchFileTime,\n                value: totalTime,\n            };\n        }\n\n        logger.onPreviewMetric(metrics);\n    };\n\n    /**\n     * Adds in the file fetch time to the preview metrics\n     *\n     * @param {Object} previewTimeMetrics - the preview time metrics\n     * @return {Object} the preview time metrics merged with the files call time\n     */\n    addFetchFileTimeToPreviewMetrics(previewTimeMetrics: PreviewTimeMetrics): PreviewTimeMetrics {\n        const totalFetchFileTime = this.getTotalFileFetchTime();\n        const { rendering, conversion, preload } = previewTimeMetrics;\n\n        // We need to add in the total file fetch time to the rendering and total as preview\n        // does not do the files call. In the case the file is in the process of\n        // being converted, we need to add to conversion instead of the render\n        let totalConversion = conversion;\n        let totalRendering = rendering;\n        let totalPreload = preload;\n        if (conversion) {\n            totalConversion += totalFetchFileTime;\n        } else {\n            totalRendering += totalFetchFileTime;\n        }\n\n        if (totalPreload) {\n            // Preload is optional, depending on file type\n            totalPreload += totalFetchFileTime;\n        }\n\n        const previewMetrics = {\n            conversion: totalConversion,\n            rendering: totalRendering,\n            total: totalRendering + totalConversion,\n            preload: totalPreload,\n        };\n\n        return previewMetrics;\n    }\n\n    /**\n     * onLoad function for preview\n     *\n     * @return {void}\n     */\n    onPreviewLoad = (data: Object): void => {\n        const { onLoad, collection }: Props = this.props;\n        const currentIndex = this.getFileIndex();\n        const filesToPrefetch = collection.slice(currentIndex + 1, currentIndex + 5);\n        const previewTimeMetrics = getProp(data, 'metrics.time');\n        let loadData = data;\n\n        if (previewTimeMetrics) {\n            const totalPreviewMetrics = this.addFetchFileTimeToPreviewMetrics(previewTimeMetrics);\n            loadData = {\n                ...loadData,\n                metrics: {\n                    ...loadData.metrics,\n                    time: totalPreviewMetrics,\n                },\n            };\n        }\n\n        onLoad(loadData);\n\n        this.setState({ isLoading: false });\n        this.focusPreview();\n\n        if (this.preview && filesToPrefetch.length) {\n            this.prefetch(filesToPrefetch);\n        }\n\n        this.handleCanPrint();\n    };\n\n    /**\n     * Returns whether file can be downloaded based on file properties, permissions, and user-defined options.\n     *\n     * @return {boolean}\n     */\n    canDownload(): boolean {\n        const { canDownload }: Props = this.props;\n        const { file }: State = this.state;\n        const isFileDownloadable =\n            getProp(file, 'permissions.can_download', false) && getProp(file, 'is_download_available', false);\n        return isFileDownloadable && !!canDownload;\n    }\n\n    /**\n     * Returns whether file can be annotated based on permissions\n     *\n     * @return {boolean}\n     */\n    canAnnotate(): boolean {\n        const { showAnnotations }: Props = this.props;\n        const { file }: State = this.state;\n        const isFileAnnotatable = getProp(file, 'permissions.can_annotate', false);\n        return !!showAnnotations && isFileAnnotatable;\n    }\n\n    /**\n     * Returns whether a preview should render annotations based on permissions\n     *\n     * @return {boolean}\n     */\n    canViewAnnotations(): boolean {\n        const { showAnnotations }: Props = this.props;\n        const { file }: State = this.state;\n        const hasViewAllPermissions = getProp(file, 'permissions.can_view_annotations_all', false);\n        const hasViewSelfPermissions = getProp(file, 'permissions.can_view_annotations_self', false);\n        return !!showAnnotations && (this.canAnnotate() || hasViewAllPermissions || hasViewSelfPermissions);\n    }\n\n    handleCanPrint() {\n        const preview = this.getPreview();\n        this.setState({ canPrint: !!preview && (!preview.canPrint || preview.canPrint()) });\n    }\n\n    /**\n     * Loads preview in the component using the preview library.\n     *\n     * @return {void}\n     */\n    loadPreview = async (): Promise<void> => {\n        const {\n            annotatorState: { activeAnnotationId } = {},\n            enableThumbnailsSidebar,\n            fileOptions,\n            onAnnotatorEvent,\n            onAnnotator,\n            previewExperiences,\n            showAnnotationsControls,\n            token: tokenOrTokenFunction,\n            ...rest\n        }: Props = this.props;\n        const { file, selectedVersion, startAt }: State = this.state;\n\n        if (!this.isPreviewLibraryLoaded() || !file || !tokenOrTokenFunction) {\n            return;\n        }\n\n        const fileId = this.getFileId(file);\n\n        if (fileId !== this.state.currentFileId) {\n            return;\n        }\n\n        const fileOpts = { ...fileOptions };\n        const token = typedId => TokenService.getReadTokens(typedId, tokenOrTokenFunction);\n\n        if (selectedVersion) {\n            setProp(fileOpts, [fileId, 'fileVersionId'], selectedVersion.id);\n            setProp(fileOpts, [fileId, 'currentFileVersionId'], getProp(file, 'file_version.id'));\n        }\n\n        if (activeAnnotationId) {\n            setProp(fileOpts, [fileId, 'annotations', 'activeId'], activeAnnotationId);\n        }\n\n        if (startAt) {\n            setProp(fileOpts, [fileId, 'startAt'], startAt);\n        }\n\n        const previewOptions = {\n            container: `#${this.id} .bcpr-content`,\n            enableThumbnailsSidebar,\n            fileOptions: fileOpts,\n            header: 'none',\n            headerElement: `#${this.id} .bcpr-PreviewHeader`,\n            experiences: previewExperiences,\n            showAnnotations: this.canViewAnnotations(),\n            showAnnotationsControls,\n            showDownload: this.canDownload(),\n            showLoading: false,\n            showProgress: false,\n            skipServerUpdate: true,\n            useHotkeys: false,\n        };\n        const { Preview } = global.Box;\n        this.preview = new Preview();\n        this.preview.addListener('load', this.onPreviewLoad);\n        this.preview.addListener('preview_error', this.onPreviewError);\n        this.preview.addListener('preview_metric', this.onPreviewMetric);\n        this.preview.addListener('thumbnailsOpen', () => this.setState({ isThumbnailSidebarOpen: true }));\n        this.preview.addListener('thumbnailsClose', () => this.setState({ isThumbnailSidebarOpen: false }));\n\n        if (showAnnotationsControls) {\n            this.preview.addListener('annotator_create', onAnnotator);\n        }\n\n        this.preview.updateFileCache([file]);\n        this.preview.show(file.id, token, {\n            ...previewOptions,\n            ...omit(rest, Object.keys(previewOptions)),\n        });\n    };\n\n    /**\n     * Updates preview file from temporary staged file.\n     *\n     * @return {void}\n     */\n    loadFileFromStage = () => {\n        if (this.stagedFile) {\n            this.setState({ ...this.initialState, file: this.stagedFile }, () => {\n                this.stagedFile = undefined;\n            });\n        }\n    };\n\n    /**\n     * Removes the reload notification\n     *\n     * @return {void}\n     */\n    closeReloadNotification = () => {\n        this.setState({ isReloadNotificationVisible: false });\n    };\n\n    /**\n     * Tells the preview to resize\n     *\n     * @return {void}\n     */\n    onResize = (): void => {\n        if (this.preview && this.preview.getCurrentViewer()) {\n            this.preview.resize();\n        }\n    };\n\n    /**\n     * File fetch success callback\n     *\n     * @param {Object} file - Box file\n     * @return {void}\n     */\n    fetchFileSuccessCallback = (file: BoxItem): void => {\n        this.fetchFileEndTime = performance.now();\n\n        const { file: currentFile }: State = this.state;\n        const isExistingFile = currentFile ? currentFile.id === file.id : false;\n        const isWatermarked = getProp(file, 'watermark_info.is_watermarked', false);\n\n        // If the file is watermarked or if its a new file, then update the state\n        // In this case preview should reload without prompting the user\n        if (isWatermarked || !isExistingFile) {\n            this.setState({ ...this.initialState, file });\n            // $FlowFixMe file version and sha1 should exist at this point\n        } else if (currentFile.file_version.sha1 !== file.file_version.sha1) {\n            // If we are already prevewing the file that got updated then show the\n            // user a notification to reload the file only if its sha1 changed\n            this.stagedFile = file;\n            this.setState({\n                ...this.initialState,\n                isReloadNotificationVisible: true,\n            });\n        }\n    };\n\n    /**\n     * File fetch error callback\n     *\n     * @return {void}\n     */\n    fetchFileErrorCallback = (fileError: ElementsXhrError, code: string): void => {\n        const { onError } = this.props;\n        const errorCode = fileError.code || code;\n        const error = {\n            code: errorCode,\n            message: fileError.message,\n        };\n        this.setState({ error, file: undefined, isLoading: false });\n        onError(fileError, errorCode, {\n            error: fileError,\n        });\n    };\n\n    /**\n     * Fetches a file\n     *\n     * @param {string} id file id\n     * @param {Function|void} [successCallback] - Callback after file is fetched\n     * @param {Function|void} [errorCallback] - Callback after error\n     * @param {Object|void} [fetchOptions] - Fetch options\n     * @return {void}\n     */\n    fetchFile(\n        id: ?string,\n        successCallback?: Function,\n        errorCallback?: Function,\n        fetchOptions: RequestOptions = {},\n    ): void {\n        if (!id) {\n            return;\n        }\n\n        this.fetchFileStartTime = performance.now();\n        this.fetchFileEndTime = null;\n\n        this.api\n            .getFileAPI()\n            .getFile(\n                id,\n                successCallback || this.fetchFileSuccessCallback,\n                errorCallback || this.fetchFileErrorCallback,\n                {\n                    ...fetchOptions,\n                    fields: PREVIEW_FIELDS_TO_FETCH,\n                },\n            );\n    }\n\n    /**\n     * Returns the preview instance\n     *\n     * @return {Preview} current instance of preview\n     */\n    getPreview = (): any => {\n        const { file }: State = this.state;\n        if (!this.preview || !file) {\n            return null;\n        }\n\n        return this.preview;\n    };\n\n    /**\n     * Returns the viewer instance being used by preview.\n     * This will let child components access the viewers.\n     *\n     * @return {Viewer} current instance of the preview viewer\n     */\n    getViewer = (): any => {\n        const preview = this.getPreview();\n        const viewer = preview ? preview.getCurrentViewer() : null;\n        return viewer && viewer.isLoaded() && !viewer.isDestroyed() ? viewer : null;\n    };\n\n    /**\n     * Finds the index of current file inside the collection\n     *\n     * @return {number} -1 if not indexed\n     */\n    getFileIndex() {\n        const { currentFileId }: State = this.state;\n        const { collection }: Props = this.props;\n        if (!currentFileId || collection.length < 2) {\n            return -1;\n        }\n\n        return collection.findIndex(item => {\n            if (typeof item === 'string') {\n                return item === currentFileId;\n            }\n\n            return item.id === currentFileId;\n        });\n    }\n\n    /**\n     * Shows a preview of a file at the specified index in the current collection.\n     *\n     * @public\n     * @param {number} index - Index of file to preview\n     * @return {void}\n     */\n    navigateToIndex(index: number) {\n        const { collection, onNavigate }: Props = this.props;\n        const { length } = collection;\n        if (length < 2 || index < 0 || index > length - 1) {\n            return;\n        }\n\n        const fileOrId = collection[index];\n        const fileId = typeof fileOrId === 'object' ? fileOrId.id || '' : fileOrId;\n\n        this.setState(\n            {\n                currentFileId: fileId,\n            },\n            () => {\n                // Execute navigation callback\n                onNavigate(fileId);\n            },\n        );\n    }\n\n    /**\n     * Shows a preview of the previous file.\n     *\n     * @public\n     * @return {void}\n     */\n    navigateLeft = () => {\n        const currentIndex = this.getFileIndex();\n        const newIndex = currentIndex === 0 ? 0 : currentIndex - 1;\n        if (newIndex !== currentIndex) {\n            this.navigateToIndex(newIndex);\n        }\n    };\n\n    /**\n     * Shows a preview of the next file.\n     *\n     * @public\n     * @return {void}\n     */\n    navigateRight = () => {\n        const { collection }: Props = this.props;\n        const currentIndex = this.getFileIndex();\n        const newIndex = currentIndex === collection.length - 1 ? collection.length - 1 : currentIndex + 1;\n        if (newIndex !== currentIndex) {\n            this.navigateToIndex(newIndex);\n        }\n    };\n\n    /**\n     * Downloads file.\n     *\n     * @public\n     * @return {void}\n     */\n    download = () => {\n        const { onDownload }: Props = this.props;\n        const { file }: State = this.state;\n        if (this.preview) {\n            this.preview.download();\n            onDownload(cloneDeep(file));\n        }\n    };\n\n    /**\n     * Prints file.\n     *\n     * @public\n     * @return {void}\n     */\n    print = () => {\n        if (this.preview) {\n            this.preview.print();\n        }\n    };\n\n    /**\n     * Mouse move handler that is throttled and show\n     * the navigation arrows if applicable.\n     *\n     * @return {void}\n     */\n    onMouseMove = throttle(() => {\n        const viewer = this.getViewer();\n        const isPreviewing = !!viewer;\n        const CLASS_NAVIGATION_VISIBILITY = 'bcpr-nav-is-visible';\n\n        clearTimeout(this.mouseMoveTimeoutID);\n\n        if (!this.previewContainer) {\n            return;\n        }\n\n        // Always assume that navigation arrows will be hidden\n        this.previewContainer.classList.remove(CLASS_NAVIGATION_VISIBILITY);\n\n        // Only show it if either we aren't previewing or if we are then the viewer\n        // is not blocking the show. If we are previewing then the viewer may choose\n        // to not allow navigation arrows. This is mostly useful for videos since the\n        // navigation arrows may interfere with the settings menu inside video player.\n        if (this.previewContainer && (!isPreviewing || viewer.allowNavigationArrows())) {\n            this.previewContainer.classList.add(CLASS_NAVIGATION_VISIBILITY);\n        }\n\n        this.mouseMoveTimeoutID = setTimeout(() => {\n            if (this.previewContainer) {\n                this.previewContainer.classList.remove(CLASS_NAVIGATION_VISIBILITY);\n            }\n        }, 1500);\n    }, 1000);\n\n    /**\n     * Keyboard events\n     *\n     * @return {void}\n     */\n    onKeyDown = (event: SyntheticKeyboardEvent<HTMLElement>) => {\n        const { useHotkeys }: Props = this.props;\n        if (!useHotkeys) {\n            return;\n        }\n\n        let consumed = false;\n        const key = decode(event);\n        const viewer = this.getViewer();\n\n        // If focus was on an input or if the viewer doesn't exist\n        // then don't bother doing anything further\n        if (!key || !viewer || isInputElement(event.target)) {\n            return;\n        }\n\n        if (typeof viewer.onKeydown === 'function') {\n            consumed = !!viewer.onKeydown(key, event.nativeEvent);\n        }\n\n        if (!consumed) {\n            switch (key) {\n                case 'ArrowLeft':\n                    this.navigateLeft();\n                    consumed = true;\n                    break;\n                case 'ArrowRight':\n                    this.navigateRight();\n                    consumed = true;\n                    break;\n                default:\n                // no-op\n            }\n        }\n\n        if (consumed) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    };\n\n    /**\n     * Handles version change events\n     *\n     * @param {string} [version] - The version that is now previewed\n     * @param {object} [additionalVersionInfo] - extra info about the version\n     */\n    onVersionChange = (version?: BoxItemVersion, additionalVersionInfo: AdditionalVersionInfo = {}): void => {\n        const { onVersionChange }: Props = this.props;\n        this.updateVersionToCurrent = additionalVersionInfo.updateVersionToCurrent;\n\n        onVersionChange(version, additionalVersionInfo);\n        this.setState({\n            selectedVersion: version,\n        });\n    };\n\n    handleAnnotationSelect = ({ file_version, id, target }: Annotation) => {\n        const { location = {} } = target;\n        const { file, selectedVersion } = this.state;\n        const annotationFileVersionId = getProp(file_version, 'id');\n        const currentFileVersionId = getProp(file, 'file_version.id');\n        const currentPreviewFileVersionId = getProp(selectedVersion, 'id', currentFileVersionId);\n        const unit = startAtTypes[location.type];\n        const viewer = this.getViewer();\n\n        if (unit && annotationFileVersionId && annotationFileVersionId !== currentPreviewFileVersionId) {\n            this.setState({\n                startAt: {\n                    unit,\n                    value: location.value,\n                },\n            });\n        }\n\n        if (viewer) {\n            viewer.emit('scrolltoannotation', { id, target });\n        }\n    };\n\n    /**\n     * Holds the reference the preview container\n     *\n     * @return {void}\n     */\n    containerRef = (container: ?HTMLDivElement) => {\n        this.previewContainer = container;\n    };\n\n    /**\n     * Refreshes the content sidebar panel\n     *\n     * @return {void}\n     */\n    refreshSidebar(): void {\n        const { current: contentSidebar } = this.contentSidebar;\n\n        if (contentSidebar) {\n            contentSidebar.refresh();\n        }\n    }\n\n    /**\n     * Renders the file preview\n     *\n     * @inheritdoc\n     * @return {Element}\n     */\n    render() {\n        const {\n            apiHost,\n            collection,\n            token,\n            language,\n            messages,\n            className,\n            contentSidebarProps,\n            contentOpenWithProps,\n            hasHeader,\n            history,\n            isLarge,\n            isVeryLarge,\n            logoUrl,\n            onClose,\n            measureRef,\n            sharedLink,\n            sharedLinkPassword,\n            requestInterceptor,\n            responseInterceptor,\n        }: Props = this.props;\n\n        const {\n            canPrint,\n            currentFileId,\n            error,\n            file,\n            isLoading,\n            isReloadNotificationVisible,\n            isThumbnailSidebarOpen,\n            selectedVersion,\n        }: State = this.state;\n\n        const styleClassName = classNames(\n            'be bcpr',\n            {\n                'bcpr-thumbnails-open': isThumbnailSidebarOpen,\n            },\n            className,\n        );\n\n        if (!currentFileId) {\n            return null;\n        }\n\n        const errorCode = getProp(error, 'code');\n        const currentExtension = getProp(file, 'id') === currentFileId ? getProp(file, 'extension') : '';\n        const currentVersionId = getProp(file, 'file_version.id');\n        const selectedVersionId = getProp(selectedVersion, 'id', currentVersionId);\n        const onHeaderClose = currentVersionId === selectedVersionId ? onClose : this.updateVersionToCurrent;\n\n        /* eslint-disable jsx-a11y/no-static-element-interactions */\n        /* eslint-disable jsx-a11y/no-noninteractive-tabindex */\n        return (\n            <Internationalize language={language} messages={messages}>\n                <div id={this.id} className={styleClassName} ref={measureRef} onKeyDown={this.onKeyDown} tabIndex={0}>\n                    {hasHeader && (\n                        <PreviewHeader\n                            file={file}\n                            logoUrl={logoUrl}\n                            token={token}\n                            onClose={onHeaderClose}\n                            onPrint={this.print}\n                            canDownload={this.canDownload()}\n                            canPrint={canPrint}\n                            onDownload={this.download}\n                            contentOpenWithProps={contentOpenWithProps}\n                            canAnnotate={this.canAnnotate()}\n                            selectedVersion={selectedVersion}\n                        />\n                    )}\n                    <div className=\"bcpr-body\">\n                        <div className=\"bcpr-container\" onMouseMove={this.onMouseMove} ref={this.containerRef}>\n                            {file && (\n                                <Measure bounds onResize={this.onResize}>\n                                    {({ measureRef: previewRef }) => <div ref={previewRef} className=\"bcpr-content\" />}\n                                </Measure>\n                            )}\n                            <PreviewMask errorCode={errorCode} extension={currentExtension} isLoading={isLoading} />\n                            <PreviewNavigation\n                                collection={collection}\n                                currentIndex={this.getFileIndex()}\n                                onNavigateLeft={this.navigateLeft}\n                                onNavigateRight={this.navigateRight}\n                            />\n                        </div>\n                        {file && (\n                            <LoadableSidebar\n                                {...contentSidebarProps}\n                                apiHost={apiHost}\n                                token={token}\n                                cache={this.api.getCache()}\n                                fileId={currentFileId}\n                                getPreview={this.getPreview}\n                                getViewer={this.getViewer}\n                                history={history}\n                                isDefaultOpen={isLarge || isVeryLarge}\n                                language={language}\n                                ref={this.contentSidebar}\n                                sharedLink={sharedLink}\n                                sharedLinkPassword={sharedLinkPassword}\n                                requestInterceptor={requestInterceptor}\n                                responseInterceptor={responseInterceptor}\n                                onAnnotationSelect={this.handleAnnotationSelect}\n                                onVersionChange={this.onVersionChange}\n                            />\n                        )}\n                    </div>\n                    {isReloadNotificationVisible && (\n                        <ReloadNotification onClose={this.closeReloadNotification} onClick={this.loadFileFromStage} />\n                    )}\n                </div>\n            </Internationalize>\n        );\n        /* eslint-enable jsx-a11y/no-static-element-interactions */\n        /* eslint-enable jsx-a11y/no-noninteractive-tabindex */\n    }\n}\n\nexport type ContentPreviewProps = Props;\nexport { ContentPreview as ContentPreviewComponent };\nexport default flow([\n    makeResponsive,\n    withAnnotatorContext,\n    withAnnotations,\n    withRouter,\n    withNavRouter,\n    withFeatureProvider,\n    withLogger(ORIGIN_CONTENT_PREVIEW),\n    withErrorBoundary(ORIGIN_CONTENT_PREVIEW),\n])(ContentPreview);\n"],"file":"ContentPreview.js"}