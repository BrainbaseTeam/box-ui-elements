{"version":3,"sources":["../../src/api/Annotations.js"],"names":["merge","ERROR_CODE_CREATE_ANNOTATION","ERROR_CODE_DELETE_ANNOTATION","ERROR_CODE_EDIT_ANNOTATION","ERROR_CODE_FETCH_ANNOTATION","ERROR_CODE_FETCH_ANNOTATIONS","PERMISSION_CAN_CREATE_ANNOTATIONS","PERMISSION_CAN_DELETE","PERMISSION_CAN_EDIT","PERMISSION_CAN_VIEW_ANNOTATIONS","MarkerBasedApi","Annotations","getBaseApiUrl","annotationId","getUrl","fileId","fileVersionId","payload","permissions","successCallback","errorCallback","errorCode","checkApiCallValidity","e","defaults","description","type","file_version","id","status","post","data","url","message","requestData","put","getUrlForId","delete","get","limit","shouldFetchAll","markerGet","file_id","file_version_id"],"mappings":"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","sourcesContent":["// @flow\nimport merge from 'lodash/merge';\nimport {\n    ERROR_CODE_CREATE_ANNOTATION,\n    ERROR_CODE_DELETE_ANNOTATION,\n    ERROR_CODE_EDIT_ANNOTATION,\n    ERROR_CODE_FETCH_ANNOTATION,\n    ERROR_CODE_FETCH_ANNOTATIONS,\n    PERMISSION_CAN_CREATE_ANNOTATIONS,\n    PERMISSION_CAN_DELETE,\n    PERMISSION_CAN_EDIT,\n    PERMISSION_CAN_VIEW_ANNOTATIONS,\n} from '../constants';\nimport MarkerBasedApi from './MarkerBasedAPI';\nimport type {\n    Annotation,\n    AnnotationPermission,\n    Annotations as AnnotationsType,\n    NewAnnotation,\n} from '../common/types/annotations';\nimport type { BoxItemPermission } from '../common/types/core';\nimport type { ElementsXhrError } from '../common/types/api';\n\nexport default class Annotations extends MarkerBasedApi {\n    getUrl() {\n        return `${this.getBaseApiUrl()}/undoc/annotations`;\n    }\n\n    getUrlForId(annotationId: string) {\n        return `${this.getUrl()}/${annotationId}`;\n    }\n\n    createAnnotation(\n        fileId: string,\n        fileVersionId: string,\n        payload: NewAnnotation,\n        permissions: BoxItemPermission,\n        successCallback: (annotation: Annotation) => void,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n    ): void {\n        this.errorCode = ERROR_CODE_CREATE_ANNOTATION;\n\n        try {\n            this.checkApiCallValidity(PERMISSION_CAN_CREATE_ANNOTATIONS, permissions, fileId);\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        const defaults = {\n            description: {\n                type: 'reply',\n            },\n            file_version: {\n                id: fileVersionId,\n                type: 'file_version',\n            },\n            status: 'open',\n            type: 'annotation',\n        };\n\n        this.post({\n            id: fileId,\n            data: {\n                data: merge(defaults, payload),\n            },\n            errorCallback,\n            successCallback,\n            url: this.getUrl(),\n        });\n    }\n\n    updateAnnotation(\n        fileId: string,\n        annotationId: string,\n        permissions: AnnotationPermission,\n        message: string,\n        successCallback: (annotation: Annotation) => void,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n    ): void {\n        this.errorCode = ERROR_CODE_EDIT_ANNOTATION;\n\n        try {\n            this.checkApiCallValidity(PERMISSION_CAN_EDIT, permissions, fileId);\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        const requestData = { data: { description: { message } } };\n\n        this.put({\n            id: fileId,\n            data: requestData,\n            errorCallback,\n            successCallback,\n            url: this.getUrlForId(annotationId),\n        });\n    }\n\n    deleteAnnotation(\n        fileId: string,\n        annotationId: string,\n        permissions: AnnotationPermission,\n        successCallback: () => void,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n    ): void {\n        this.errorCode = ERROR_CODE_DELETE_ANNOTATION;\n\n        try {\n            this.checkApiCallValidity(PERMISSION_CAN_DELETE, permissions, fileId);\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        this.delete({\n            id: fileId,\n            errorCallback,\n            successCallback,\n            url: this.getUrlForId(annotationId),\n        });\n    }\n\n    getAnnotation(\n        fileId: string,\n        annotationId: string,\n        permissions: BoxItemPermission,\n        successCallback: (annotation: Annotation) => void,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n    ): void {\n        this.errorCode = ERROR_CODE_FETCH_ANNOTATION;\n\n        try {\n            this.checkApiCallValidity(PERMISSION_CAN_VIEW_ANNOTATIONS, permissions, fileId);\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        this.get({\n            id: fileId,\n            errorCallback,\n            successCallback,\n            url: this.getUrlForId(annotationId),\n        });\n    }\n\n    getAnnotations(\n        fileId: string,\n        fileVersionId?: string,\n        permissions: BoxItemPermission,\n        successCallback: (annotations: AnnotationsType) => void,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n        limit?: number,\n        shouldFetchAll?: boolean,\n    ): void {\n        this.errorCode = ERROR_CODE_FETCH_ANNOTATIONS;\n\n        try {\n            this.checkApiCallValidity(PERMISSION_CAN_VIEW_ANNOTATIONS, permissions, fileId);\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        this.markerGet({\n            id: fileId,\n            errorCallback,\n            limit,\n            requestData: {\n                file_id: fileId,\n                file_version_id: fileVersionId,\n            },\n            shouldFetchAll,\n            successCallback,\n        });\n    }\n}\n"],"file":"Annotations.js"}