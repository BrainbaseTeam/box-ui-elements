{"version":3,"sources":["../../src/api/Base.js"],"names":["noop","Xhr","Cache","getTypedFileId","getBadItemError","getBadPermissionsError","DEFAULT_HOSTNAME_API","DEFAULT_HOSTNAME_UPLOAD","HTTP_GET","HTTP_POST","HTTP_PUT","HTTP_DELETE","Base","options","data","isDestroyed","successCallback","error","errorCallback","response","errorCode","cache","apiHost","uploadHost","xhr","destroyed","consoleLog","window","console","log","consoleError","abort","permissionToCheck","permissions","id","permission","suffix","endsWith","Error","entry","requestData","url","apiUrl","getUrl","makeRequest","method","xhrMethod","toLowerCase","bind","successHandler","errorHandler"],"mappings":"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","sourcesContent":["/**\n * @flow\n * @file Base class with utility methods for API calls\n * @author Box\n */\n\nimport noop from 'lodash/noop';\nimport Xhr from '../utils/Xhr';\nimport Cache from '../utils/Cache';\nimport { getTypedFileId } from '../utils/file';\nimport { getBadItemError, getBadPermissionsError } from '../utils/error';\nimport {\n    DEFAULT_HOSTNAME_API,\n    DEFAULT_HOSTNAME_UPLOAD,\n    HTTP_GET,\n    HTTP_POST,\n    HTTP_PUT,\n    HTTP_DELETE,\n} from '../constants';\n\nclass Base {\n    /**\n     * @property {Cache}\n     */\n    cache: APICache;\n\n    /**\n     * @property {boolean}\n     */\n    destroyed: boolean;\n\n    /**\n     * @property {Xhr}\n     */\n    xhr: Xhr;\n\n    /**\n     * @property {string}\n     */\n    apiHost: string;\n\n    /**\n     * @property {string}\n     */\n    uploadHost: string;\n\n    /**\n     * @property {*}\n     */\n    options: Options;\n\n    /**\n     * @property {Function}\n     */\n    consoleLog: Function;\n\n    /**\n     * @property {Function}\n     */\n    consoleError: Function;\n\n    /**\n     * @property {string}\n     */\n    errorCode: string;\n\n    /**\n     * @property {Function}\n     */\n    successCallback: (data?: Object) => void;\n\n    /**\n     * @property {Function}\n     */\n    errorCallback: ElementsErrorCallback;\n\n    /**\n     * [constructor]\n     *\n     * @param {Object} [options]\n     * @param {string} [options.token] - Auth token\n     * @param {string} [options.sharedLink] - Shared link\n     * @param {string} [options.sharedLinkPassword] - Shared link password\n     * @param {string} [options.apiHost] - Api host\n     * @param {string} [options.uploadHost] - Upload host name\n     * @return {Base} Base instance\n     */\n    constructor(options: Options) {\n        this.cache = options.cache || new Cache();\n        this.apiHost = options.apiHost || DEFAULT_HOSTNAME_API;\n        this.uploadHost = options.uploadHost || DEFAULT_HOSTNAME_UPLOAD;\n        // @TODO: avoid keeping another copy of data in this.options\n        this.options = { ...options, apiHost: this.apiHost, uploadHost: this.uploadHost, cache: this.cache };\n        this.xhr = new Xhr(this.options);\n        this.destroyed = false;\n        this.consoleLog = !!options.consoleLog && !!window.console ? window.console.log || noop : noop;\n        this.consoleError = !!options.consoleError && !!window.console ? window.console.error || noop : noop;\n    }\n\n    /**\n     * [destructor]\n     *\n     * @return {void}\n     */\n    destroy(): void {\n        this.xhr.abort();\n        this.destroyed = true;\n    }\n\n    /**\n     * Asks the API if its destructor has been called\n     *\n     * @return {void}\n     */\n    isDestroyed(): boolean {\n        return this.destroyed;\n    }\n\n    /**\n     * Checks that our desired API call has sufficient permissions and an item ID\n     *\n     * @param {string} permissionToCheck - Permission to check\n     * @param {Object} permissions - Permissions object\n     * @param {string} id - Item id\n     * @return {void}\n     */\n    checkApiCallValidity(permissionToCheck: string, permissions?: Object, id?: string): void {\n        if (!id || !permissions) {\n            throw getBadItemError();\n        }\n\n        const permission = permissions[permissionToCheck];\n        if (!permission) {\n            throw getBadPermissionsError();\n        }\n    }\n\n    /**\n     * Base URL for api\n     *\n     * @return {string} base url\n     */\n    getBaseApiUrl(): string {\n        const suffix: string = this.apiHost.endsWith('/') ? '2.0' : '/2.0';\n        return `${this.apiHost}${suffix}`;\n    }\n\n    /**\n     * Base URL for api uploads\n     *\n     * @return {string} base url\n     */\n    getBaseUploadUrl(): string {\n        const suffix: string = this.uploadHost.endsWith('/') ? 'api/2.0' : '/api/2.0';\n        return `${this.uploadHost}${suffix}`;\n    }\n\n    /**\n     * Gets the cache instance\n     *\n     * @return {Cache} cache instance\n     */\n    getCache(): APICache {\n        return this.cache;\n    }\n\n    /**\n     * Generic success handler\n     *\n     * @param {Object} data - The response data\n     */\n    successHandler = (data: any): void => {\n        if (!this.isDestroyed() && typeof this.successCallback === 'function') {\n            this.successCallback(data);\n        }\n    };\n\n    /**\n     * Generic error handler\n     *\n     * @param {Object} data - The response data\n     * @param {Function} errorCallback the error callback\n     */\n    errorHandler = (error: $AxiosError<any>): void => {\n        if (!this.isDestroyed() && typeof this.errorCallback === 'function') {\n            const { response } = error;\n\n            if (response && response.data) {\n                this.errorCallback(response.data, this.errorCode);\n            } else {\n                this.errorCallback(error, this.errorCode);\n            }\n        }\n    };\n\n    /**\n     * Gets the URL for the API, meant to be overridden\n     * @param {string} id - The item id\n     */\n    /* eslint-disable no-unused-vars */\n    getUrl(id: string) {\n        /* eslint-enable no-unused-vars */\n        throw new Error('Implement me!');\n    }\n\n    /**\n     * Formats an API entry for use in components\n     * @param {string} entry - an API response entry\n     */\n    /* eslint-disable no-unused-vars */\n    format(entry: Object) {\n        /* eslint-enable no-unused-vars */\n        throw new Error('Implement me!');\n    }\n\n    /**\n     * Generic API GET\n     *\n     * @param {string} id - The file id\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     * @param {Object} requestData - additional request data\n     * @param {string} url - API url\n     * @returns {Promise}\n     */\n    get({\n        id,\n        successCallback,\n        errorCallback,\n        requestData, // Note: this is inconsistent, other methods use `data`\n        url,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        id: string,\n        requestData?: Object,\n        successCallback: Function,\n        url?: string,\n    }): Promise<any> {\n        const apiUrl = url || this.getUrl(id);\n        return this.makeRequest(HTTP_GET, id, apiUrl, successCallback, errorCallback, requestData);\n    }\n\n    /**\n     * Generic API POST\n     *\n     * @param {string} id - The file id\n     * @param {string} url - The url to post to\n     * @param {Object} data - The data to post\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     */\n    post({\n        id,\n        url,\n        data,\n        successCallback,\n        errorCallback,\n    }: {\n        data: Object,\n        errorCallback: ElementsErrorCallback,\n        id: string,\n        successCallback: Function,\n        url: string,\n    }): Promise<any> {\n        return this.makeRequest(HTTP_POST, id, url, successCallback, errorCallback, data);\n    }\n\n    /**\n     * Generic API PUT\n     *\n     * @param {string} id - The file id\n     * @param {string} url - The url to put to\n     * @param {Object} data - The data to put\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     */\n    put({\n        id,\n        url,\n        data,\n        successCallback,\n        errorCallback,\n    }: {\n        data: Object,\n        errorCallback: ElementsErrorCallback,\n        id: string,\n        successCallback: Function,\n        url: string,\n    }): Promise<any> {\n        return this.makeRequest(HTTP_PUT, id, url, successCallback, errorCallback, data);\n    }\n\n    /**\n     * Generic API DELETE\n     *\n     * @param {string} id - The file id\n     * @param {string} url - The url of the item to delete\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     * @param {Object} data optional data to delete\n     */\n    delete({\n        id,\n        url,\n        data,\n        successCallback,\n        errorCallback,\n    }: {\n        data?: Object,\n        errorCallback: ElementsErrorCallback,\n        id: string,\n        successCallback: Function,\n        url: string,\n    }): Promise<any> {\n        return this.makeRequest(HTTP_DELETE, id, url, successCallback, errorCallback, data);\n    }\n\n    /**\n     * Generic API CRUD operations\n     *\n     * @param {string} method - which REST method to execute (GET, POST, PUT, DELETE)\n     * @param {string} id - The file id\n     * @param {string} url - The url of the item to operate on\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     * @param {Object} requestData - Optional info to be added to the API call such as params or request body data\n     */\n    async makeRequest(\n        method: string,\n        id: string,\n        url: string,\n        successCallback: Function,\n        errorCallback: ElementsErrorCallback,\n        requestData: Object = {},\n    ): Promise<void> {\n        if (this.isDestroyed()) {\n            return;\n        }\n\n        this.successCallback = successCallback;\n        this.errorCallback = errorCallback;\n\n        // $FlowFixMe\n        const xhrMethod: Function = this.xhr[method.toLowerCase()].bind(this.xhr);\n        try {\n            const { data } = await xhrMethod({\n                id: getTypedFileId(id),\n                url,\n                ...requestData,\n            });\n            this.successHandler(data);\n        } catch (error) {\n            this.errorHandler(error);\n        }\n    }\n}\n\nexport default Base;\n"],"file":"Base.js"}