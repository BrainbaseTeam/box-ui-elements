{"version":3,"sources":["../../../src/api/tasks/TasksNew.js"],"names":["TasksBase","ERROR_CODE_CREATE_TASK","ERROR_CODE_UPDATE_TASK","ERROR_CODE_DELETE_TASK","ERROR_CODE_FETCH_TASKS","API_PAGE_LIMIT","TasksNew","id","getBaseApiUrl","errorCallback","file","successCallback","task","errorCode","createTaskCollabsPayload","addedAssignees","map","assignee","op","item","type","payload","target","deleteTaskCollabsPayload","removedAssignees","updateTaskPayload","put","url","getUrlForTaskWithDeps","data","delete","getUrlForTask","get","getUrlForFileTasks","assignees","createTaskLinksPayload","createTaskWithDepsPayload","assigned_to","task_links","post","getUrlForTaskCreateWithDeps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;AAMA,OAAOA,SAAP,MAAsB,aAAtB;AACA,SACIC,sBADJ,EAEIC,sBAFJ,EAGIC,sBAHJ,EAIIC,sBAJJ,EAKIC,cALJ,QAMO,iBANP;;IAWMC,Q;;;;;;;;;;;;;uCACiBC,E,EAAoB;AACnC,uBAAU,KAAKC,aAAL,EAAV,0BAA8CD,EAA9C,iCAAuEF,cAAvE;AACH;;;kDAEqC;AAClC,uBAAU,KAAKG,aAAL,EAAV;AACH;;;kCAEaD,E,EAAoB;AAC9B,uBAAU,KAAKC,aAAL,EAAV,0BAA8CD,EAA9C;AACH;;;0CAEqBA,E,EAAoB;AACtC,uBAAU,KAAKC,aAAL,EAAV,0BAA8CD,EAA9C;AACH;;;6CAYQ;AAAA,UATLE,aASK,QATLA,aASK;AAAA,UARLC,IAQK,QARLA,IAQK;AAAA,UAPLC,eAOK,QAPLA,eAOK;AAAA,UANLC,IAMK,QANLA,IAMK;AACL,WAAKC,SAAL,GAAiBX,sBAAjB;AAEA,UAAMY,wBAAwB,GAAGF,IAAI,CAACG,cAAL,CAAoBC,GAApB,CAAwB,UAAAC,QAAQ,EAAI;AACjE,eAAO;AACHC,UAAAA,EAAE,EACED,QAAQ,CAACE,IAAT,IAAiBF,QAAQ,CAACE,IAAT,CAAcC,IAAd,KAAuB,OAAxC,GACM,qCADN,GAEM,uBAJP;AAKHC,UAAAA,OAAO,EAAE;AACLC,YAAAA,MAAM,EAAE;AACJF,cAAAA,IAAI,EAAEH,QAAQ,CAACE,IAAT,IAAiBF,QAAQ,CAACE,IAAT,CAAcC,IAAd,KAAuB,OAAxC,GAAkD,OAAlD,GAA4D,MAD9D;AAEJb,cAAAA,EAAE,EAAEU,QAAQ,CAACV;AAFT;AADH;AALN,SAAP;AAYH,OAbgC,CAAjC;AAeA,UAAMgB,wBAAwB,GAAGX,IAAI,CAACY,gBAAL,CAAsBR,GAAtB,CAA0B,UAAAC,QAAQ,EAAI;AACnE,eAAO;AACHC,UAAAA,EAAE,EAAE,0BADD;AAEHX,UAAAA,EAAE,EAAEU,QAAQ,CAACV;AAFV,SAAP;AAIH,OALgC,CAAjC;;AAlBK,UAyBGA,EAzBH,GAyBkEK,IAzBlE,CAyBGL,EAzBH;AAAA,UAyBOQ,cAzBP,GAyBkEH,IAzBlE,CAyBOG,cAzBP;AAAA,UAyBuBS,gBAzBvB,GAyBkEZ,IAzBlE,CAyBuBY,gBAzBvB;AAAA,UAyB4CC,iBAzB5C,4BAyBkEb,IAzBlE;;AA0BL,WAAKc,GAAL,CAAS;AACLnB,QAAAA,EAAE,EAAEG,IAAI,CAACH,EADJ;AAELoB,QAAAA,GAAG,EAAE,KAAKC,qBAAL,CAA2BhB,IAAI,CAACL,EAAhC,CAFA;AAGLsB,QAAAA,IAAI,EAAE;AACFA,UAAAA,IAAI,GACA;AACIX,YAAAA,EAAE,EAAE,aADR;AAEIG,YAAAA,OAAO,oBAAOI,iBAAP;AAFX,WADA,4BAKGX,wBALH,sBAMGS,wBANH;AADF,SAHD;AAaLZ,QAAAA,eAAe,EAAfA,eAbK;AAcLF,QAAAA,aAAa,EAAbA;AAdK,OAAT;AAgBH;;;sCAYQ;AAAA,UATLA,aASK,SATLA,aASK;AAAA,UARLC,IAQK,SARLA,IAQK;AAAA,UAPLC,eAOK,SAPLA,eAOK;AAAA,UANLC,IAMK,SANLA,IAMK;AACL,WAAKC,SAAL,GAAiBV,sBAAjB;AAEA,WAAK2B,MAAL,CAAY;AACRvB,QAAAA,EAAE,EAAEG,IAAI,CAACH,EADD;AAERoB,QAAAA,GAAG,EAAE,KAAKI,aAAL,CAAmBnB,IAAI,CAACL,EAAxB,CAFG;AAGRI,QAAAA,eAAe,EAAfA,eAHQ;AAIRF,QAAAA,aAAa,EAAbA;AAJQ,OAAZ;AAMH;;;2CAUQ;AAAA,UAPLA,aAOK,SAPLA,aAOK;AAAA,UANLC,IAMK,SANLA,IAMK;AAAA,UALLC,eAKK,SALLA,eAKK;AACL,WAAKE,SAAL,GAAiBT,sBAAjB;AACA,WAAK4B,GAAL,CAAS;AACLzB,QAAAA,EAAE,EAAEG,IAAI,CAACH,EADJ;AAELoB,QAAAA,GAAG,EAAE,KAAKM,kBAAL,CAAwBvB,IAAI,CAACH,EAA7B,CAFA;AAGLI,QAAAA,eAAe,EAAfA,eAHK;AAILF,QAAAA,aAAa,EAAbA;AAJK,OAAT;AAMH;;;mCAYQ;AAAA,UATLA,aASK,SATLA,aASK;AAAA,UARLC,IAQK,SARLA,IAQK;AAAA,UAPLH,EAOK,SAPLA,EAOK;AAAA,UANLI,eAMK,SANLA,eAMK;AACL,WAAKE,SAAL,GAAiBT,sBAAjB;AACA,WAAK4B,GAAL,CAAS;AACLzB,QAAAA,EAAE,EAAEG,IAAI,CAACH,EADJ;AAELoB,QAAAA,GAAG,EAAE,KAAKI,aAAL,CAAmBxB,EAAnB,CAFA;AAGLI,QAAAA,eAAe,EAAfA,eAHK;AAILF,QAAAA,aAAa,EAAbA;AAJK,OAAT;AAMH;;;8CAcQ;AAAA,UAXLA,aAWK,SAXLA,aAWK;AAAA,UAVLC,IAUK,SAVLA,IAUK;AAAA,UATLC,eASK,SATLA,eASK;AAAA,UARLC,IAQK,SARLA,IAQK;AAAA,UAPLsB,SAOK,SAPLA,SAOK;AACL,WAAKrB,SAAL,GAAiBZ,sBAAjB;AAEA,UAAMa,wBAAwB,GAAGoB,SAAS,CAAClB,GAAV,CAAc,UAACC,QAAD,EAAkD;AAC7F,eAAO;AACHK,UAAAA,MAAM,EAAE;AACJF,YAAAA,IAAI,EAAEH,QAAQ,CAACE,IAAT,IAAiBF,QAAQ,CAACE,IAAT,CAAcC,IAAd,KAAuB,OAAxC,GAAkD,OAAlD,GAA4D,MAD9D;AAEJb,YAAAA,EAAE,EAAEU,QAAQ,CAACV;AAFT;AADL,SAAP;AAMH,OAPgC,CAAjC;AASA,UAAM4B,sBAAsB,GAAG,CAC3B;AACIb,QAAAA,MAAM,EAAE;AACJf,UAAAA,EAAE,EAAEG,IAAI,CAACH,EADL;AAEJa,UAAAA,IAAI,EAAE;AAFF;AADZ,OAD2B,CAA/B;AASA,UAAMgB,yBAAyB,GAAG;AAC9BxB,QAAAA,IAAI,oBAAOA,IAAP,CAD0B;AAE9ByB,QAAAA,WAAW,EAAEvB,wBAFiB;AAG9BwB,QAAAA,UAAU,EAAEH;AAHkB,OAAlC;AAMA,WAAKI,IAAL,CAAU;AACNhC,QAAAA,EAAE,EAAEG,IAAI,CAACH,EADH;AAENoB,QAAAA,GAAG,EAAE,KAAKa,2BAAL,EAFC;AAGNX,QAAAA,IAAI,EAAE;AAAEA,UAAAA,IAAI,oBAAOO,yBAAP;AAAN,SAHA;AAINzB,QAAAA,eAAe,EAAfA,eAJM;AAKNF,QAAAA,aAAa,EAAbA;AALM,OAAV;AAOH;;;;EAhLkBT,S;;AAmLvB,eAAeM,QAAf","sourcesContent":["/**\n * @flow\n * @file Helper for the box Tasks API\n * @author Box\n */\n\nimport TasksBase from './TasksBase';\nimport {\n    ERROR_CODE_CREATE_TASK,\n    ERROR_CODE_UPDATE_TASK,\n    ERROR_CODE_DELETE_TASK,\n    ERROR_CODE_FETCH_TASKS,\n    API_PAGE_LIMIT,\n} from '../../constants';\nimport type { TaskUpdatePayload } from '../../common/types/tasks';\nimport type { ElementsXhrError, ElementsErrorCallback } from '../../common/types/api';\nimport type { SelectorItems, SelectorItem, UserMini, GroupMini, BoxItem } from '../../common/types/core';\n\nclass TasksNew extends TasksBase {\n    getUrlForFileTasks(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/files/${id}/linked_tasks?limit=${API_PAGE_LIMIT}`;\n    }\n\n    getUrlForTaskCreateWithDeps(): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/with_dependencies`;\n    }\n\n    getUrlForTask(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/${id}`;\n    }\n\n    getUrlForTaskWithDeps(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/${id}/with_dependencies`;\n    }\n\n    updateTaskWithDeps({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: BoxItem,\n        successCallback: Function,\n        task: TaskUpdatePayload,\n    }): void {\n        this.errorCode = ERROR_CODE_UPDATE_TASK;\n\n        const createTaskCollabsPayload = task.addedAssignees.map(assignee => {\n            return {\n                op:\n                    assignee.item && assignee.item.type === 'group'\n                        ? 'add_task_collaborators_expand_group'\n                        : 'add_task_collaborator',\n                payload: {\n                    target: {\n                        type: assignee.item && assignee.item.type === 'group' ? 'group' : 'user',\n                        id: assignee.id,\n                    },\n                },\n            };\n        });\n\n        const deleteTaskCollabsPayload = task.removedAssignees.map(assignee => {\n            return {\n                op: 'delete_task_collaborator',\n                id: assignee.id,\n            };\n        });\n\n        const { id, addedAssignees, removedAssignees, ...updateTaskPayload } = task;\n        this.put({\n            id: file.id,\n            url: this.getUrlForTaskWithDeps(task.id),\n            data: {\n                data: [\n                    {\n                        op: 'update_task',\n                        payload: { ...updateTaskPayload },\n                    },\n                    ...createTaskCollabsPayload,\n                    ...deleteTaskCollabsPayload,\n                ],\n            },\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    deleteTask({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: BoxItem,\n        successCallback: Function,\n        task: { id: string },\n    }): void {\n        this.errorCode = ERROR_CODE_DELETE_TASK;\n\n        this.delete({\n            id: file.id,\n            url: this.getUrlForTask(task.id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    getTasksForFile({\n        errorCallback,\n        file,\n        successCallback,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: { id: string },\n        successCallback: Function,\n    }): void {\n        this.errorCode = ERROR_CODE_FETCH_TASKS;\n        this.get({\n            id: file.id,\n            url: this.getUrlForFileTasks(file.id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    getTask({\n        errorCallback,\n        file,\n        id,\n        successCallback,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: { id: string },\n        id: string,\n        successCallback: Function,\n    }): void {\n        this.errorCode = ERROR_CODE_FETCH_TASKS;\n        this.get({\n            id: file.id,\n            url: this.getUrlForTask(id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    createTaskWithDeps({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n        assignees,\n    }: {\n        assignees: SelectorItems<UserMini | GroupMini>,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n        file: BoxItem,\n        successCallback: Function,\n        task: {}, // Partial task object\n    }): void {\n        this.errorCode = ERROR_CODE_CREATE_TASK;\n\n        const createTaskCollabsPayload = assignees.map((assignee: SelectorItem<UserMini | GroupMini>) => {\n            return {\n                target: {\n                    type: assignee.item && assignee.item.type === 'group' ? 'group' : 'user',\n                    id: assignee.id,\n                },\n            };\n        });\n\n        const createTaskLinksPayload = [\n            {\n                target: {\n                    id: file.id,\n                    type: 'file',\n                },\n            },\n        ];\n\n        const createTaskWithDepsPayload = {\n            task: { ...task },\n            assigned_to: createTaskCollabsPayload,\n            task_links: createTaskLinksPayload,\n        };\n\n        this.post({\n            id: file.id,\n            url: this.getUrlForTaskCreateWithDeps(),\n            data: { data: { ...createTaskWithDepsPayload } },\n            successCallback,\n            errorCallback,\n        });\n    }\n}\n\nexport default TasksNew;\n"],"file":"TasksNew.js"}