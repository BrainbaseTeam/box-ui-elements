{"version":3,"sources":["../../../src/components/pill-selector-dropdown/PillSelectorDropdown.js"],"names":["React","classNames","List","noop","parseCSV","Label","SelectorDropdown","PillSelector","PillSelectorDropdown","inputValue","isInCompositionMode","props","allowInvalidPills","parseItems","validator","pills","filter","pill","normalizedPills","map","displayText","text","value","allowCustomPills","onPillCreate","onSelect","selectedOptions","shouldClearUnmatchedInput","validateForError","parsePills","length","resetInputValue","event","onBlur","state","addPillsFromInput","target","setState","onInput","preventDefault","clipboardData","getData","index","selectorOptions","selectedOption","get","handleInput","children","className","disabled","dividerIndex","dropdownScrollBoundarySelector","error","inputProps","label","onRemove","onSuggestedPillAdd","overlayTitle","placeholder","suggestedPillsData","suggestedPillsFilter","suggestedPillsTitle","shouldSetActiveItemOnOpen","handleEnter","handleSelect","handleCompositionEnd","handleCompositionStart","handleBlur","handlePaste","Component"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { List } from 'immutable';\nimport noop from 'lodash/noop';\n\nimport parseCSV from '../../utils/parseCSV';\nimport Label from '../label';\nimport SelectorDropdown from '../selector-dropdown';\n\nimport PillSelector from './PillSelector';\nimport type { contactType as Contact } from '../../features/unified-share-modal/flowTypes';\nimport type { SelectOptionProp } from '../select-field/props';\nimport type { Option, OptionValue, SelectedOptions, SuggestedPillsFilter } from './flowTypes';\n\nimport './PillSelectorDropdown.scss';\n\ntype Props = {\n    /** If true, user can add pills not included in selector options */\n    allowCustomPills: boolean,\n    /** If true, pills with errors are parsed as pills also */\n    allowInvalidPills: boolean,\n    /** `DatalistItem` components for dropdown options to select */\n    children: React.Node,\n    /** CSS class for the component */\n    className?: string,\n    /** If true, the input control is disabled so no more input can be made */\n    disabled: boolean,\n    /** Index at which to insert a divider */\n    dividerIndex?: number,\n    /** A CSS selector matching the element to use as a boundary when auto-scrolling dropdown elements into view. When not provided, boundary will be determined by scrollIntoView utility function */\n    dropdownScrollBoundarySelector?: string,\n    /** Error message */\n    error?: React.Node,\n    /** Passed in by `SelectorDropdown` for accessibility */\n    inputProps: Object,\n    /** Input label */\n    label: React.Node,\n    /** Called when pill selector input is blurred */\n    onBlur: (event: SyntheticInputEvent<HTMLInputElement>) => void,\n    /** Should update selectorOptions based on the given input value */\n    onInput: Function,\n    /** Called when creating pills */\n    onPillCreate: (pills: Array<SelectOptionProp | Contact>) => void,\n    /** Should update selectedOptions given the option and index to remove */\n    onRemove: Function,\n    /** Should update selectedOptions given an array of pills and the event */\n    onSelect: Function,\n    /** Function adds a collaborator from suggested collabs to form */\n    onSuggestedPillAdd?: Function,\n    /** Optional title of the overlay */\n    overlayTitle?: string,\n    /** function to parse user input into an array of items to be validated and then added to pill selector. If this function is not passed, a default CSV parser is used. */\n    parseItems?: Function,\n    /** A placeholder to show in the input when there are no pills */\n    placeholder: string,\n    /** Array or Immutable list with data for the selected options shown as pills */\n    selectedOptions: SelectedOptions,\n    /** Array or Immutable list with data for the dropdown options to select */\n    selectorOptions: Array<Object> | List<Object>,\n    /** Determines whether or not input text is cleared automatically when it does not result in new pills being added */\n    shouldClearUnmatchedInput?: boolean,\n    /** Determines whether or not the first item is highlighted automatically when the dropdown opens */\n    shouldSetActiveItemOnOpen?: boolean,\n    /** Array of suggested collaborators */\n    suggestedPillsData?: Array<Object>,\n    /** String decribes the datapoint to filter by so that items in the form are not shown in suggestions. */\n    suggestedPillsFilter?: SuggestedPillsFilter,\n    /** String describes the suggested pills */\n    suggestedPillsTitle?: string,\n    /** Validate the given input value, and update `error` prop if necessary */\n    validateForError?: Function,\n    /** Called to check if pill item data is valid. The `item` is passed in. */\n    validator: (option: Option | OptionValue) => boolean,\n};\n\ntype State = {\n    inputValue: string,\n    isInCompositionMode: boolean,\n};\n\nclass PillSelectorDropdown extends React.Component<Props, State> {\n    static defaultProps = {\n        allowCustomPills: false,\n        allowInvalidPills: false,\n        disabled: false,\n        error: '',\n        inputProps: {},\n        label: '',\n        onBlur: noop,\n        onPillCreate: noop,\n        placeholder: '',\n        selectedOptions: [],\n        selectorOptions: [],\n        shouldClearUnmatchedInput: false,\n        shouldSetActiveItemOnOpen: false,\n        validator: () => true,\n    };\n\n    state = { inputValue: '', isInCompositionMode: false };\n\n    parsePills = (inputValue: string) => {\n        const { allowInvalidPills, parseItems, validator } = this.props;\n        let pills = parseItems ? parseItems(inputValue) : parseCSV(inputValue);\n\n        if (!pills) {\n            return [];\n        }\n\n        if (!allowInvalidPills) {\n            pills = pills.filter(pill => validator(pill));\n        }\n\n        const normalizedPills = pills.map(pill =>\n            typeof pill === 'string'\n                ? {\n                      displayText: pill,\n                      text: pill, // deprecated, left for backwards compatibility\n                      value: pill,\n                  }\n                : pill,\n        );\n        return normalizedPills;\n    };\n\n    addPillsFromInput = (inputValue: string) => {\n        const {\n            allowCustomPills,\n            onPillCreate,\n            onSelect,\n            selectedOptions,\n            shouldClearUnmatchedInput,\n            validateForError,\n        } = this.props;\n\n        // Do nothing if custom pills are not allowed\n        if (!allowCustomPills) {\n            return;\n        }\n\n        // Parse pills from input\n        const pills = this.parsePills(inputValue);\n\n        // \"Select\" the pills\n        if (pills.length > 0) {\n            onSelect(pills);\n            onPillCreate(pills);\n\n            this.resetInputValue();\n        } else {\n            if (validateForError && (inputValue !== '' || selectedOptions.length === 0)) {\n                /**\n                 * If no pills were added, but an inputValue exists or\n                 * there are no pills selected, check for errors\n                 */\n                validateForError(inputValue);\n            }\n            if (shouldClearUnmatchedInput) {\n                this.resetInputValue();\n            }\n        }\n    };\n\n    handleBlur = (event: SyntheticInputEvent<HTMLInputElement>) => {\n        const { onBlur } = this.props;\n        const { inputValue } = this.state;\n        this.addPillsFromInput(inputValue);\n        onBlur(event);\n    };\n\n    handleInput = (event: SyntheticInputEvent<HTMLInputElement> | { target: HTMLInputElement | Object }) => {\n        const { target } = event;\n        const { value } = target;\n        this.setState({ inputValue: value });\n        this.props.onInput(value, event);\n    };\n\n    handleEnter = (event: SyntheticEvent<>) => {\n        const { isInCompositionMode, inputValue } = this.state;\n        if (!isInCompositionMode) {\n            event.preventDefault();\n            this.addPillsFromInput(inputValue);\n        }\n    };\n\n    handlePaste = (event: SyntheticClipboardEvent<HTMLInputElement>) => {\n        event.preventDefault();\n\n        const inputValue: string = event.clipboardData.getData('text');\n        this.setState({ inputValue });\n        this.props.onInput(inputValue, event);\n        this.addPillsFromInput(inputValue);\n    };\n\n    handleSelect = (index: number, event: SyntheticEvent<>) => {\n        const { onPillCreate, onSelect, selectorOptions } = this.props;\n        const selectedOption =\n            // $FlowFixMe\n            typeof selectorOptions.get === 'function' ? selectorOptions.get(index) : selectorOptions[index];\n\n        onSelect([selectedOption], event);\n        onPillCreate([selectedOption]);\n\n        this.handleInput({ target: { value: '' } });\n    };\n\n    handleCompositionStart = () => {\n        this.setState({ isInCompositionMode: true });\n    };\n\n    handleCompositionEnd = () => {\n        this.setState({ isInCompositionMode: false });\n    };\n\n    resetInputValue = () => {\n        const { onInput } = this.props;\n\n        this.setState({ inputValue: '' });\n        onInput('');\n    };\n\n    render() {\n        const {\n            allowInvalidPills,\n            children,\n            className,\n            disabled,\n            dividerIndex,\n            dropdownScrollBoundarySelector,\n            error,\n            inputProps,\n            label,\n            onRemove,\n            onSuggestedPillAdd,\n            overlayTitle,\n            placeholder,\n            selectedOptions,\n            suggestedPillsData,\n            suggestedPillsFilter,\n            suggestedPillsTitle,\n            shouldSetActiveItemOnOpen,\n            validator,\n        } = this.props;\n\n        return (\n            <Label text={label}>\n                <SelectorDropdown\n                    className={classNames('pill-selector-wrapper', className)}\n                    dividerIndex={dividerIndex}\n                    onEnter={this.handleEnter}\n                    onSelect={this.handleSelect}\n                    overlayTitle={overlayTitle}\n                    scrollBoundarySelector={dropdownScrollBoundarySelector}\n                    shouldSetActiveItemOnOpen={shouldSetActiveItemOnOpen}\n                    selector={\n                        <PillSelector\n                            onChange={noop} // fix console error\n                            onCompositionEnd={this.handleCompositionEnd}\n                            onCompositionStart={this.handleCompositionStart}\n                            {...inputProps}\n                            allowInvalidPills={allowInvalidPills}\n                            disabled={disabled}\n                            error={error}\n                            onBlur={this.handleBlur}\n                            onInput={this.handleInput}\n                            onPaste={this.handlePaste}\n                            onRemove={onRemove}\n                            onSuggestedPillAdd={onSuggestedPillAdd}\n                            placeholder={placeholder}\n                            selectedOptions={selectedOptions}\n                            suggestedPillsData={suggestedPillsData}\n                            suggestedPillsFilter={suggestedPillsFilter}\n                            suggestedPillsTitle={suggestedPillsTitle}\n                            validator={validator}\n                            value={this.state.inputValue}\n                        />\n                    }\n                >\n                    {children}\n                </SelectorDropdown>\n            </Label>\n        );\n    }\n}\n\nexport default PillSelectorDropdown;\n"],"file":"PillSelectorDropdown.js"}