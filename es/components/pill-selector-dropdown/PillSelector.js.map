{"version":3,"sources":["../../../src/components/pill-selector-dropdown/PillSelector.js"],"names":["React","classNames","uniqueId","Tooltip","KEYS","Pill","SuggestedPillsRow","stopDefaultEvent","event","preventDefault","stopPropagation","PillSelector","isFocused","selectedIndex","selectedOptions","props","size","length","key","map","option","inputEl","focus","setState","inputValue","value","numPills","getNumSelected","state","backspace","index","resetSelectedIndex","onRemove","selectedOption","get","arrowLeft","Math","max","hiddenEl","arrowRight","allowInvalidPills","className","disabled","error","inputProps","onInput","onSuggestedPillAdd","placeholder","suggestedPillsData","suggestedPillsFilter","suggestedPillsTitle","validator","rest","suggestedPillsEnabled","hasError","classes","ariaAttrs","errorMessageID","handleBlur","handleClick","handleFocus","handleKeyDown","bind","displayText","text","hiddenRef","input","getPillsByKey","Component"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport uniqueId from 'lodash/uniqueId';\n\nimport Tooltip from '../tooltip';\nimport { KEYS } from '../../constants';\n\nimport Pill from './Pill';\nimport SuggestedPillsRow from './SuggestedPillsRow';\nimport type { Option, OptionValue, SelectedOptions, SuggestedPillsFilter } from './flowTypes';\n\nfunction stopDefaultEvent(event) {\n    event.preventDefault();\n    event.stopPropagation();\n}\n\ntype Props = {\n    allowInvalidPills: boolean,\n    className?: string,\n    disabled?: boolean,\n    error?: React.Node,\n    inputProps: Object,\n    onInput: Function,\n    onRemove: Function,\n    onSuggestedPillAdd?: Function,\n    placeholder: string,\n    selectedOptions: SelectedOptions,\n    suggestedPillsData?: Array<Object>,\n    suggestedPillsFilter?: SuggestedPillsFilter,\n    suggestedPillsTitle?: string,\n    validator: (option: Option | OptionValue) => boolean,\n};\n\ntype State = {\n    isFocused: boolean,\n    selectedIndex: number,\n};\n\nclass PillSelector extends React.Component<Props, State> {\n    static defaultProps = {\n        allowInvalidPills: false,\n        disabled: false,\n        error: '',\n        inputProps: {},\n        placeholder: '',\n        selectedOptions: [],\n        validator: () => true,\n    };\n\n    state = {\n        isFocused: false,\n        selectedIndex: -1,\n    };\n\n    getNumSelected = (): number => {\n        const { selectedOptions } = this.props;\n\n        return typeof selectedOptions.size === 'number' ? selectedOptions.size : selectedOptions.length;\n    };\n\n    getPillsByKey = (key: string): Array<any> => {\n        const { selectedOptions } = this.props;\n\n        return selectedOptions.map(option => option[key]);\n    };\n\n    inputEl: HTMLInputElement;\n\n    handleClick = () => {\n        this.inputEl.focus();\n    };\n\n    handleFocus = () => {\n        this.setState({ isFocused: true });\n    };\n\n    handleBlur = () => {\n        this.setState({ isFocused: false });\n    };\n\n    hiddenEl: HTMLSpanElement;\n\n    handleKeyDown = (event: SyntheticKeyboardEvent<>) => {\n        const inputValue = this.inputEl.value;\n        const numPills = this.getNumSelected();\n        const { selectedIndex } = this.state;\n\n        switch (event.key) {\n            case KEYS.backspace: {\n                let index = -1;\n                if (selectedIndex >= 0) {\n                    // remove selected pill\n                    index = selectedIndex;\n                    this.resetSelectedIndex();\n                    this.inputEl.focus();\n                } else if (inputValue === '') {\n                    // remove last pill\n                    index = numPills - 1;\n                }\n                if (index >= 0) {\n                    const { onRemove, selectedOptions } = this.props;\n                    const selectedOption =\n                        // $FlowFixMe\n                        typeof selectedOptions.get === 'function' ? selectedOptions.get(index) : selectedOptions[index];\n                    onRemove(selectedOption, index);\n                    stopDefaultEvent(event);\n                }\n                break;\n            }\n            case KEYS.arrowLeft:\n                if (selectedIndex >= 0) {\n                    // select previous pill\n                    this.setState({\n                        selectedIndex: Math.max(selectedIndex - 1, 0),\n                    });\n                    stopDefaultEvent(event);\n                } else if (inputValue === '' && numPills > 0) {\n                    // select last pill\n                    this.hiddenEl.focus();\n                    this.setState({ selectedIndex: numPills - 1 });\n                    stopDefaultEvent(event);\n                }\n                break;\n            case KEYS.arrowRight: {\n                if (selectedIndex >= 0) {\n                    const index = selectedIndex + 1;\n                    if (index >= numPills) {\n                        // deselect last pill\n                        this.resetSelectedIndex();\n                        this.inputEl.focus();\n                    } else {\n                        // select next pill\n                        this.setState({ selectedIndex: index });\n                    }\n                    stopDefaultEvent(event);\n                }\n                break;\n            }\n            // no default\n        }\n    };\n\n    errorMessageID = uniqueId('errorMessage');\n\n    hiddenRef = (hiddenEl: ?HTMLSpanElement) => {\n        if (hiddenEl) {\n            this.hiddenEl = hiddenEl;\n        }\n    };\n\n    resetSelectedIndex = () => {\n        if (this.state.selectedIndex !== -1) {\n            this.setState({ selectedIndex: -1 });\n        }\n    };\n\n    render() {\n        const { isFocused, selectedIndex } = this.state;\n        const {\n            allowInvalidPills,\n            className,\n            disabled,\n            error,\n            inputProps,\n            onInput,\n            onRemove,\n            onSuggestedPillAdd,\n            placeholder,\n            selectedOptions,\n            suggestedPillsData,\n            suggestedPillsFilter,\n            suggestedPillsTitle,\n            validator,\n            ...rest\n        } = this.props;\n        const suggestedPillsEnabled = suggestedPillsData && suggestedPillsData.length > 0;\n        const hasError = !!error;\n        const classes = classNames('pill-selector-input-wrapper', {\n            'is-disabled': disabled,\n            'is-focused': isFocused,\n            'show-error': hasError,\n            'pill-selector-suggestions-enabled': suggestedPillsEnabled,\n        });\n        const ariaAttrs = {\n            'aria-invalid': hasError,\n            'aria-errormessage': this.errorMessageID,\n        };\n\n        return (\n            <Tooltip isShown={hasError} text={error || ''} position=\"middle-right\" theme=\"error\">\n                {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions */}\n                <span\n                    className={classes}\n                    onBlur={this.handleBlur}\n                    onClick={this.handleClick}\n                    onFocus={this.handleFocus}\n                    onKeyDown={this.handleKeyDown}\n                >\n                    {selectedOptions.map((option: Option, index: number) => (\n                        <Pill\n                            isValid={allowInvalidPills ? validator(option) : true}\n                            isDisabled={disabled}\n                            isSelected={index === selectedIndex}\n                            key={option.value}\n                            onRemove={onRemove.bind(this, option, index)}\n                            // $FlowFixMe option.text is for backwards compatibility\n                            text={option.displayText || option.text}\n                        />\n                    ))}\n                    {/* hidden element for focus/key events during pill selection */}\n                    <span\n                        aria-hidden=\"true\"\n                        className=\"accessibility-hidden\"\n                        onBlur={this.resetSelectedIndex}\n                        ref={this.hiddenRef}\n                        tabIndex={-1}\n                        data-testid=\"pill-selection-helper\"\n                    />\n                    <textarea\n                        {...ariaAttrs}\n                        {...rest}\n                        {...inputProps}\n                        autoComplete=\"off\"\n                        className={classNames('pill-selector-input', className)}\n                        disabled={disabled}\n                        onInput={onInput}\n                        placeholder={this.getNumSelected() === 0 ? placeholder : ''}\n                        ref={input => {\n                            this.inputEl = input;\n                        }}\n                    />\n                    <SuggestedPillsRow\n                        onSuggestedPillAdd={onSuggestedPillAdd}\n                        selectedPillsValues={this.getPillsByKey('value')}\n                        suggestedPillsFilter={suggestedPillsFilter}\n                        suggestedPillsData={suggestedPillsData}\n                        title={suggestedPillsTitle}\n                    />\n                    <span id={this.errorMessageID} className=\"accessibility-hidden\" role=\"alert\">\n                        {error}\n                    </span>\n                </span>\n            </Tooltip>\n        );\n    }\n}\n\nexport default PillSelector;\n"],"file":"PillSelector.js"}